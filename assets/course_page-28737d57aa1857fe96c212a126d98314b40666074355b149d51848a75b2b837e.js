/*
 *	jQuery elevateZoom 3.0.8
 *	Demo's and documentation:
 *	www.elevateweb.co.uk/image-zoom
 *
 *	Copyright (c) 2012 Andrew Eades
 *	www.elevateweb.co.uk
 *
 *	Dual licensed under the GPL and MIT licenses.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	http://en.wikipedia.org/wiki/GNU_General_Public_License
 *

/*
 *	jQuery elevateZoom 3.0.3
 *	Demo's and documentation:
 *	www.elevateweb.co.uk/image-zoom
 *
 *	Copyright (c) 2012 Andrew Eades
 *	www.elevateweb.co.uk
 *
 *	Dual licensed under the GPL and MIT licenses.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	http://en.wikipedia.org/wiki/GNU_General_Public_License
 */
"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),function(e,t,n,o){var i={init:function(t,n){var o=this;o.elem=n,o.$elem=e(n),o.imageSrc=o.$elem.data("zoom-image")?o.$elem.data("zoom-image"):o.$elem.attr("src"),o.options=e.extend({},e.fn.elevateZoom.options,t),o.options.tint&&(o.options.lensColour="none",o.options.lensOpacity="1"),"inner"==o.options.zoomType&&(o.options.showLens=!1),o.$elem.parent().removeAttr("title").removeAttr("alt"),o.zoomImage=o.imageSrc,o.refresh(1),e("#"+o.options.gallery+" a").click(function(t){return o.options.galleryActiveClass&&(e("#"+o.options.gallery+" a").removeClass(o.options.galleryActiveClass),e(this).addClass(o.options.galleryActiveClass)),t.preventDefault(),e(this).data("zoom-image")?o.zoomImagePre=e(this).data("zoom-image"):o.zoomImagePre=e(this).data("image"),o.swaptheimage(e(this).data("image"),o.zoomImagePre),!1})},refresh:function(e){var t=this;setTimeout(function(){t.fetch(t.imageSrc)},e||t.options.refresh)},fetch:function(e){var t=this,n=new Image;n.onload=function(){t.largeWidth=n.width,t.largeHeight=n.height,t.startZoom(),t.currentImage=t.imageSrc,t.options.onZoomedImageLoaded(t.$elem)},n.src=e},startZoom:function(){var t=this;if(t.nzWidth=t.$elem.width(),t.nzHeight=t.$elem.height(),t.isWindowActive=!1,t.isLensActive=!1,t.isTintActive=!1,t.overWindow=!1,t.options.imageCrossfade&&(t.zoomWrap=t.$elem.wrap('<div style="height:'+t.nzHeight+"px;width:"+t.nzWidth+'px;" class="zoomWrapper" />'),t.$elem.css("position","absolute")),t.zoomLock=1,t.scrollingLock=!1,t.changeBgSize=!1,t.currentZoomLevel=t.options.zoomLevel,t.nzOffset=t.$elem.offset(),t.widthRatio=t.largeWidth/t.currentZoomLevel/t.nzWidth,t.heightRatio=t.largeHeight/t.currentZoomLevel/t.nzHeight,"window"==t.options.zoomType&&(t.zoomWindowStyle="overflow: hidden;background-position: 0px 0px;text-align:center;background-color: "+String(t.options.zoomWindowBgColour)+";width: "+String(t.options.zoomWindowWidth)+"px;height: "+String(t.options.zoomWindowHeight)+"px;float: left;background-size: "+t.largeWidth/t.currentZoomLevel+"px "+t.largeHeight/t.currentZoomLevel+"px;display: none;z-index:100;border: "+String(t.options.borderSize)+"px solid "+t.options.borderColour+";background-repeat: no-repeat;position: absolute;"),"inner"==t.options.zoomType){var n=t.$elem.css("border-left-width");t.zoomWindowStyle="overflow: hidden;margin-left: "+String(n)+";margin-top: "+String(n)+";background-position: 0px 0px;width: "+String(t.nzWidth)+"px;height: "+String(t.nzHeight)+"px;px;float: left;display: none;cursor:"+t.options.cursor+";px solid "+t.options.borderColour+";background-repeat: no-repeat;position: absolute;"}"window"==t.options.zoomType&&(t.nzHeight<t.options.zoomWindowWidth/t.widthRatio?lensHeight=t.nzHeight:lensHeight=String(t.options.zoomWindowHeight/t.heightRatio),t.largeWidth<t.options.zoomWindowWidth?lensWidth=t.nzWidth:lensWidth=t.options.zoomWindowWidth/t.widthRatio,t.lensStyle="background-position: 0px 0px;width: "+String(t.options.zoomWindowWidth/t.widthRatio)+"px;height: "+String(t.options.zoomWindowHeight/t.heightRatio)+"px;float: right;display: none;overflow: hidden;z-index: 999;-webkit-transform: translateZ(0);opacity:"+t.options.lensOpacity+";filter: alpha(opacity = "+100*t.options.lensOpacity+"); zoom:1;width:"+lensWidth+"px;height:"+lensHeight+"px;background-color:"+t.options.lensColour+";cursor:"+t.options.cursor+";border: "+t.options.lensBorderSize+"px solid "+t.options.lensBorderColour+";background-repeat: no-repeat;position: absolute;"),t.tintStyle="display: block;position: absolute;background-color: "+t.options.tintColour+";filter:alpha(opacity=0);opacity: 0;width: "+t.nzWidth+"px;height: "+t.nzHeight+"px;",t.lensRound="","lens"==t.options.zoomType&&(t.lensStyle="background-position: 0px 0px;float: left;display: none;border: "+String(t.options.borderSize)+"px solid "+t.options.borderColour+";width:"+String(t.options.lensSize)+"px;height:"+String(t.options.lensSize)+"px;background-repeat: no-repeat;position: absolute;"),"round"==t.options.lensShape&&(t.lensRound="border-top-left-radius: "+String(t.options.lensSize/2+t.options.borderSize)+"px;border-top-right-radius: "+String(t.options.lensSize/2+t.options.borderSize)+"px;border-bottom-left-radius: "+String(t.options.lensSize/2+t.options.borderSize)+"px;border-bottom-right-radius: "+String(t.options.lensSize/2+t.options.borderSize)+"px;"),t.zoomContainer=e('<div class="zoomContainer" style="-webkit-transform: translateZ(0);position:absolute;left:'+t.nzOffset.left+"px;top:"+t.nzOffset.top+"px;height:"+t.nzHeight+"px;width:"+t.nzWidth+'px;"></div>'),e("body").append(t.zoomContainer),t.options.containLensZoom&&"lens"==t.options.zoomType&&t.zoomContainer.css("overflow","hidden"),"inner"!=t.options.zoomType&&(t.zoomLens=e("<div class='zoomLens' style='"+t.lensStyle+t.lensRound+"'>&nbsp;</div>").appendTo(t.zoomContainer).click(function(){t.$elem.trigger("click")}),t.options.tint&&(t.tintContainer=e("<div/>").addClass("tintContainer"),t.zoomTint=e("<div class='zoomTint' style='"+t.tintStyle+"'></div>"),t.zoomLens.wrap(t.tintContainer),t.zoomTintcss=t.zoomLens.after(t.zoomTint),t.zoomTintImage=e('<img style="position: absolute; left: 0px; top: 0px; max-width: none; width: '+t.nzWidth+"px; height: "+t.nzHeight+'px;" src="'+t.imageSrc+'">').appendTo(t.zoomLens).click(function(){t.$elem.trigger("click")}))),isNaN(t.options.zoomWindowPosition)?t.zoomWindow=e("<div style='z-index:999;left:"+t.windowOffsetLeft+"px;top:"+t.windowOffsetTop+"px;"+t.zoomWindowStyle+"' class='zoomWindow'>&nbsp;</div>").appendTo("body").click(function(){t.$elem.trigger("click")}):t.zoomWindow=e("<div style='z-index:999;left:"+t.windowOffsetLeft+"px;top:"+t.windowOffsetTop+"px;"+t.zoomWindowStyle+"' class='zoomWindow'>&nbsp;</div>").appendTo(t.zoomContainer).click(function(){t.$elem.trigger("click")}),t.zoomWindowContainer=e("<div/>").addClass("zoomWindowContainer").css("width",t.options.zoomWindowWidth),t.zoomWindow.wrap(t.zoomWindowContainer),"lens"==t.options.zoomType&&t.zoomLens.css({backgroundImage:"url('"+t.imageSrc+"')"}),"window"==t.options.zoomType&&t.zoomWindow.css({backgroundImage:"url('"+t.imageSrc+"')"}),"inner"==t.options.zoomType&&t.zoomWindow.css({backgroundImage:"url('"+t.imageSrc+"')"}),t.$elem.bind("touchmove",function(e){e.preventDefault();var n=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t.setPosition(n)}),t.zoomContainer.bind("touchmove",function(e){"inner"==t.options.zoomType&&t.showHideWindow("show"),e.preventDefault();var n=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t.setPosition(n)}),t.zoomContainer.bind("touchend",function(e){t.showHideWindow("hide"),t.options.showLens&&t.showHideLens("hide"),t.options.tint&&"inner"!=t.options.zoomType&&t.showHideTint("hide")}),t.$elem.bind("touchend",function(e){t.showHideWindow("hide"),t.options.showLens&&t.showHideLens("hide"),t.options.tint&&"inner"!=t.options.zoomType&&t.showHideTint("hide")}),t.options.showLens&&(t.zoomLens.bind("touchmove",function(e){e.preventDefault();var n=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t.setPosition(n)}),t.zoomLens.bind("touchend",function(e){t.showHideWindow("hide"),t.options.showLens&&t.showHideLens("hide"),t.options.tint&&"inner"!=t.options.zoomType&&t.showHideTint("hide")})),t.$elem.bind("mousemove",function(e){0==t.overWindow&&t.setElements("show"),(t.lastX!==e.clientX||t.lastY!==e.clientY)&&(t.setPosition(e),t.currentLoc=e),t.lastX=e.clientX,t.lastY=e.clientY}),t.zoomContainer.bind("mousemove",function(e){0==t.overWindow&&t.setElements("show"),(t.lastX!==e.clientX||t.lastY!==e.clientY)&&(t.setPosition(e),t.currentLoc=e),t.lastX=e.clientX,t.lastY=e.clientY}),"inner"!=t.options.zoomType&&t.zoomLens.bind("mousemove",function(e){(t.lastX!==e.clientX||t.lastY!==e.clientY)&&(t.setPosition(e),t.currentLoc=e),t.lastX=e.clientX,t.lastY=e.clientY}),t.options.tint&&"inner"!=t.options.zoomType&&t.zoomTint.bind("mousemove",function(e){(t.lastX!==e.clientX||t.lastY!==e.clientY)&&(t.setPosition(e),t.currentLoc=e),t.lastX=e.clientX,t.lastY=e.clientY}),"inner"==t.options.zoomType&&t.zoomWindow.bind("mousemove",function(e){(t.lastX!==e.clientX||t.lastY!==e.clientY)&&(t.setPosition(e),t.currentLoc=e),t.lastX=e.clientX,t.lastY=e.clientY}),t.zoomContainer.add(t.$elem).mouseenter(function(){0==t.overWindow&&t.setElements("show")}).mouseleave(function(){t.scrollLock||(t.setElements("hide"),t.options.onDestroy(t.$elem))}),"inner"!=t.options.zoomType&&t.zoomWindow.mouseenter(function(){t.overWindow=!0,t.setElements("hide")}).mouseleave(function(){t.overWindow=!1}),1!=t.options.zoomLevel,t.options.minZoomLevel?t.minZoomLevel=t.options.minZoomLevel:t.minZoomLevel=2*t.options.scrollZoomIncrement,t.options.scrollZoom&&t.zoomContainer.add(t.$elem).bind("mousewheel DOMMouseScroll MozMousePixelScroll",function(n){t.scrollLock=!0,clearTimeout(e.data(this,"timer")),e.data(this,"timer",setTimeout(function(){t.scrollLock=!1},250));var o=n.originalEvent.wheelDelta||-1*n.originalEvent.detail;return n.stopImmediatePropagation(),n.stopPropagation(),n.preventDefault(),o/120>0?t.currentZoomLevel>=t.minZoomLevel&&t.changeZoomLevel(t.currentZoomLevel-t.options.scrollZoomIncrement):t.options.maxZoomLevel?t.currentZoomLevel<=t.options.maxZoomLevel&&t.changeZoomLevel(parseFloat(t.currentZoomLevel)+t.options.scrollZoomIncrement):t.changeZoomLevel(parseFloat(t.currentZoomLevel)+t.options.scrollZoomIncrement),!1})},setElements:function(e){var t=this;return t.options.zoomEnabled?("show"==e&&t.isWindowSet&&("inner"==t.options.zoomType&&t.showHideWindow("show"),"window"==t.options.zoomType&&t.showHideWindow("show"),t.options.showLens&&t.showHideLens("show"),t.options.tint&&"inner"!=t.options.zoomType&&t.showHideTint("show")),void("hide"==e&&("window"==t.options.zoomType&&t.showHideWindow("hide"),t.options.tint||t.showHideWindow("hide"),t.options.showLens&&t.showHideLens("hide"),t.options.tint&&t.showHideTint("hide")))):!1},setPosition:function(e){var t=this;return t.options.zoomEnabled?(t.nzHeight=t.$elem.height(),t.nzWidth=t.$elem.width(),t.nzOffset=t.$elem.offset(),t.options.tint&&"inner"!=t.options.zoomType&&(t.zoomTint.css({top:0}),t.zoomTint.css({left:0})),t.options.responsive&&!t.options.scrollZoom&&t.options.showLens&&(t.nzHeight<t.options.zoomWindowWidth/t.widthRatio?lensHeight=t.nzHeight:lensHeight=String(t.options.zoomWindowHeight/t.heightRatio),t.largeWidth<t.options.zoomWindowWidth?lensWidth=t.nzWidth:lensWidth=t.options.zoomWindowWidth/t.widthRatio,t.widthRatio=t.largeWidth/t.nzWidth,t.heightRatio=t.largeHeight/t.nzHeight,"lens"!=t.options.zoomType&&(t.nzHeight<t.options.zoomWindowWidth/t.widthRatio?lensHeight=t.nzHeight:lensHeight=String(t.options.zoomWindowHeight/t.heightRatio),t.nzWidth<t.options.zoomWindowHeight/t.heightRatio?lensWidth=t.nzWidth:lensWidth=String(t.options.zoomWindowWidth/t.widthRatio),t.zoomLens.css("width",lensWidth),t.zoomLens.css("height",lensHeight),t.options.tint&&(t.zoomTintImage.css("width",t.nzWidth),t.zoomTintImage.css("height",t.nzHeight))),"lens"==t.options.zoomType&&t.zoomLens.css({width:String(t.options.lensSize)+"px",height:String(t.options.lensSize)+"px"})),t.zoomContainer.css({top:t.nzOffset.top}),t.zoomContainer.css({left:t.nzOffset.left}),t.mouseLeft=parseInt(e.pageX-t.nzOffset.left),t.mouseTop=parseInt(e.pageY-t.nzOffset.top),"window"==t.options.zoomType&&(t.Etoppos=t.mouseTop<t.zoomLens.height()/2,t.Eboppos=t.mouseTop>t.nzHeight-t.zoomLens.height()/2-2*t.options.lensBorderSize,t.Eloppos=t.mouseLeft<0+t.zoomLens.width()/2,t.Eroppos=t.mouseLeft>t.nzWidth-t.zoomLens.width()/2-2*t.options.lensBorderSize),"inner"==t.options.zoomType&&(t.Etoppos=t.mouseTop<t.nzHeight/2/t.heightRatio,t.Eboppos=t.mouseTop>t.nzHeight-t.nzHeight/2/t.heightRatio,t.Eloppos=t.mouseLeft<0+t.nzWidth/2/t.widthRatio,t.Eroppos=t.mouseLeft>t.nzWidth-t.nzWidth/2/t.widthRatio-2*t.options.lensBorderSize),t.mouseLeft<0||t.mouseTop<0||t.mouseLeft>t.nzWidth||t.mouseTop>t.nzHeight?void t.setElements("hide"):(t.options.showLens&&(t.lensLeftPos=String(Math.floor(t.mouseLeft-t.zoomLens.width()/2)),t.lensTopPos=String(Math.floor(t.mouseTop-t.zoomLens.height()/2))),t.Etoppos&&(t.lensTopPos=0),t.Eloppos&&(t.windowLeftPos=0,t.lensLeftPos=0,t.tintpos=0),"window"==t.options.zoomType&&(t.Eboppos&&(t.lensTopPos=Math.max(t.nzHeight-t.zoomLens.height()-2*t.options.lensBorderSize,0)),t.Eroppos&&(t.lensLeftPos=t.nzWidth-t.zoomLens.width()-2*t.options.lensBorderSize)),"inner"==t.options.zoomType&&(t.Eboppos&&(t.lensTopPos=Math.max(t.nzHeight-2*t.options.lensBorderSize,0)),t.Eroppos&&(t.lensLeftPos=t.nzWidth-t.nzWidth-2*t.options.lensBorderSize)),"lens"==t.options.zoomType&&(t.windowLeftPos=String(-1*((e.pageX-t.nzOffset.left)*t.widthRatio-t.zoomLens.width()/2)),t.windowTopPos=String(-1*((e.pageY-t.nzOffset.top)*t.heightRatio-t.zoomLens.height()/2)),t.zoomLens.css({backgroundPosition:t.windowLeftPos+"px "+t.windowTopPos+"px"}),t.changeBgSize&&(t.nzHeight>t.nzWidth?("lens"==t.options.zoomType&&t.zoomLens.css({"background-size":t.largeWidth/t.newvalueheight+"px "+t.largeHeight/t.newvalueheight+"px"}),t.zoomWindow.css({"background-size":t.largeWidth/t.newvalueheight+"px "+t.largeHeight/t.newvalueheight+"px"})):("lens"==t.options.zoomType&&t.zoomLens.css({"background-size":t.largeWidth/t.newvaluewidth+"px "+t.largeHeight/t.newvaluewidth+"px"}),t.zoomWindow.css({"background-size":t.largeWidth/t.newvaluewidth+"px "+t.largeHeight/t.newvaluewidth+"px"})),t.changeBgSize=!1),t.setWindowPostition(e)),t.options.tint&&"inner"!=t.options.zoomType&&t.setTintPosition(e),"window"==t.options.zoomType&&t.setWindowPostition(e),"inner"==t.options.zoomType&&t.setWindowPostition(e),t.options.showLens&&(t.fullwidth&&"lens"!=t.options.zoomType&&(t.lensLeftPos=0),t.zoomLens.css({left:t.lensLeftPos+"px",top:t.lensTopPos+"px"})),void 0)):!1},showHideWindow:function(e){var t=this;"show"==e&&(t.isWindowActive||(t.options.zoomWindowFadeIn?t.zoomWindow.stop(!0,!0,!1).fadeIn(t.options.zoomWindowFadeIn):t.zoomWindow.show(),t.isWindowActive=!0)),"hide"==e&&t.isWindowActive&&(t.options.zoomWindowFadeOut?t.zoomWindow.stop(!0,!0).fadeOut(t.options.zoomWindowFadeOut,function(){t.loop&&(clearInterval(t.loop),t.loop=!1)}):t.zoomWindow.hide(),t.isWindowActive=!1)},showHideLens:function(e){var t=this;"show"==e&&(t.isLensActive||(t.options.lensFadeIn?t.zoomLens.stop(!0,!0,!1).fadeIn(t.options.lensFadeIn):t.zoomLens.show(),t.isLensActive=!0)),"hide"==e&&t.isLensActive&&(t.options.lensFadeOut?t.zoomLens.stop(!0,!0).fadeOut(t.options.lensFadeOut):t.zoomLens.hide(),t.isLensActive=!1)},showHideTint:function(e){var t=this;"show"==e&&(t.isTintActive||(t.options.zoomTintFadeIn?t.zoomTint.css({opacity:t.options.tintOpacity}).animate().stop(!0,!0).fadeIn("slow"):(t.zoomTint.css({opacity:t.options.tintOpacity}).animate(),t.zoomTint.show()),t.isTintActive=!0)),"hide"==e&&t.isTintActive&&(t.options.zoomTintFadeOut?t.zoomTint.stop(!0,!0).fadeOut(t.options.zoomTintFadeOut):t.zoomTint.hide(),t.isTintActive=!1)},setLensPostition:function(e){},setWindowPostition:function(t){var n=this;if(isNaN(n.options.zoomWindowPosition))n.externalContainer=e("#"+n.options.zoomWindowPosition),n.externalContainerWidth=n.externalContainer.width(),n.externalContainerHeight=n.externalContainer.height(),n.externalContainerOffset=n.externalContainer.offset(),n.windowOffsetTop=n.externalContainerOffset.top,n.windowOffsetLeft=n.externalContainerOffset.left;else switch(n.options.zoomWindowPosition){case 1:n.windowOffsetTop=n.options.zoomWindowOffety,n.windowOffsetLeft=+n.nzWidth;break;case 2:n.options.zoomWindowHeight>n.nzHeight&&(n.windowOffsetTop=-1*(n.options.zoomWindowHeight/2-n.nzHeight/2),n.windowOffsetLeft=n.nzWidth);break;case 3:n.windowOffsetTop=n.nzHeight-n.zoomWindow.height()-2*n.options.borderSize,n.windowOffsetLeft=n.nzWidth;break;case 4:n.windowOffsetTop=n.nzHeight,n.windowOffsetLeft=n.nzWidth;break;case 5:n.windowOffsetTop=n.nzHeight,n.windowOffsetLeft=n.nzWidth-n.zoomWindow.width()-2*n.options.borderSize;break;case 6:n.options.zoomWindowHeight>n.nzHeight&&(n.windowOffsetTop=n.nzHeight,n.windowOffsetLeft=-1*(n.options.zoomWindowWidth/2-n.nzWidth/2+2*n.options.borderSize));break;case 7:n.windowOffsetTop=n.nzHeight,n.windowOffsetLeft=0;break;case 8:n.windowOffsetTop=n.nzHeight,n.windowOffsetLeft=-1*(n.zoomWindow.width()+2*n.options.borderSize);break;case 9:n.windowOffsetTop=n.nzHeight-n.zoomWindow.height()-2*n.options.borderSize,n.windowOffsetLeft=-1*(n.zoomWindow.width()+2*n.options.borderSize);break;case 10:n.options.zoomWindowHeight>n.nzHeight&&(n.windowOffsetTop=-1*(n.options.zoomWindowHeight/2-n.nzHeight/2),n.windowOffsetLeft=-1*(n.zoomWindow.width()+2*n.options.borderSize));break;case 11:n.windowOffsetTop=n.options.zoomWindowOffety,n.windowOffsetLeft=-1*(n.zoomWindow.width()+2*n.options.borderSize);break;case 12:n.windowOffsetTop=-1*(n.zoomWindow.height()+2*n.options.borderSize),n.windowOffsetLeft=-1*(n.zoomWindow.width()+2*n.options.borderSize);break;case 13:n.windowOffsetTop=-1*(n.zoomWindow.height()+2*n.options.borderSize),n.windowOffsetLeft=0;break;case 14:n.options.zoomWindowHeight>n.nzHeight&&(n.windowOffsetTop=-1*(n.zoomWindow.height()+2*n.options.borderSize),n.windowOffsetLeft=-1*(n.options.zoomWindowWidth/2-n.nzWidth/2+2*n.options.borderSize));break;case 15:n.windowOffsetTop=-1*(n.zoomWindow.height()+2*n.options.borderSize),n.windowOffsetLeft=n.nzWidth-n.zoomWindow.width()-2*n.options.borderSize;break;case 16:n.windowOffsetTop=-1*(n.zoomWindow.height()+2*n.options.borderSize),n.windowOffsetLeft=n.nzWidth;break;default:n.windowOffsetTop=n.options.zoomWindowOffety,n.windowOffsetLeft=n.nzWidth}n.isWindowSet=!0,n.windowOffsetTop=n.windowOffsetTop+n.options.zoomWindowOffety,n.windowOffsetLeft=n.windowOffsetLeft+n.options.zoomWindowOffetx,n.zoomWindow.css({top:n.windowOffsetTop}),n.zoomWindow.css({left:n.windowOffsetLeft}),"inner"==n.options.zoomType&&(n.zoomWindow.css({top:0}),n.zoomWindow.css({left:0})),n.windowLeftPos=String(-1*((t.pageX-n.nzOffset.left)*n.widthRatio-n.zoomWindow.width()/2)),n.windowTopPos=String(-1*((t.pageY-n.nzOffset.top)*n.heightRatio-n.zoomWindow.height()/2)),n.Etoppos&&(n.windowTopPos=0),n.Eloppos&&(n.windowLeftPos=0),n.Eboppos&&(n.windowTopPos=-1*(n.largeHeight/n.currentZoomLevel-n.zoomWindow.height())),n.Eroppos&&(n.windowLeftPos=-1*(n.largeWidth/n.currentZoomLevel-n.zoomWindow.width())),n.fullheight&&(n.windowTopPos=0),n.fullwidth&&(n.windowLeftPos=0),("window"==n.options.zoomType||"inner"==n.options.zoomType)&&(1==n.zoomLock&&(n.widthRatio<=1&&(n.windowLeftPos=0),n.heightRatio<=1&&(n.windowTopPos=0)),"window"==n.options.zoomType&&(n.largeHeight<n.options.zoomWindowHeight&&(n.windowTopPos=0),n.largeWidth<n.options.zoomWindowWidth&&(n.windowLeftPos=0)),n.options.easing?(n.xp||(n.xp=0),n.yp||(n.yp=0),n.loop||(n.loop=setInterval(function(){n.xp+=(n.windowLeftPos-n.xp)/n.options.easingAmount,n.yp+=(n.windowTopPos-n.yp)/n.options.easingAmount,n.scrollingLock?(clearInterval(n.loop),n.xp=n.windowLeftPos,n.yp=n.windowTopPos,n.xp=-1*((t.pageX-n.nzOffset.left)*n.widthRatio-n.zoomWindow.width()/2),n.yp=-1*((t.pageY-n.nzOffset.top)*n.heightRatio-n.zoomWindow.height()/2),n.changeBgSize&&(n.nzHeight>n.nzWidth?("lens"==n.options.zoomType&&n.zoomLens.css({"background-size":n.largeWidth/n.newvalueheight+"px "+n.largeHeight/n.newvalueheight+"px"}),n.zoomWindow.css({"background-size":n.largeWidth/n.newvalueheight+"px "+n.largeHeight/n.newvalueheight+"px"})):("lens"!=n.options.zoomType&&n.zoomLens.css({"background-size":n.largeWidth/n.newvaluewidth+"px "+n.largeHeight/n.newvalueheight+"px"}),n.zoomWindow.css({"background-size":n.largeWidth/n.newvaluewidth+"px "+n.largeHeight/n.newvaluewidth+"px"})),n.changeBgSize=!1),n.zoomWindow.css({backgroundPosition:n.windowLeftPos+"px "+n.windowTopPos+"px"}),n.scrollingLock=!1,n.loop=!1):Math.round(Math.abs(n.xp-n.windowLeftPos)+Math.abs(n.yp-n.windowTopPos))<1?(clearInterval(n.loop),n.zoomWindow.css({backgroundPosition:n.windowLeftPos+"px "+n.windowTopPos+"px"}),n.loop=!1):(n.changeBgSize&&(n.nzHeight>n.nzWidth?("lens"==n.options.zoomType&&n.zoomLens.css({"background-size":n.largeWidth/n.newvalueheight+"px "+n.largeHeight/n.newvalueheight+"px"}),n.zoomWindow.css({"background-size":n.largeWidth/n.newvalueheight+"px "+n.largeHeight/n.newvalueheight+"px"})):("lens"!=n.options.zoomType&&n.zoomLens.css({"background-size":n.largeWidth/n.newvaluewidth+"px "+n.largeHeight/n.newvaluewidth+"px"}),n.zoomWindow.css({"background-size":n.largeWidth/n.newvaluewidth+"px "+n.largeHeight/n.newvaluewidth+"px"})),n.changeBgSize=!1),n.zoomWindow.css({backgroundPosition:n.xp+"px "+n.yp+"px"}))},16))):(n.changeBgSize&&(n.nzHeight>n.nzWidth?("lens"==n.options.zoomType&&n.zoomLens.css({"background-size":n.largeWidth/n.newvalueheight+"px "+n.largeHeight/n.newvalueheight+"px"}),n.zoomWindow.css({"background-size":n.largeWidth/n.newvalueheight+"px "+n.largeHeight/n.newvalueheight+"px"})):("lens"==n.options.zoomType&&n.zoomLens.css({"background-size":n.largeWidth/n.newvaluewidth+"px "+n.largeHeight/n.newvaluewidth+"px"}),n.largeHeight/n.newvaluewidth<n.options.zoomWindowHeight?n.zoomWindow.css({"background-size":n.largeWidth/n.newvaluewidth+"px "+n.largeHeight/n.newvaluewidth+"px"}):n.zoomWindow.css({"background-size":n.largeWidth/n.newvalueheight+"px "+n.largeHeight/n.newvalueheight+"px"})),n.changeBgSize=!1),n.zoomWindow.css({backgroundPosition:n.windowLeftPos+"px "+n.windowTopPos+"px"})))},setTintPosition:function(e){var t=this;t.nzOffset=t.$elem.offset(),t.tintpos=String(-1*(e.pageX-t.nzOffset.left-t.zoomLens.width()/2)),t.tintposy=String(-1*(e.pageY-t.nzOffset.top-t.zoomLens.height()/2)),t.Etoppos&&(t.tintposy=0),t.Eloppos&&(t.tintpos=0),t.Eboppos&&(t.tintposy=-1*(t.nzHeight-t.zoomLens.height()-2*t.options.lensBorderSize)),t.Eroppos&&(t.tintpos=-1*(t.nzWidth-t.zoomLens.width()-2*t.options.lensBorderSize)),t.options.tint&&(t.fullheight&&(t.tintposy=0),t.fullwidth&&(t.tintpos=0),t.zoomTintImage.css({left:t.tintpos+"px"}),t.zoomTintImage.css({top:t.tintposy+"px"}))},swaptheimage:function(t,n){var o=this,i=new Image;o.options.loadingIcon&&(o.spinner=e("<div style=\"background: url('"+o.options.loadingIcon+"') no-repeat center;height:"+o.nzHeight+"px;width:"+o.nzWidth+'px;z-index: 2000;position: absolute; background-position: center center;"></div>'),o.$elem.after(o.spinner)),o.options.onImageSwap(o.$elem),i.onload=function(){o.largeWidth=i.width,o.largeHeight=i.height,o.zoomImage=n,o.zoomWindow.css({"background-size":o.largeWidth+"px "+o.largeHeight+"px"}),o.swapAction(t,n)},i.src=n},swapAction:function(t,n){var o=this,i=new Image;if(i.onload=function(){o.nzHeight=i.height,o.nzWidth=i.width,o.options.onImageSwapComplete(o.$elem),o.doneCallback()},i.src=t,o.currentZoomLevel=o.options.zoomLevel,o.options.maxZoomLevel=!1,"lens"==o.options.zoomType&&o.zoomLens.css({backgroundImage:"url('"+n+"')"}),"window"==o.options.zoomType&&o.zoomWindow.css({backgroundImage:"url('"+n+"')"}),"inner"==o.options.zoomType&&o.zoomWindow.css({backgroundImage:"url('"+n+"')"}),o.currentImage=n,o.options.imageCrossfade){var r=o.$elem,s=r.clone();if(o.$elem.attr("src",t),o.$elem.after(s),s.stop(!0).fadeOut(o.options.imageCrossfade,function(){e(this).remove()}),o.$elem.width("auto").removeAttr("width"),o.$elem.height("auto").removeAttr("height"),r.fadeIn(o.options.imageCrossfade),o.options.tint&&"inner"!=o.options.zoomType){var a=o.zoomTintImage,l=a.clone();o.zoomTintImage.attr("src",n),o.zoomTintImage.after(l),l.stop(!0).fadeOut(o.options.imageCrossfade,function(){e(this).remove()}),a.fadeIn(o.options.imageCrossfade),o.zoomTint.css({height:o.$elem.height()}),o.zoomTint.css({width:o.$elem.width()})}o.zoomContainer.css("height",o.$elem.height()),o.zoomContainer.css("width",o.$elem.width()),"inner"==o.options.zoomType&&(o.options.constrainType||(o.zoomWrap.parent().css("height",o.$elem.height()),o.zoomWrap.parent().css("width",o.$elem.width()),o.zoomWindow.css("height",o.$elem.height()),o.zoomWindow.css("width",o.$elem.width()))),o.options.imageCrossfade&&(o.zoomWrap.css("height",o.$elem.height()),o.zoomWrap.css("width",o.$elem.width()))}else o.$elem.attr("src",t),o.options.tint&&(o.zoomTintImage.attr("src",n),o.zoomTintImage.attr("height",o.$elem.height()),o.zoomTintImage.css({height:o.$elem.height()}),o.zoomTint.css({height:o.$elem.height()})),o.zoomContainer.css("height",o.$elem.height()),o.zoomContainer.css("width",o.$elem.width()),o.options.imageCrossfade&&(o.zoomWrap.css("height",o.$elem.height()),o.zoomWrap.css("width",o.$elem.width()));o.options.constrainType&&("height"==o.options.constrainType&&(o.zoomContainer.css("height",o.options.constrainSize),o.zoomContainer.css("width","auto"),o.options.imageCrossfade?(o.zoomWrap.css("height",o.options.constrainSize),o.zoomWrap.css("width","auto"),o.constwidth=o.zoomWrap.width()):(o.$elem.css("height",o.options.constrainSize),o.$elem.css("width","auto"),o.constwidth=o.$elem.width()),"inner"==o.options.zoomType&&(o.zoomWrap.parent().css("height",o.options.constrainSize),o.zoomWrap.parent().css("width",o.constwidth),o.zoomWindow.css("height",o.options.constrainSize),o.zoomWindow.css("width",o.constwidth)),o.options.tint&&(o.tintContainer.css("height",o.options.constrainSize),o.tintContainer.css("width",o.constwidth),o.zoomTint.css("height",o.options.constrainSize),o.zoomTint.css("width",o.constwidth),o.zoomTintImage.css("height",o.options.constrainSize),o.zoomTintImage.css("width",o.constwidth))),"width"==o.options.constrainType&&(o.zoomContainer.css("height","auto"),o.zoomContainer.css("width",o.options.constrainSize),o.options.imageCrossfade?(o.zoomWrap.css("height","auto"),o.zoomWrap.css("width",o.options.constrainSize),o.constheight=o.zoomWrap.height()):(o.$elem.css("height","auto"),o.$elem.css("width",o.options.constrainSize),o.constheight=o.$elem.height()),"inner"==o.options.zoomType&&(o.zoomWrap.parent().css("height",o.constheight),o.zoomWrap.parent().css("width",o.options.constrainSize),o.zoomWindow.css("height",o.constheight),o.zoomWindow.css("width",o.options.constrainSize)),o.options.tint&&(o.tintContainer.css("height",o.constheight),o.tintContainer.css("width",o.options.constrainSize),o.zoomTint.css("height",o.constheight),o.zoomTint.css("width",o.options.constrainSize),o.zoomTintImage.css("height",o.constheight),o.zoomTintImage.css("width",o.options.constrainSize))))},doneCallback:function(){var e=this;e.options.loadingIcon&&e.spinner.hide(),e.nzOffset=e.$elem.offset(),e.nzWidth=e.$elem.width(),e.nzHeight=e.$elem.height(),e.currentZoomLevel=e.options.zoomLevel,e.widthRatio=e.largeWidth/e.nzWidth,e.heightRatio=e.largeHeight/e.nzHeight,"window"==e.options.zoomType&&(e.nzHeight<e.options.zoomWindowWidth/e.widthRatio?lensHeight=e.nzHeight:lensHeight=String(e.options.zoomWindowHeight/e.heightRatio),e.options.zoomWindowWidth<e.options.zoomWindowWidth?lensWidth=e.nzWidth:lensWidth=e.options.zoomWindowWidth/e.widthRatio,e.zoomLens&&(e.zoomLens.css("width",lensWidth),e.zoomLens.css("height",lensHeight)))},getCurrentImage:function(){var e=this;return e.zoomImage},getGalleryList:function(){var t=this;return t.gallerylist=[],t.options.gallery?e("#"+t.options.gallery+" a").each(function(){var n="";e(this).data("zoom-image")?n=e(this).data("zoom-image"):e(this).data("image")&&(n=e(this).data("image")),n==t.zoomImage?t.gallerylist.unshift({href:""+n,title:e(this).find("img").attr("title")}):t.gallerylist.push({href:""+n,title:e(this).find("img").attr("title")})}):t.gallerylist.push({href:""+t.zoomImage,title:e(this).find("img").attr("title")}),t.gallerylist},changeZoomLevel:function(e){var t=this;t.scrollingLock=!0,t.newvalue=parseFloat(e).toFixed(2),newvalue=parseFloat(e).toFixed(2),maxheightnewvalue=t.largeHeight/(t.options.zoomWindowHeight/t.nzHeight*t.nzHeight),maxwidthtnewvalue=t.largeWidth/(t.options.zoomWindowWidth/t.nzWidth*t.nzWidth),"inner"!=t.options.zoomType&&(maxheightnewvalue<=newvalue?(t.heightRatio=t.largeHeight/maxheightnewvalue/t.nzHeight,t.newvalueheight=maxheightnewvalue,t.fullheight=!0):(t.heightRatio=t.largeHeight/newvalue/t.nzHeight,t.newvalueheight=newvalue,t.fullheight=!1),maxwidthtnewvalue<=newvalue?(t.widthRatio=t.largeWidth/maxwidthtnewvalue/t.nzWidth,t.newvaluewidth=maxwidthtnewvalue,t.fullwidth=!0):(t.widthRatio=t.largeWidth/newvalue/t.nzWidth,t.newvaluewidth=newvalue,t.fullwidth=!1),"lens"==t.options.zoomType&&(maxheightnewvalue<=newvalue?(t.fullwidth=!0,t.newvaluewidth=maxheightnewvalue):(t.widthRatio=t.largeWidth/newvalue/t.nzWidth,t.newvaluewidth=newvalue,t.fullwidth=!1))),"inner"==t.options.zoomType&&(maxheightnewvalue=parseFloat(t.largeHeight/t.nzHeight).toFixed(2),maxwidthtnewvalue=parseFloat(t.largeWidth/t.nzWidth).toFixed(2),newvalue>maxheightnewvalue&&(newvalue=maxheightnewvalue),newvalue>maxwidthtnewvalue&&(newvalue=maxwidthtnewvalue),maxheightnewvalue<=newvalue?(t.heightRatio=t.largeHeight/newvalue/t.nzHeight,newvalue>maxheightnewvalue?t.newvalueheight=maxheightnewvalue:t.newvalueheight=newvalue,t.fullheight=!0):(t.heightRatio=t.largeHeight/newvalue/t.nzHeight,newvalue>maxheightnewvalue?t.newvalueheight=maxheightnewvalue:t.newvalueheight=newvalue,t.fullheight=!1),maxwidthtnewvalue<=newvalue?(t.widthRatio=t.largeWidth/newvalue/t.nzWidth,newvalue>maxwidthtnewvalue?t.newvaluewidth=maxwidthtnewvalue:t.newvaluewidth=newvalue,t.fullwidth=!0):(t.widthRatio=t.largeWidth/newvalue/t.nzWidth,t.newvaluewidth=newvalue,t.fullwidth=!1)),scrcontinue=!1,"inner"==t.options.zoomType&&(t.nzWidth>=t.nzHeight&&(t.newvaluewidth<=maxwidthtnewvalue?scrcontinue=!0:(scrcontinue=!1,t.fullheight=!0,t.fullwidth=!0)),t.nzHeight>t.nzWidth&&(t.newvaluewidth<=maxwidthtnewvalue?scrcontinue=!0:(scrcontinue=!1,t.fullheight=!0,t.fullwidth=!0))),"inner"!=t.options.zoomType&&(scrcontinue=!0),scrcontinue&&(t.zoomLock=0,t.changeZoom=!0,t.options.zoomWindowHeight/t.heightRatio<=t.nzHeight&&(t.currentZoomLevel=t.newvalueheight,"lens"!=t.options.zoomType&&"inner"!=t.options.zoomType&&(t.changeBgSize=!0,t.zoomLens.css({height:String(t.options.zoomWindowHeight/t.heightRatio)+"px"})),("lens"==t.options.zoomType||"inner"==t.options.zoomType)&&(t.changeBgSize=!0)),t.options.zoomWindowWidth/t.widthRatio<=t.nzWidth&&("inner"!=t.options.zoomType&&t.newvaluewidth>t.newvalueheight&&(t.currentZoomLevel=t.newvaluewidth),"lens"!=t.options.zoomType&&"inner"!=t.options.zoomType&&(t.changeBgSize=!0,t.zoomLens.css({width:String(t.options.zoomWindowWidth/t.widthRatio)+"px"})),("lens"==t.options.zoomType||"inner"==t.options.zoomType)&&(t.changeBgSize=!0)),"inner"==t.options.zoomType&&(t.changeBgSize=!0,t.nzWidth>t.nzHeight&&(t.currentZoomLevel=t.newvaluewidth),t.nzHeight>t.nzWidth&&(t.currentZoomLevel=t.newvaluewidth))),t.setPosition(t.currentLoc)},closeAll:function(){self.zoomWindow&&self.zoomWindow.hide(),self.zoomLens&&self.zoomLens.hide(),self.zoomTint&&self.zoomTint.hide()},changeState:function(e){var t=this;"enable"==e&&(t.options.zoomEnabled=!0),"disable"==e&&(t.options.zoomEnabled=!1)}};e.fn.elevateZoom=function(t){return this.each(function(){var n=Object.create(i);n.init(t,this),e.data(this,"elevateZoom",n)})},e.fn.elevateZoom.options={zoomActivation:"hover",zoomEnabled:!0,preloading:1,zoomLevel:1,scrollZoom:!1,scrollZoomIncrement:.1,minZoomLevel:!1,maxZoomLevel:!1,easing:!1,easingAmount:12,lensSize:200,zoomWindowWidth:400,zoomWindowHeight:400,zoomWindowOffetx:0,zoomWindowOffety:0,zoomWindowPosition:1,zoomWindowBgColour:"#fff",lensFadeIn:!1,lensFadeOut:!1,debug:!1,zoomWindowFadeIn:!1,zoomWindowFadeOut:!1,zoomWindowAlwaysShow:!1,zoomTintFadeIn:!1,zoomTintFadeOut:!1,borderSize:4,showLens:!0,borderColour:"#888",lensBorderSize:1,lensBorderColour:"#000",lensShape:"square",zoomType:"window",containLensZoom:!1,lensColour:"white",lensOpacity:.4,lenszoom:!1,tint:!1,tintColour:"#333",tintOpacity:.4,gallery:!1,galleryActiveClass:"zoomGalleryActive",imageCrossfade:!1,constrainType:!1,constrainSize:!1,loadingIcon:!1,cursor:"default",responsive:!0,onComplete:e.noop,onDestroy:function(){},onZoomedImageLoaded:function(){},onImageSwap:e.noop,onImageSwapComplete:e.noop}}(jQuery,window,document),/**
 * Extend jquery with a scrollspy plugin.
 * This watches the window scroll and fires events when elements are scrolled into viewport.
 *
 * throttle() and getTime() taken from Underscore.js
 * https://github.com/jashkenas/underscore
 *
 * @author Copyright 2013 John Smart
 * @license https://raw.github.com/thesmart/jquery-scrollspy/master/LICENSE
 * @see https://github.com/thesmart
 * @version 0.1.2
 **
 ** Edited by Luke Wilson 10/5/15
 ** add a scrollSpy:focus event. Triggers when element is in center of screen
 **
 */
function(e){function t(t,n,o,i){var r=e();return e.each(s,function(e,s){var a=s.offset().top,l=s.offset().left,c=l+s.width(),d=a+s.height(),h=!(l>n||i>c||a>o||t>d);h&&r.push(s)}),r}function n(){++c;var n=r.scrollTop(),o=r.scrollLeft(),i=o+r.width(),s=n+r.height(),l=t(n+d.top,i+d.right,s+d.bottom,o+d.left);e.each(l,function(t,n){var o=n.data("scrollSpy:ticks");"number"!=typeof o&&n.triggerHandler("scrollSpy:enter"),n.data("scrollSpy:ticks",c);var i=.25*r.height(),s=e(n),a=s.offset().top-r.scrollTop(),l=a+s.height();i>a&&l>i&&!s.is(h)&&(h=s,n.triggerHandler("scrollSpy:focus"))}),!h&&l.length>0&&(h=l[0],h.triggerHandler("scrollSpy:focus")),e.each(a,function(e,t){var n=t.data("scrollSpy:ticks");"number"==typeof n&&n!==c&&(t.triggerHandler("scrollSpy:exit"),t.data("scrollSpy:ticks",null))}),a=l}function o(){r.trigger("scrollSpy:winSize")}function i(e,t,n){var o,i,r,s=null,a=0;n||(n={});var l=function(){a=n.leading===!1?0:u(),s=null,r=e.apply(o,i),o=i=null};return function(){var c=u();a||n.leading!==!1||(a=c);var d=t-(c-a);return o=this,i=arguments,0>=d?(clearTimeout(s),s=null,a=c,r=e.apply(o,i),o=i=null):s||n.trailing===!1||(s=setTimeout(l,d)),r}}var r=e(window),s=[],a=[],l=!1,c=0,d={top:0,right:0,bottom:0,left:0},h=null,u=Date.now||function(){return(new Date).getTime()};e.scrollSpy=function(t,o){t=e(t),t.each(function(t,n){s.push(e(n))}),o=o||{throttle:100},d.top=o.offsetTop||0,d.right=o.offsetRight||0,d.bottom=o.offsetBottom||0,d.left=o.offsetLeft||0;var a=i(n,o.throttle||100),c=function(){e(document).ready(a)};return l||(r.on("scroll",c),r.on("resize",c),l=!0),setTimeout(c,0),t},e.winSizeSpy=function(t){return e.winSizeSpy=function(){return r},t=t||{throttle:100},r.on("resize",i(o,t.throttle||100))},e.fn.scrollSpy=function(t){return e.scrollSpy(e(this),t)}}(jQuery),function(){var e,t;e=this.jQuery||window.jQuery,t=e(window),e.fn.stick_in_parent=function(n){var o,i,r,s,a,l,c,d,h,u,f,m;for(null==n&&(n={}),m=n.sticky_class,l=n.inner_scrolling,f=n.recalc_every,u=n.parent,h=n.offset_top,d=n.spacer,r=n.bottoming,null==h&&(h=0),null==u&&(u=void 0),null==l&&(l=!0),null==m&&(m="is_stuck"),o=e(document),null==r&&(r=!0),s=function(n,i,s,a,c,p,g,y){var w,v,b,C,x,N,S,T,E,z,R,_;if(!n.data("sticky_kit")){if(n.data("sticky_kit",!0),x=o.height(),S=n.parent(),null!=u&&(S=S.closest(u)),!S.length)throw"failed to find stick parent";if(b=!1,w=!1,R=null!=d?d&&n.closest(d):e("<div />"),R&&R.css("position",n.css("position")),T=function(){var e,t,r;if(!y)return x=o.height(),e=parseInt(S.css("border-top-width"),10),t=parseInt(S.css("padding-top"),10),i=parseInt(S.css("padding-bottom"),10),s=S.offset().top+e+t,a=S.height(),b&&(b=!1,w=!1,null==d&&(n.insertAfter(R),R.detach()),n.css({position:"",top:"",width:"",bottom:""}).removeClass(m),r=!0),c=n.offset().top-(parseInt(n.css("margin-top"),10)||0)-h,p=n.outerHeight(!0),g=n.css("float"),R&&R.css({width:n.outerWidth(!0),height:p,display:n.css("display"),"vertical-align":n.css("vertical-align"),"float":g}),r?_():void 0},T(),p!==a)return C=void 0,N=h,z=f,_=function(){var e,u,v,E,_,A;if(!y)return v=!1,null!=z&&(z-=1,0>=z&&(z=f,T(),v=!0)),v||o.height()===x||(T(),v=!0),E=t.scrollTop(),null!=C&&(u=E-C),C=E,b?(r&&(_=E+p+N>a+s,w&&!_&&(w=!1,n.css({position:"fixed",bottom:"",top:N}).trigger("sticky_kit:unbottom"))),c>E&&(b=!1,N=h,null==d&&(("left"===g||"right"===g)&&n.insertAfter(R),R.detach()),e={position:"",width:"",top:""},n.css(e).removeClass(m).trigger("sticky_kit:unstick")),l&&(A=t.height(),p+h>A&&(w||(N-=u,N=Math.max(A-p,N),N=Math.min(h,N),b&&n.css({top:N+"px"}))))):E>c&&(b=!0,e={position:"fixed",top:N},e.width="border-box"===n.css("box-sizing")?n.outerWidth()+"px":n.width()+"px",n.css(e).addClass(m),null==d&&(n.after(R),("left"===g||"right"===g)&&R.append(n)),n.trigger("sticky_kit:stick")),b&&r&&(null==_&&(_=E+p+N>a+s),!w&&_)?(w=!0,"static"===S.css("position")&&S.css({position:"relative"}),n.css({position:"absolute",bottom:i,top:"auto"}).trigger("sticky_kit:bottom")):void 0},E=function(){return T(),_()},v=function(){return y=!0,t.off("touchmove",_),t.off("scroll",_),t.off("resize",E),e(document.body).off("sticky_kit:recalc",E),n.off("sticky_kit:detach",v),n.removeData("sticky_kit"),n.css({position:"",bottom:"",top:"",width:""}),S.position("position",""),b?(null==d&&(("left"===g||"right"===g)&&n.insertAfter(R),R.remove()),n.removeClass(m)):void 0},t.on("touchmove",_),t.on("scroll",_),t.on("resize",E),e(document.body).on("sticky_kit:recalc",E),n.on("sticky_kit:detach",v),setTimeout(_,0)}},a=0,c=this.length;c>a;a++)i=this[a],s(e(i));return this}}.call(this),Number.prototype.map=function(e,t,n,o){return(this-e)*(o-n)/(t-e)+n},Number.prototype.clamp=function(e,t){return Math.min(Math.max(this,e),t)};var getCurrentLesson=function(){var e,t=$(".scrollspy-section");if(t.length>0){var n=t.first().prop("id"),o=n.indexOf("-");e="core_"+n.substring(0,o)}else{var i=window.location.pathname.lastIndexOf("/")+1;e=window.location.pathname.substring(i)}return e},CourseData=function(e){this.prompt=e.prompt,this.response=e.response,this.dataType=e.dataType,this.lesson=currentLesson||getCurrentLesson(),this.challengeId=e.challengeId,focus.$section?(this.section=focus.$section.prop("id"),this.timeInSection=focus.getTimeInSection()):(this.section=void 0,this.timeInSection=void 0),this.serializeData=function(){return{section:this.section,time_in_section:Math.round(this.timeInSection/1e3)||void 0,prompt:this.prompt,response:this.response,data_type:this.dataType,lesson:this.lesson,challenge_id:this.challengeId}},this.sendToServer=function(){return $.ajax({method:"POST",url:"/course_data",data:this.serializeData()})}},currentLesson=null,$window=$(window),focus={$section:null,handleFocusNewSection:function(e){this.$section&&this.sendSectionTimeData(this.$section),this.$section=$(e),this.$section.data("startTime",(new Date).getTime()),this.highlightFocusedSection(),this.updateAllProgressBars()},handleWindowScroll:function(){this.isAFK&&(this.isAFK=!1,this.$section.data("startTime",(new Date).getTime())),this.updateFocusedProgressBar(),this.sendSectionTimeDataOnceAFK()},updateFocusedProgressBar:function(){if(this.$section){var e=.25*$window.height(),t=this.$section.offset().top-$window.scrollTop(),n=t+this.$section.height(),o=e.map(t,n,0,100),i=this.getFocusedSidebarLink().siblings(".section-progress-container").children().eq(0);i.css("height",o.clamp(0,100)+"%")}},getFocusedSidebarLink:function(){return $('.sidebar a[href="#'+this.$section.attr("id")+'"]')},updateAllProgressBars:function(){var e=this.getFocusedSidebarLink(),t=e.closest("div.active").find(".section-progress");t.each(function(t,n){var o=$(n);o.offset().top<e.offset().top?o.parent().find(".section-progress").css("height","100%"):o.offset().top>e.offset().top&&o.parent().find(".section-progress").css("height","0%")})},highlightFocusedSection:function(){$newLink=this.getFocusedSidebarLink(),$newLink.closest("div.active").find(".active").removeClass("active"),$newLink.parent().addClass("active"),$newLink.closest("li").parent().parent().addClass("active")},getTimeInSection:function(){return(new Date).getTime()-focus.$section.data("startTime")},sendSectionTimeData:function(){var e=new CourseData({dataType:"section time"});e.timeInSection>5e3&&e.sendToServer()},sendSectionTimeBecauseAFK:function(){this.isAFK=!0,this.sendSectionTimeData()},sendSectionTimeDataOnceAFK:null,isAFK:!1};focus.sendSectionTimeDataOnceAFK=_.debounce(focus.sendSectionTimeBecauseAFK,6e5);var setupChallengeImage=function(e){e.hide();var t=$('<div class="button small">I think I got it</div>'),n=$('<div class="button small">Can\'t figure it out</div>'),o=$('<div class="button small">Don\'t want to try</div>'),i=[t,n,o],r=$('<div class="button-group"><h4 class="text-center">How did you do?</h4></div>');r.append('<p class ="text-center" style="font-size: 0.8rem;margin: -8px 0 0 0;">Select an option to view the answer</p>'),r.append(i),r.append('<p class="text-center" style="font-size: 0.8rem;">This data helps us craft our challenges and is not given to your instructor. <em>We encourage you to give us specific feedback too!</em></p>'),$buttons=r.find("div.button"),e.before(r),$buttons.click(function(){$button=$(this);var t=new CourseData({prompt:$button.closest(".challenge").children("p").text(),response:$button.text(),challengeId:$button.closest(".challenge").prop("id"),dataType:"challenge answer"});t.sendToServer(),r.slideUp(400),e.slideDown(400,function(){zoomOnImage(e)})})},reloadZoomImages=function(){$(".zoomed").each(function(){zoomOnImage($(this))})},zoomOnImage=function(e){e.addClass("zoomed"),e.elevateZoom({zoomType:"inner",cursor:"crosshair",zoomWindowFadeIn:300,zoomWindowFadeOut:300})},setupImages=function(){var e=$("img.zoomable, .not-zoomable");e.each(function(e,t){var n=$(t),o=$(document.createElement("DIV"));o.addClass("text-center image-container"),"P"===n.parent().prop("tagName")&&n.unwrap(),n.wrap(o),n.attr("data-zoom-image",n.attr("src")),"Challenge Answer"===n.attr("alt")?setupChallengeImage(n):n.hasClass("zoomable")&&zoomOnImage(n)})},setupScrollSpy=function(){$(".scrollspy-section").on("scrollSpy:focus",function(){focus.handleFocusNewSection(this)}),$(window).scroll(function(){focus.handleWindowScroll()}),$(".scrollspy-section").scrollSpy()},stopFeedbackButtonBounce=function(){$(".open-feedback-button").removeClass("bounce")},startFeedbackButtonBounce=function(){$(".open-feedback-button").addClass("bounce")},bounceFeedbackButtonAfterDelay=_.debounce(startFeedbackButtonBounce,42e4),resetFeedbackFormDelayed=function(){setTimeout(function(){$(".feedback-form-container").removeClass("open").fadeOut(400,function(){$("#feedback-form textarea").val(""),$(".submit-feedback-button").removeClass("success alert"),$(".submit-feedback-button span").text("Send!")})},400)},submitFeedbackForm=function(){var e=$("#feedback-form").serializeArray(),t=new CourseData({prompt:e[0].value,response:e[1].value,dataType:"feedback"});t.sendToServer().done(function(){$(".submit-feedback-button").addClass("success"),$(".submit-feedback-button i").removeClass(),$(".submit-feedback-button span").text("Sent!"),resetFeedbackFormDelayed()}).fail(function(){$(".submit-feedback-button").addClass("alert"),$(".submit-feedback-button i").removeClass(),$(".submit-feedback-button span").text("Try again!")}),$(".submit-feedback-button").removeClass("success alert"),$(".submit-feedback-button i").addClass("fa fa-circle-o-notch fa-spin"),$(".submit-feedback-button span").text("")},setupFeedbackListeners=function(){$(".open-feedback-button").click(function(e){$(".feedback-form-container").addClass("open").fadeIn(),stopFeedbackButtonBounce(),bounceFeedbackButtonAfterDelay()}),$(".close-feedback-button").click(function(e){$(".feedback-form-container").removeClass("open").fadeOut()}),$(".submit-feedback-button").click(_.debounce(submitFeedbackForm,3e3,!0)),$(document).click(function(e){$.contains($(".feedback")[0],e.target)||$(".feedback-form-container").removeClass("open").fadeOut()})},submitChangeThisLessonForm=function(){var e=$("#change-this-lesson-form").serializeArray(),t=new CourseData({prompt:"How would you change this lesson?",response:e[0].value,dataType:"feedback"});t.sendToServer().done(function(){$(".submit-change-this-lesson-button").addClass("success"),$(".submit-change-this-lesson-button i").removeClass(),$(".submit-change-this-lesson-button span").text("Sent!"),$("#change-this-lesson-form textarea").val("")}).fail(function(){$(".submit-change-this-lesson-button").addClass("alert"),$(".submit-change-this-lesson-button i").removeClass(),$(".submit-change-this-lesson-button span").text("Try again!")}),$(".submit-change-this-lesson-button").removeClass("success alert"),$(".submit-change-this-lesson-button i").addClass("fa fa-circle-o-notch fa-spin"),$(".submit-change-this-lesson-button span").text("")},setupChangeThisLessonListeners=function(){$(".submit-change-this-lesson-button").click(_.debounce(submitChangeThisLessonForm,3e3,!0))},closeSidebar=function(){var e=$(".menu-toggle"),t=e.find("i");$(".sidebar").removeClass("open"),e.removeClass("open"),t.removeClass("fa-caret-left"),t.addClass("fa-caret-right")},openSidebar=function(){var e=$(".menu-toggle"),t=e.find("i");$(".sidebar").addClass("open"),e.addClass("open"),t.removeClass("fa-caret-right"),t.addClass("fa-caret-left")},setupMenuToggleListeners=function(){$(".menu-toggle").click(function(){var e=$(".menu-toggle");e.find("i");e.hasClass("open")?closeSidebar():openSidebar()})},updateSidebar=function(){$(window).width()<=640?closeSidebar():openSidebar()},updateVideos=function(){$("video").each(function(e,t){var n=$(t),o=n.siblings("div");o.css({height:""+(n.height()-35)+"px",width:""+n.width()+"px"})})},setupVideos=function(){$("video").each(function(e,t){var n=$(t),o=$(document.createElement("DIV"));o.css({position:"absolute",height:""+n.height()+"px",width:""+n.width()+"px",cursor:"pointer","z-index":100}),n.parent().prepend(o),o.click(function(){t.paused?t.play():t.pause()})})},handleResize=function(){$(".zoomContainer").remove(),reloadZoomImages(),updateVideos(),updateSidebar()},debouncedHandleResize=_.debounce(handleResize,500);$(window).resize(function(){debouncedHandleResize()});var setupStickySidebar=function(){$(".sidebar-content").stick_in_parent({offset_top:0}).on("sticky_kit:stick",function(e){$(".hidden-at-top").addClass("visible")}).on("sticky_kit:unstick",function(e){$(".hidden-at-top").removeClass("visible")}),setTimeout(function(){$("body").trigger("sticky_kit:recalc")},500)};$(document).ready(function(){currentLesson=getCurrentLesson(),setupScrollSpy(),setupFeedbackListeners(),setupChangeThisLessonListeners(),setupImages(),bounceFeedbackButtonAfterDelay(),setupStickySidebar(),setupMenuToggleListeners(),setupVideos(),updateSidebar()}),$(function(){$('a[href^="#"]:not([href="#"])').click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var e=$(this.hash),t=this.hash;if(e=e.length?e:$("[name="+this.hash.slice(1)+"]"),e.length)return $("html,body").animate({scrollTop:e.offset().top-20},{duration:1e3,done:function(){window.location.hash=t}}),!1}})});var wysihtml5ParserRules={classes:{"wysiwyg-clear-both":1,"wysiwyg-clear-left":1,"wysiwyg-clear-right":1,"wysiwyg-color-aqua":1,"wysiwyg-color-black":1,"wysiwyg-color-blue":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-gray":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-maroon":1,"wysiwyg-color-navy":1,"wysiwyg-color-olive":1,"wysiwyg-color-purple":1,"wysiwyg-color-red":1,"wysiwyg-color-silver":1,"wysiwyg-color-teal":1,"wysiwyg-color-white":1,"wysiwyg-color-yellow":1,"wysiwyg-float-left":1,"wysiwyg-float-right":1,"wysiwyg-font-size-large":1,"wysiwyg-font-size-larger":1,"wysiwyg-font-size-medium":1,"wysiwyg-font-size-small":1,"wysiwyg-font-size-smaller":1,"wysiwyg-font-size-x-large":1,"wysiwyg-font-size-x-small":1,"wysiwyg-font-size-xx-large":1,"wysiwyg-font-size-xx-small":1,"wysiwyg-text-align-center":1,"wysiwyg-text-align-justify":1,"wysiwyg-text-align-left":1,"wysiwyg-text-align-right":1},tags:{tr:{add_class:{align:"align_text"}},strike:{remove:1},form:{rename_tag:"div"},rt:{rename_tag:"span"},code:{},acronym:{rename_tag:"span"},br:{add_class:{clear:"clear_br"}},details:{rename_tag:"div"},h4:{add_class:{align:"align_text"}},em:{},title:{remove:1},multicol:{rename_tag:"div"},figure:{rename_tag:"div"},xmp:{rename_tag:"span"},small:{rename_tag:"span",set_class:"wysiwyg-font-size-smaller"},area:{remove:1},time:{rename_tag:"span"},dir:{rename_tag:"ul"},bdi:{rename_tag:"span"},command:{remove:1},ul:{},progress:{rename_tag:"span"},dfn:{rename_tag:"span"},iframe:{remove:1},figcaption:{rename_tag:"div"},a:{check_attributes:{target:"any",href:"url"},set_attributes:{rel:"nofollow"}},img:{check_attributes:{width:"dimension",alt:"alt",src:"url",height:"dimension"},add_class:{align:"align_img"}},rb:{rename_tag:"span"},footer:{rename_tag:"div"},noframes:{remove:1},abbr:{rename_tag:"span"},u:{},bgsound:{remove:1},address:{rename_tag:"div"},basefont:{remove:1},nav:{rename_tag:"div"},h1:{add_class:{align:"align_text"}},head:{remove:1},tbody:{add_class:{align:"align_text"}},dd:{rename_tag:"div"},s:{rename_tag:"span"},li:{},td:{check_attributes:{rowspan:"numbers",colspan:"numbers"},add_class:{align:"align_text"}},object:{remove:1},div:{add_class:{align:"align_text"}},option:{rename_tag:"span"},select:{rename_tag:"span"},i:{},track:{remove:1},wbr:{remove:1},fieldset:{rename_tag:"div"},big:{rename_tag:"span",set_class:"wysiwyg-font-size-larger"},button:{rename_tag:"span"},noscript:{remove:1},svg:{remove:1},input:{remove:1},table:{},keygen:{remove:1},h5:{add_class:{align:"align_text"}},meta:{remove:1},map:{rename_tag:"div"},isindex:{remove:1},mark:{rename_tag:"span"},caption:{add_class:{align:"align_text"}},tfoot:{add_class:{align:"align_text"}},base:{remove:1},video:{remove:1},strong:{},canvas:{remove:1},output:{rename_tag:"span"},marquee:{rename_tag:"span"},b:{},q:{check_attributes:{cite:"url"}},applet:{remove:1},span:{},rp:{rename_tag:"span"},spacer:{remove:1},source:{remove:1},aside:{rename_tag:"div"},frame:{remove:1},section:{rename_tag:"div"},body:{rename_tag:"div"},ol:{},nobr:{rename_tag:"span"},html:{rename_tag:"div"},summary:{rename_tag:"span"},"var":{rename_tag:"span"},del:{remove:1},blockquote:{check_attributes:{cite:"url"}},style:{remove:1},device:{remove:1},meter:{rename_tag:"span"},h3:{add_class:{align:"align_text"}},textarea:{rename_tag:"span"},embed:{remove:1},hgroup:{rename_tag:"div"},font:{rename_tag:"span",add_class:{size:"size_font"}},tt:{rename_tag:"span"},noembed:{remove:1},thead:{add_class:{align:"align_text"}},blink:{rename_tag:"span"},plaintext:{rename_tag:"span"},xml:{remove:1},h6:{add_class:{align:"align_text"}},param:{remove:1},th:{check_attributes:{rowspan:"numbers",colspan:"numbers"},add_class:{align:"align_text"}},legend:{rename_tag:"span"},hr:{},label:{rename_tag:"span"},dl:{rename_tag:"div"},kbd:{rename_tag:"span"},listing:{rename_tag:"div"},dt:{rename_tag:"span"},nextid:{remove:1},pre:{},center:{rename_tag:"div",set_class:"wysiwyg-text-align-center"},audio:{remove:1},datalist:{rename_tag:"span"},samp:{rename_tag:"span"},col:{remove:1},article:{rename_tag:"div"},cite:{},link:{remove:1},script:{remove:1},bdo:{rename_tag:"span"},menu:{rename_tag:"ul"},colgroup:{remove:1},ruby:{rename_tag:"span"},h2:{add_class:{align:"align_text"}},ins:{rename_tag:"span"},p:{add_class:{align:"align_text"}},sub:{},comment:{remove:1},frameset:{remove:1},optgroup:{rename_tag:"span"},header:{rename_tag:"div"},sup:{}}},wysihtml5={version:"0.5.0-beta13",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",INVISIBLE_SPACE_REG_EXP:/\uFEFF/g,EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,TAB_KEY:9,DELETE_KEY:46};wysihtml5.polyfills=function(e,t){String.prototype.trim||!function(){var e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(e,"")}}(),function(){var n="addEventListener",o="removeEventListener";t[n]||(e.Element.prototype[n]=e[n]=t[n]=function(t,n,o){return(o=this).attachEvent("on"+t,function(t){var t=t||e.event;t.target=t.target||t.srcElement,t.preventDefault=t.preventDefault||function(){t.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){t.cancelBubble=!0},t.which=t.button?2===t.button?3:4===t.button?2:t.button:t.keyCode,n.call(o,t)})},e.Element.prototype[o]=e[o]=t[o]=function(e,t){return this.detachEvent("on"+e,t)})}(),Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(e.Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(e.Element.prototype,"textContent").get&&!function(){var t=Object.getOwnPropertyDescriptor(e.Element.prototype,"innerText");Object.defineProperty(e.Element.prototype,"textContent",{get:function(){return t.get.call(this)},set:function(e){return t.set.call(this,e)}})}(),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=this.length,o=-1,i=t>>>0;~(n-i);o=this[--n]===e?n:o);return o}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,o=function(){},i=function(){return n.apply(this instanceof o&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,i.prototype=new o,i}),e.Element&&function(e){e.matches=e.matches||e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=this,n=(t.parentNode||t.document).querySelectorAll(e),o=-1;n[++o]&&n[o]!=t;);return!!n[o]}}(e.Element.prototype),"document"in e&&("classList"in t.createElement("_")?"DOMTokenList"in e&&!function(){"use strict";var n=t.createElement("_");if(n.classList.add("c1","c2"),!n.classList.contains("c2")){var o=function(t){var n=e.DOMTokenList.prototype[t];e.DOMTokenList.prototype[t]=function(e){var t,o=arguments.length;for(t=0;o>t;t++)e=arguments[t],n.call(this,e)}};o("add"),o("remove")}if(n.classList.toggle("c3",!1),n.classList.contains("c3")){var i=e.DOMTokenList.prototype.toggle;e.DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:i.call(this,e)}}n=null}():!function(e){"use strict";if("Element"in e){var t="classList",n="prototype",o=e.Element[n],i=Object,r=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[n].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},a=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new a("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new a("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(e,t)},c=function(e){for(var t=r.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],o=0,i=n.length;i>o;o++)this.push(n[o]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},d=c[n]=[],h=function(){return new c(this)};if(a[n]=Error[n],d.item=function(e){return this[e]||null},d.contains=function(e){return e+="",-1!==l(this,e)},d.add=function(){var e,t=arguments,n=0,o=t.length,i=!1;do e=t[n]+"",-1===l(this,e)&&(this.push(e),i=!0);while(++n<o);i&&this._updateClassName()},d.remove=function(){var e,t,n=arguments,o=0,i=n.length,r=!1;do for(e=n[o]+"",t=l(this,e);-1!==t;)this.splice(t,1),r=!0,t=l(this,e);while(++o<i);r&&this._updateClassName()},d.toggle=function(e,t){e+="";var n=this.contains(e),o=n?t!==!0&&"remove":t!==!1&&"add";return o&&this[o](e),t===!0||t===!1?t:!n},d.toString=function(){return this.join(" ")},i.defineProperty){var u={get:h,enumerable:!0,configurable:!0};try{i.defineProperty(o,t,u)}catch(f){-2146823252===f.number&&(u.enumerable=!1,i.defineProperty(o,t,u))}}else i[n].__defineGetter__&&o.__defineGetter__(t,h)}}(e));var n=function(){if("createRange"in document&&"getSelection"in window){var e,t,n=document.createElement("div"),o=document.createTextNode("a"),i=document.createTextNode("a"),r=document.createTextNode("a"),s=document.createRange();return n.setAttribute("contenteditable","true"),n.appendChild(o),n.appendChild(i),n.appendChild(r),document.body.appendChild(n),s.setStart(i,1),s.setEnd(i,1),e=window.getSelection(),e.removeAllRanges(),e.addRange(s),n.normalize(),e=window.getSelection(),t=1!==n.childNodes.length||e.anchorNode!==n.firstChild||2!==e.anchorOffset,n.parentNode.removeChild(n),e.removeAllRanges(),t}},o=function(e){var t=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?t.push(e):t=t.concat(o(e));return t},i=function(){var e=(Node.prototype.normalize,function(){var e=o(this),t=this.ownerDocument.defaultView.getSelection(),n=t.anchorNode,i=t.anchorOffset,r=n&&1===n.nodeType&&n.childNodes.length>0?n.childNodes[i]:void 0,s=t.focusNode,a=t.focusOffset,l=s&&1===s.nodeType&&a>0?s.childNodes[a-1]:void 0,c=this.ownerDocument.createRange(),d=e.shift(),h=d?e.shift():null;for((n===s&&i>a||n!==s&&n.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_PRECEDING&&!(n.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_CONTAINS))&&(s=[n,n=s][0],a=[i,i=a][0]);d&&h;)h.previousSibling&&h.previousSibling===d?(n===h&&(n=d,i=d.nodeValue.length+i),s===h&&(s=d,a=d.nodeValue.length+a),d.nodeValue=d.nodeValue+h.nodeValue,h.parentNode.removeChild(h),h=e.shift()):(d=h,h=e.shift());l&&(a=Array.prototype.indexOf.call(l.parentNode.childNodes,l)+1),r&&(i=Array.prototype.indexOf.call(r.parentNode.childNodes,r)),n&&n.parentNode&&s&&s.parentNode&&(c.setStart(n,i),c.setEnd(s,a),t.removeAllRanges(),t.addRange(c))});Node.prototype.normalize=e};"Node"in window&&"normalize"in Node.prototype&&n()&&i()},wysihtml5.polyfills(window,document),/**
 * Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */
function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){function e(e,t){var n=typeof e[t];return n==b||!(n!=v||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=v||!e[t])}function n(e,t){return typeof e[t]!=C}function o(e){return function(t,n){for(var o=n.length;o--;)if(!e(t,n[o]))return!1;return!0}}function i(e){return e&&E(e,T)&&R(e,S)}function r(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function s(t){typeof console!=C&&e(console,"log")&&console.log(t)}function a(e,t){L&&t?alert(e):s(e)}function l(e){O.initialized=!0,O.supported=!1,a("Rangy is not supported in this environment. Reason: "+e,O.config.alertOnFail)}function c(e){a("Rangy warning: "+e,O.config.alertOnWarn)}function d(e){return e.message||e.description||String(e)}function h(){if(L&&!O.initialized){var t,n=!1,o=!1;e(document,"createRange")&&(t=document.createRange(),E(t,N)&&R(t,x)&&(n=!0));var a=r(document);if(!a||"body"!=a.nodeName.toLowerCase())return void l("No body element found");if(a&&e(a,"createTextRange")&&(t=a.createTextRange(),i(t)&&(o=!0)),!n&&!o)return void l("Neither Range nor TextRange are available");O.initialized=!0,O.features={implementsDomRange:n,implementsTextRange:o};var c,h;for(var u in A)(c=A[u])instanceof p&&c.init(c,O);for(var f=0,m=D.length;m>f;++f)try{D[f](O)}catch(g){h="Rangy init listener threw an exception. Continuing. Detail: "+d(g),s(h)}}}function u(e,t,n){n&&(e+=" in module "+n.name),O.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function f(e,t,n,o){e[t]=function(){return u(t,n,o),e[n].apply(e,k.toArray(arguments))}}function m(e){e=e||window,h();for(var t=0,n=W.length;n>t;++t)W[t](e)}function p(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function g(e,t,n){var o=new p(e,t,function(t){if(!t.initialized){t.initialized=!0;try{n(O,t),t.supported=!0}catch(o){var i="Module '"+e+"' failed to load: "+d(o);s(i),o.stack&&s(o.stack)}}});return A[e]=o,o}function y(){}function w(){}var v="object",b="function",C="undefined",x=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],N=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],S=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],T=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],E=o(e),z=o(t),R=o(n),_=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,o=e.length;o>n;++n)t(e[n],n)},A={},L=typeof window!=C&&typeof document!=C,k={isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:E,areHostObjects:z,areHostProperties:R,isTextRange:i,getBody:r,forEach:_},O={version:"1.3.0",initialized:!1,isBrowser:L,supported:!0,util:k,features:{},modules:A,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==C?!0:rangyAutoInitialize}};O.fail=l,O.warn=c;var I;({}).hasOwnProperty?(k.extend=I=function(e,t,n){var o,i;for(var r in t)t.hasOwnProperty(r)&&(o=e[r],i=t[r],n&&null!==o&&"object"==typeof o&&null!==i&&"object"==typeof i&&I(o,i,!0),e[r]=i);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},k.createOptions=function(e,t){var n={};return I(n,t),e&&I(n,e),n}):l("hasOwnProperty not supported"),L||l("Rangy can only run in a browser"),function(){var e;if(L){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(o){}}e||(e=function(e){for(var t=[],n=0,o=e.length;o>n;++n)t[n]=e[n];return t}),k.toArray=e}();var P;L&&(e(document,"addEventListener")?P=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?P=function(e,t,n){e.attachEvent("on"+t,n)}:l("Document does not have required addEventListener or attachEvent method"),k.addListener=P);var D=[];k.deprecationNotice=u,k.createAliasForDeprecatedMethod=f,O.init=h,O.addInitListener=function(e){O.initialized?e(O):D.push(e)};var W=[];O.addShimListener=function(e){W.push(e)},L&&(O.shim=O.createMissingNativeApi=m,f(O,"createMissingNativeApi","shim")),p.prototype={init:function(){for(var e,t,n=this.dependencies||[],o=0,i=n.length;i>o;++o){if(t=n[o],e=A[t],!(e&&e instanceof p))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){O.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){O.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},O.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var o=g(e,n,t);O.initialized&&O.supported&&o.init()},O.createCoreModule=function(e,t,n){g(e,t,n)},O.RangePrototype=y,O.rangePrototype=new y,O.selectionPrototype=new w,O.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==L||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function o(e){var t=e.parentNode;return 1==t.nodeType?t:null}function i(e){for(var t=0;e=e.previousSibling;)++t;return t}function r(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function s(e,t){var n,o=[];for(n=e;n;n=n.parentNode)o.push(n);for(n=t;n;n=n.parentNode)if(D(o,n))return n;return null}function a(e,t,n){for(var o=n?t:t.parentNode;o;){if(o===e)return!0;o=o.parentNode}return!1}function l(e,t){return a(e,t,!0)}function c(e,t,n){for(var o,i=n?e:e.parentNode;i;){if(o=i.parentNode,o===t)return i;i=o}return null}function d(e){var t=e.nodeType;return 3==t||4==t||8==t}function h(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function u(e,t){var n=t.nextSibling,o=t.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e}function f(e,t,n){var o=e.cloneNode(!1);if(o.deleteData(0,t),e.deleteData(t,e.length-t),u(o,e),n)for(var r,s=0;r=n[s++];)r.node==e&&r.offset>t?(r.node=o,r.offset-=t):r.node==e.parentNode&&r.offset>i(e)&&++r.offset;return o}function m(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=L)return e.ownerDocument;if(typeof e.document!=L)return e.document;if(e.parentNode)return m(e.parentNode);throw t.createError("getDocument: no document found for node")}function p(e){var n=m(e);if(typeof n.defaultView!=L)return n.defaultView;if(typeof n.parentWindow!=L)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function g(e){if(typeof e.contentDocument!=L)return e.contentDocument;if(typeof e.contentWindow!=L)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function y(e){if(typeof e.contentWindow!=L)return e.contentWindow;if(typeof e.contentDocument!=L)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function w(e){return e&&k.isHostMethod(e,"setTimeout")&&k.isHostObject(e,"document")}function v(e,t,n){var o;if(e?k.isHostProperty(e,"nodeType")?o=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?g(e):m(e):w(e)&&(o=e.document):o=document,!o)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return o}function b(e){for(var t;t=e.parentNode;)e=t;return e}function C(e,n,o,r){var a,l,d,h,u;if(e==o)return n===r?0:r>n?-1:1;if(a=c(o,e,!0))return n<=i(a)?-1:1;if(a=c(e,o,!0))return i(a)<r?-1:1;if(l=s(e,o),!l)throw new Error("comparePoints error: nodes have no common ancestor");if(d=e===l?l:c(e,l,!0),h=o===l?l:c(o,l,!0),d===h)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(u=l.firstChild;u;){if(u===d)return-1;if(u===h)return 1;u=u.nextSibling}}function x(e){var t;try{return t=e.parentNode,!1}catch(n){return!0}}function N(e){if(!e)return"[No node]";if(W&&x(e))return"[Broken node]";if(d(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+i(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function S(e){for(var t,n=m(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function T(e,t,n){var o=O(e),i=e.createElement("div");i.contentEditable=""+!!n,t&&(i.innerHTML=t);var r=o.firstChild;return r?o.insertBefore(i,r):o.appendChild(i),i}function E(e){return e.parentNode.removeChild(e)}function z(e){this.root=e,this._next=e}function R(e){return new z(e)}function _(e,t){this.node=e,this.offset=t}function A(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var L="undefined",k=e.util,O=k.getBody;k.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),k.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var I=document.createElement("div");k.areHostMethods(I,["insertBefore","appendChild","cloneNode"]||!k.areHostObjects(I,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),k.isHostProperty(I,"innerHTML")||t.fail("Element is missing innerHTML property");var P=document.createTextNode("test");k.areHostMethods(P,["splitText","deleteData","insertData","appendData","cloneNode"]||!k.areHostObjects(I,["previousSibling","nextSibling","childNodes","parentNode"])||!k.areHostProperties(P,["data"]))||t.fail("Incomplete Text Node implementation");var D=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},W=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",W=x(n),e.features.crashyTextNodes=W}();var B;typeof window.getComputedStyle!=L?B=function(e,t){return p(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=L?B=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),z.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},_.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+N(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},A.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},A.prototype.toString=function(){return this.message},e.dom={arrayContains:D,isHtmlNamespace:n,parentElement:o,getNodeIndex:i,getNodeLength:r,getCommonAncestor:s,isAncestorOf:a,isOrIsAncestorOf:l,getClosestAncestorIn:c,isCharacterDataNode:d,isTextOrCommentNode:h,insertAfter:u,splitDataNode:f,getDocument:m,getWindow:p,getIframeWindow:y,getIframeDocument:g,getBody:O,isWindow:w,getContentDocument:v,getRootContainer:b,comparePoints:C,isBrokenNode:x,inspectNode:N,getComputedStyleProperty:B,createTestElement:T,removeNode:E,fragmentFromNodeChildren:S,createIterator:R,DomPosition:_},e.DOMException=A}),O.createCoreModule("DomRange",["DomUtil"],function(e,t){function n(e,t){return 3!=e.nodeType&&($(e,t.startContainer)||$(e,t.endContainer))}function o(e){return e.document||F(e.startContainer)}function i(e){return K(e.startContainer)}function r(e){return new W(e.parentNode,M(e))}function s(e){return new W(e.parentNode,M(e)+1)}function a(e,t,n){var o=11==e.nodeType?e.firstChild:e;return H(t)?n==t.length?P.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:q(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),o}function l(e,t,n){if(T(e),T(t),o(t)!=o(e))throw new B("WRONG_DOCUMENT_ERR");var i=V(e.startContainer,e.startOffset,t.endContainer,t.endOffset),r=V(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?0>=i&&r>=0:0>i&&r>0}function c(e){for(var t,n,i,r=o(e.range).createDocumentFragment();n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(i=e.getSubtreeIterator(),n.appendChild(c(i)),i.detach()),10==n.nodeType)throw new B("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function d(e,t,n){var o,i;n=n||{stop:!1};for(var r,s;r=e.next();)if(e.isPartiallySelectedSubtree()){if(t(r)===!1)return void(n.stop=!0);if(s=e.getSubtreeIterator(),d(s,t,n),s.detach(),n.stop)return}else for(o=P.createIterator(r);i=o.next();)if(t(i)===!1)return void(n.stop=!0)}function h(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),h(t),t.detach()):e.remove()}function u(e){for(var t,n,i=o(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(u(n)),n.detach()):e.remove(),10==t.nodeType)throw new B("HIERARCHY_REQUEST_ERR");i.appendChild(t)}return i}function f(e,t,n){var o,i=!(!t||!t.length),r=!!n;i&&(o=new RegExp("^("+t.join("|")+")$"));var s=[];return d(new p(e,!1),function(t){if((!i||o.test(t.nodeType))&&(!r||n(t))){var a=e.startContainer;if(t!=a||!H(a)||e.startOffset!=a.length){var l=e.endContainer;t==l&&H(l)&&0==e.endOffset||s.push(t)}}}),s}function m(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+P.inspectNode(e.startContainer)+":"+e.startOffset+", "+P.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function p(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&H(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||H(this.sc)?j(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||H(this.ec)?j(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function g(e){return function(t,n){for(var o,i=n?t:t.parentNode;i;){if(o=i.nodeType,X(e,o))return i;i=i.parentNode}return null}}function y(e,t){if(ie(e,t))throw new B("INVALID_NODE_TYPE_ERR")}function w(e,t){if(!X(t,e.nodeType))throw new B("INVALID_NODE_TYPE_ERR")}function v(e,t){if(0>t||t>(H(e)?e.length:e.childNodes.length))throw new B("INDEX_SIZE_ERR")}function b(e,t){if(ne(e,!0)!==ne(t,!0))throw new B("WRONG_DOCUMENT_ERR")}function C(e){if(oe(e,!0))throw new B("NO_MODIFICATION_ALLOWED_ERR")}function x(e,t){if(!e)throw new B(t)}function N(e,t){return t<=(H(e)?e.length:e.childNodes.length)}function S(e){return!!e.startContainer&&!!e.endContainer&&!(Y&&(P.isBrokenNode(e.startContainer)||P.isBrokenNode(e.endContainer)))&&K(e.startContainer)==K(e.endContainer)&&N(e.startContainer,e.startOffset)&&N(e.endContainer,e.endOffset)}function T(e){if(!S(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function E(e,t){T(e);var n=e.startContainer,o=e.startOffset,i=e.endContainer,r=e.endOffset,s=n===i;H(i)&&r>0&&r<i.length&&q(i,r,t),H(n)&&o>0&&o<n.length&&(n=q(n,o,t),s?(r-=o,i=n):i==n.parentNode&&r>=M(n)&&r++,o=0),e.setStartAndEnd(n,o,i,r)}function z(e){T(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function R(e){e.START_TO_START=de,e.START_TO_END=he,e.END_TO_END=ue,e.END_TO_START=fe,e.NODE_BEFORE=me,e.NODE_AFTER=pe,e.NODE_BEFORE_AND_AFTER=ge,e.NODE_INSIDE=ye}function _(e){R(e),R(e.prototype)}function A(e,t){return function(){T(this);var n,o,i=this.startContainer,r=this.startOffset,a=this.commonAncestorContainer,l=new p(this,!0);i!==a&&(n=j(i,a,!0),o=s(n),i=o.node,r=o.offset),d(l,C),l.reset();var c=e(l);return l.detach(),t(this,i,r,i,r),c}}function L(t,o){function i(e,t){return function(n){w(n,G),w(K(n),Q);var o=(e?r:s)(n);(t?a:l)(this,o.node,o.offset)}}function a(e,t,n){var i=e.endContainer,r=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((K(t)!=K(i)||1==V(t,n,i,r))&&(i=t,r=n),o(e,t,n,i,r))}function l(e,t,n){var i=e.startContainer,r=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((K(t)!=K(i)||-1==V(t,n,i,r))&&(i=t,r=n),o(e,i,r,t,n))}var c=function(){};c.prototype=e.rangePrototype,t.prototype=new c,D.extend(t.prototype,{setStart:function(e,t){y(e,!0),v(e,t),a(this,e,t)},setEnd:function(e,t){y(e,!0),v(e,t),l(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],i=t,r=n;switch(e.length){case 3:r=e[2];break;case 4:i=e[2],r=e[3]}o(this,t,n,i,r)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:i(!0,!0),setStartAfter:i(!1,!0),setEndBefore:i(!0,!1),setEndAfter:i(!1,!1),collapse:function(e){T(this),e?o(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):o(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){y(e,!0),o(this,e,0,e,U(e))},selectNode:function(e){y(e,!1),w(e,G);var t=r(e),n=s(e);o(this,t.node,t.offset,n.node,n.offset)},extractContents:A(u,o),deleteContents:A(h,o),canSurroundContents:function(){T(this),C(this.startContainer),C(this.endContainer);var e=new p(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},splitBoundaries:function(){E(this)},splitBoundariesPreservingPositions:function(e){E(this,e)},normalizeBoundaries:function(){T(this);var e,t=this.startContainer,n=this.startOffset,i=this.endContainer,r=this.endOffset,s=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,r=e.length,e.appendData(t.data),Z(t))},a=function(e){var o=e.previousSibling;if(o&&o.nodeType==e.nodeType){t=e;var s=e.length;if(n=o.length,e.insertData(0,o.data),Z(o),t==i)r+=n,i=t;else if(i==e.parentNode){var a=M(e);r==a?(i=e,r=s):r>a&&r--}}},l=!0;if(H(i))r==i.length?s(i):0==r&&(e=i.previousSibling,e&&e.nodeType==i.nodeType&&(r=e.length,t==i&&(l=!1),e.appendData(i.data),Z(i),i=e));else{if(r>0){var c=i.childNodes[r-1];c&&H(c)&&s(c)}l=!this.collapsed}if(l){if(H(t))0==n?a(t):n==t.length&&(e=t.nextSibling,e&&e.nodeType==t.nodeType&&(i==e&&(i=t,r+=t.length),t.appendData(e.data),Z(e)));else if(n<t.childNodes.length){var d=t.childNodes[n];d&&H(d)&&a(d)}}else t=i,n=r;o(this,t,n,i,r)},collapseToPoint:function(e,t){y(e,!0),v(e,t),this.setStartAndEnd(e,t)}}),_(t)}function k(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:P.getCommonAncestor(e.startContainer,e.endContainer)}function O(e,t,n,o,i){e.startContainer=t,e.startOffset=n,e.endContainer=o,e.endOffset=i,e.document=P.getDocument(t),k(e)}function I(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,k(this)}var P=e.dom,D=e.util,W=P.DomPosition,B=e.DOMException,H=P.isCharacterDataNode,M=P.getNodeIndex,$=P.isOrIsAncestorOf,F=P.getDocument,V=P.comparePoints,q=P.splitDataNode,j=P.getClosestAncestorIn,U=P.getNodeLength,X=P.arrayContains,K=P.getRootContainer,Y=e.features.crashyTextNodes,Z=P.removeNode;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,H(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!H(n)||n!==this.sc&&n!==this.ec?n.parentNode&&Z(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return n(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new I(o(this.range));var t=this._current,n=t,i=0,r=t,s=U(t);$(t,this.sc)&&(n=this.sc,i=this.so),$(t,this.ec)&&(r=this.ec,s=this.eo),O(e,n,i,r,s)}return new p(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var G=[1,3,4,5,7,8,10],Q=[2,9,11],J=[5,6,10,12],ee=[1,3,4,5,7,8,10,11],te=[1,3,4,5,7,8],ne=g([9,11]),oe=g(J),ie=g([6,10,12]),re=document.createElement("style"),se=!1;try{re.innerHTML="<b>x</b>",se=3==re.firstChild.nodeType}catch(ae){}e.features.htmlParsingConforms=se;var le=se?function(e){var t=this.startContainer,n=F(t);if(!t)throw new B("INVALID_STATE_ERR");var o=null;return 1==t.nodeType?o=t:H(t)&&(o=P.parentElement(t)),o=null===o||"HTML"==o.nodeName&&P.isHtmlNamespace(F(o).documentElement)&&P.isHtmlNamespace(o)?n.createElement("body"):o.cloneNode(!1),o.innerHTML=e,P.fragmentFromNodeChildren(o)}:function(e){var t=o(this),n=t.createElement("body");return n.innerHTML=e,P.fragmentFromNodeChildren(n)},ce=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],de=0,he=1,ue=2,fe=3,me=0,pe=1,ge=2,ye=3;D.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){T(this),b(this.startContainer,t.startContainer);var n,o,i,r,s=e==fe||e==de?"start":"end",a=e==he||e==de?"start":"end";return n=this[s+"Container"],o=this[s+"Offset"],i=t[a+"Container"],r=t[a+"Offset"],V(n,o,i,r)},insertNode:function(e){if(T(this),w(e,ee),C(this.startContainer),$(e,this.startContainer))throw new B("HIERARCHY_REQUEST_ERR");var t=a(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){T(this);var e,t;if(this.collapsed)return o(this).createDocumentFragment();if(this.startContainer===this.endContainer&&H(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=o(this).createDocumentFragment(),t.appendChild(e),t;var n=new p(this,!0);return e=c(n),n.detach(),e},canSurroundContents:function(){T(this),C(this.startContainer),C(this.endContainer);var e=new p(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},surroundContents:function(e){if(w(e,te),!this.canSurroundContents())throw new B("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);a(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){T(this);for(var e,t=new I(o(this)),n=ce.length;n--;)e=ce[n],t[e]=this[e];return t},toString:function(){T(this);var e=this.startContainer;if(e===this.endContainer&&H(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new p(this,!0);return d(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){T(this);var t=e.parentNode,n=M(e);if(!t)throw new B("NOT_FOUND_ERR");var o=this.comparePoint(t,n),i=this.comparePoint(t,n+1);return 0>o?i>0?ge:me:i>0?pe:ye},comparePoint:function(e,t){return T(this),x(e,"HIERARCHY_REQUEST_ERR"),b(e,this.startContainer),V(e,t,this.startContainer,this.startOffset)<0?-1:V(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:le,toHtml:function(){return z(this)},intersectsNode:function(e,t){if(T(this),K(e)!=i(this))return!1;var n=e.parentNode,o=M(e);if(!n)return!0;var r=V(n,o,this.endContainer,this.endOffset),s=V(n,o+1,this.startContainer,this.startOffset);return t?0>=r&&s>=0:0>r&&s>0},isPointInRange:function(e,t){return T(this),x(e,"HIERARCHY_REQUEST_ERR"),b(e,this.startContainer),V(e,t,this.startContainer,this.startOffset)>=0&&V(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return l(this,e,!1)},intersectsOrTouchesRange:function(e){return l(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=V(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=V(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange();return-1==t&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==V(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==V(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new B("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ye},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,U(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var o=n.pop();return t.setEnd(o,o.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return T(this),f(this,e,t)},getDocument:function(){return o(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var n=o(this),i=e.createRange(n);t=t||P.getBody(n),i.selectNodeContents(t);var r=this.intersection(i),s=0,a=0;return r&&(i.setEnd(r.startContainer,r.startOffset),s=i.toString().length,a=s+r.toString().length),{start:s,end:a,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var o,i,r,s,a=[t],l=!1,c=!1;!c&&(o=a.pop());)if(3==o.nodeType)i=n+o.length,!l&&e.start>=n&&e.start<=i&&(this.setStart(o,e.start-n),l=!0),l&&e.end>=n&&e.end<=i&&(this.setEnd(o,e.end-n),c=!0),n=i;else for(s=o.childNodes,r=s.length;r--;)a.push(s[r])},getName:function(){return"DomRange"},equals:function(e){return I.rangesEqual(this,e)},isValid:function(){return S(this)},inspect:function(){return m(this)},detach:function(){}}),L(I,O),D.extend(I,{rangeProperties:ce,RangeIterator:p,copyComparisonConstants:_,createPrototypeRange:L,inspect:m,toHtml:z,getRangeDocument:o,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=I}),O.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,o,i=e.dom,r=e.util,s=i.DomPosition,a=e.DomRange,l=i.getBody,c=i.getContentDocument,d=i.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function o(e){for(var t,n=u.length;n--;)t=u[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function s(e,t,n,o,i){var r=e.startContainer!==t||e.startOffset!=n,s=e.endContainer!==o||e.endOffset!=i,a=!e.equals(e.nativeRange);(r||s||a)&&(e.setEnd(o,i),e.setStart(t,n))}var d,h,u=a.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,o(this)},a.createPrototypeRange(n,s),d=n.prototype,d.selectNode=function(e){this.nativeRange.selectNode(e),o(this)},d.cloneContents=function(){return this.nativeRange.cloneContents()},d.surroundContents=function(e){this.nativeRange.surroundContents(e),o(this)},d.collapse=function(e){this.nativeRange.collapse(e),o(this)},d.cloneRange=function(){return new n(this.nativeRange.cloneRange())},d.refresh=function(){o(this)},d.toString=function(){return this.nativeRange.toString()};var f=document.createTextNode("test");l(document).appendChild(f);var m=document.createRange();m.setStart(f,0),m.setEnd(f,0);try{m.setStart(f,1),d.setStart=function(e,t){this.nativeRange.setStart(e,t),o(this)},d.setEnd=function(e,t){this.nativeRange.setEnd(e,t),o(this)},h=function(e){return function(t){this.nativeRange[e](t),o(this)}}}catch(p){d.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}o(this)},d.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}o(this)},h=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(i){this.nativeRange[t](n),this.nativeRange[e](n)}o(this)}}}d.setStartBefore=h("setStartBefore","setEndBefore"),d.setStartAfter=h("setStartAfter","setEndAfter"),d.setEndBefore=h("setEndBefore","setStartBefore"),d.setEndAfter=h("setEndAfter","setStartAfter"),d.selectNodeContents=function(e){this.setStartAndEnd(e,0,i.getNodeLength(e))},m.selectNodeContents(f),m.setEnd(f,3);var g=document.createRange();g.selectNodeContents(f),g.setEnd(f,4),g.setStart(f,2),-1==m.compareBoundaryPoints(m.START_TO_END,g)&&1==m.compareBoundaryPoints(m.END_TO_START,g)?d.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:d.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var y=document.createElement("div");y.innerHTML="123";var w=y.firstChild,v=l(document);v.appendChild(y),m.setStart(w,1),m.setEnd(w,2),m.deleteContents(),"13"==w.data&&(d.deleteContents=function(){this.nativeRange.deleteContents(),o(this)},d.extractContents=function(){var e=this.nativeRange.extractContents();return o(this),e}),v.removeChild(y),v=null,r.isHostMethod(m,"createContextualFragment")&&(d.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(f),d.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var h=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var o=n.parentElement();n=e.duplicate(),n.collapse(!1);var r=n.parentElement(),s=o==r?o:i.getCommonAncestor(o,r);return s==t?s:i.getCommonAncestor(t,s)},u=function(e){return 0==e.compareEndPoints("StartToEnd",e)},f=function(e,t,n,o,r){var a=e.duplicate();a.collapse(n);var l=a.parentElement();if(i.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var c=new s(l.parentNode,i.getNodeIndex(l));return{boundaryPosition:c,nodeInfo:{nodeIndex:c.offset,containerElement:c.node}}}var h=i.getDocument(l).createElement("span");h.parentNode&&i.removeNode(h);for(var u,f,m,p,g,y=n?"StartToStart":"StartToEnd",w=r&&r.containerElement==l?r.nodeIndex:0,v=l.childNodes.length,b=v,C=b;;){if(C==v?l.appendChild(h):l.insertBefore(h,l.childNodes[C]),a.moveToElementText(h),u=a.compareEndPoints(y,e),0==u||w==b)break;if(-1==u){if(b==w+1)break;w=C}else b=b==w+1?w:C;C=Math.floor((w+b)/2),l.removeChild(h)}if(g=h.nextSibling,-1==u&&g&&d(g)){a.setEndPoint(n?"EndToStart":"EndToEnd",e);var x;if(/[\r\n]/.test(g.data)){var N=a.duplicate(),S=N.text.replace(/\r\n/g,"\r").length;for(x=N.moveStart("character",S);-1==(u=N.compareEndPoints("StartToEnd",N));)x++,N.moveStart("character",1)}else x=a.text.length;p=new s(g,x)}else f=(o||!n)&&h.previousSibling,m=(o||n)&&h.nextSibling,p=m&&d(m)?new s(m,0):f&&d(f)?new s(f,f.data.length):new s(l,i.getNodeIndex(h));return i.removeNode(h),{boundaryPosition:p,nodeInfo:{nodeIndex:C,containerElement:l}}},m=function(e,t){var n,o,r,s,a=e.offset,c=i.getDocument(e.node),h=l(c).createTextRange(),u=d(e.node);return u?(n=e.node,o=n.parentNode):(s=e.node.childNodes,n=a<s.length?s[a]:null,o=e.node),r=c.createElement("span"),r.innerHTML="&#feff;",n?o.insertBefore(r,n):o.appendChild(r),h.moveToElementText(r),h.collapse(!t),o.removeChild(r),u&&h[t?"moveStart":"moveEnd"]("character",a),h};o=function(e){this.textRange=e,this.refresh()},o.prototype=new a(document),o.prototype.refresh=function(){var e,t,n,o=h(this.textRange);u(this.textRange)?t=e=f(this.textRange,o,!0,!0).boundaryPosition:(n=f(this.textRange,o,!0,!1),e=n.boundaryPosition,t=f(this.textRange,o,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},o.prototype.getName=function(){return"WrappedTextRange"},a.copyComparisonConstants(o);var p=function(e){if(e.collapsed)return m(new s(e.startContainer,e.startOffset),!0);var t=m(new s(e.startContainer,e.startOffset),!0),n=m(new s(e.endContainer,e.endOffset),!1),o=l(a.getRangeDocument(e)).createTextRange();return o.setEndPoint("StartToStart",t),o.setEndPoint("EndToEnd",n),o};if(o.rangeToTextRange=p,o.prototype.toTextRange=function(){return p(this)},e.WrappedTextRange=o,
!e.features.implementsDomRange||e.config.preferTextRange){var g=function(e){return e("return this;")()}(Function);"undefined"==typeof g.Range&&(g.Range=o),e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=o}}e.createRange=function(n){return n=c(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=c(e,t,"createRangyRange"),new a(e)},r.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),r.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),O.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function o(e,n){if(e){if(R.isWindow(e))return e;if(e instanceof y)return e.win;var o=R.getContentDocument(e,t,n);return R.getWindow(o)}return window}function i(e){return o(e,"getWinSelection").getSelection()}function r(e){return o(e,"getDocSelection").document.selection}function s(e){var t=!1;return e.anchorNode&&(t=1==R.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function a(e,t,n){var o=n?"end":"start",i=n?"start":"end";e.anchorNode=t[o+"Container"],e.anchorOffset=t[o+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function l(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function c(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function d(t){var n;return t instanceof L?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof k?n=t.nativeRange:P.implementsDomRange&&t instanceof R.getWindow(t.startContainer).Range&&(n=t),n}function h(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!R.isAncestorOf(e[0],e[t]))return!1;return!0}function u(e){var n=e.getNodes();if(!h(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function f(e){return!!e&&"undefined"!=typeof e.text}function m(e,t){var n=new k(t);e._ranges=[n],a(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function p(t){if(t._ranges.length=0,"None"==t.docSelection.type)c(t);else{var n=t.docSelection.createRange();if(f(n))m(t,n);else{t.rangeCount=n.length;for(var o,i=W(n.item(0)),r=0;r<t.rangeCount;++r)o=e.createRange(i),o.selectNode(n.item(r)),t._ranges.push(o);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,a(t,t._ranges[t.rangeCount-1],!1)}}}function g(e,n){for(var o=e.docSelection.createRange(),i=u(n),r=W(o.item(0)),s=B(r).createControlRange(),a=0,l=o.length;l>a;++a)s.add(o.item(a));try{s.add(i)}catch(c){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}s.select(),p(e)}function y(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function w(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function v(e,t){for(var n,o,i=te.length;i--;)if(n=te[i],o=n.selection,"deleteAll"==t)w(o);else if(n.win==e)return"delete"==t?(te.splice(i,1),!0):o;return"deleteAll"==t&&(te.length=0),null}function b(e,n){for(var o,i=W(n[0].startContainer),r=B(i).createControlRange(),s=0,a=n.length;a>s;++s){o=u(n[s]);try{r.add(o)}catch(l){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),p(e)}function C(e,t){if(e.win.document!=W(t))throw new O("WRONG_DOCUMENT_ERR")}function x(t){return function(n,o){var i;this.rangeCount?(i=this.getRangeAt(0),i["set"+(t?"Start":"End")](n,o)):(i=e.createRange(this.win.document),i.setStartAndEnd(n,o)),this.setSingleRange(i,this.isBackward())}}function N(e){var t=[],n=new I(e.anchorNode,e.anchorOffset),o=new I(e.focusNode,e.focusOffset),i="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var r=0,s=e.rangeCount;s>r;++r)t[r]=L.inspect(e.getRangeAt(r));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+o.inspect()+"]"}e.config.checkSelectionRanges=!0;var S,T,E="boolean",z="number",R=e.dom,_=e.util,A=_.isHostMethod,L=e.DomRange,k=e.WrappedRange,O=e.DOMException,I=R.DomPosition,P=e.features,D="Control",W=R.getDocument,B=R.getBody,H=L.rangesEqual,M=A(window,"getSelection"),$=_.isHostObject(document,"selection");P.implementsWinGetSelection=M,P.implementsDocSelection=$;var F=$&&(!M||e.config.preferTextRange);if(F)S=r,e.isSelectionValid=function(e){var t=o(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||W(n.createRange().parentElement())==t};else{if(!M)return t.fail("Neither document.selection or window.getSelection() detected."),!1;S=i,e.isSelectionValid=function(){return!0}}e.getNativeSelection=S;var V=S();if(!V)return t.fail("Native selection was null (possibly issue 138?)"),!1;var q=e.createNativeRange(document),j=B(document),U=_.areHostProperties(V,["anchorNode","focusNode","anchorOffset","focusOffset"]);P.selectionHasAnchorAndFocus=U;var X=A(V,"extend");P.selectionHasExtend=X;var K=typeof V.rangeCount==z;P.selectionHasRangeCount=K;var Y=!1,Z=!0,G=X?function(t,n){var o=L.getRangeDocument(n),i=e.createRange(o);i.collapseToPoint(n.endContainer,n.endOffset),t.addRange(d(i)),t.extend(n.startContainer,n.startOffset)}:null;_.areHostMethods(V,["addRange","getRangeAt","removeAllRanges"])&&typeof V.rangeCount==z&&P.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,o=n>1,i=[],r=s(t),a=0;n>a;++a)i[a]=t.getRangeAt(a);var l=R.createTestElement(document,"",!1),c=l.appendChild(document.createTextNode("\xa0\xa0\xa0")),d=document.createRange();if(d.setStart(c,1),d.collapse(!0),t.removeAllRanges(),t.addRange(d),Z=1==t.rangeCount,t.removeAllRanges(),!o){var h=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(h&&parseInt(h[1])>=36)Y=!1;else{var u=d.cloneRange();d.setStart(c,0),u.setEnd(c,3),u.setStart(c,2),t.addRange(d),t.addRange(u),Y=2==t.rangeCount}}for(R.removeNode(l),t.removeAllRanges(),a=0;n>a;++a)0==a&&r?G?G(t,i[a]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(i[a])):t.addRange(i[a])}}(),P.selectionSupportsMultipleRanges=Y,P.collapsedNonEditableSelectionsSupported=Z;var Q,J=!1;j&&A(j,"createControlRange")&&(Q=j.createControlRange(),_.areHostProperties(Q,["item","add"])&&(J=!0)),P.implementsControlRange=J,T=U?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var ee;A(V,"getRangeAt")?ee=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:U&&(ee=function(t){var n=W(t.anchorNode),o=e.createRange(n);return o.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),o.collapsed!==this.isCollapsed&&o.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),o}),y.prototype=e.selectionPrototype;var te=[],ne=function(e){if(e&&e instanceof y)return e.refresh(),e;e=o(e,"getNativeSelection");var t=v(e),n=S(e),i=$?r(e):null;return t?(t.nativeSelection=n,t.docSelection=i,t.refresh()):(t=new y(n,i,e),te.push({win:e,selection:t})),t};e.getSelection=ne,_.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var oe=y.prototype;if(!F&&U&&_.areHostMethods(V,["removeAllRanges","addRange"])){oe.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),c(this)};var ie=function(e,t){G(e.nativeSelection,t),e.refresh()};K?oe.addRange=function(t,o){if(J&&$&&this.docSelection.type==D)g(this,t);else if(n(o)&&X)ie(this,t);else{var i;Y?i=this.rangeCount:(this.removeAllRanges(),i=0);var r=d(t).cloneRange();try{this.nativeSelection.addRange(r)}catch(s){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==i+1){if(e.config.checkSelectionRanges){var l=ee(this.nativeSelection,this.rangeCount-1);l&&!H(l,t)&&(t=new k(l))}this._ranges[this.rangeCount-1]=t,a(this,t,ae(this.nativeSelection)),this.isCollapsed=T(this)}else this.refresh()}}:oe.addRange=function(e,t){n(t)&&X?ie(this,e):(this.nativeSelection.addRange(d(e)),this.refresh())},oe.setRanges=function(e){if(J&&$&&e.length>1)b(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(A(V,"empty")&&A(q,"select")&&J&&F))return t.fail("No means of selecting a Range or TextRange was found"),!1;oe.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=W(this.anchorNode);else if(this.docSelection.type==D){var t=this.docSelection.createRange();t.length&&(e=W(t.item(0)))}if(e){var n=B(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(o){}c(this)},oe.addRange=function(t){this.docSelection.type==D?g(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,a(this,t,!1))},oe.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?b(this,e):t&&this.addRange(e[0])}}oe.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new O("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var re;if(F)re=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=B(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==D?p(t):f(n)?m(t,n):c(t)};else if(A(V,"getRangeAt")&&typeof V.rangeCount==z)re=function(t){if(J&&$&&t.docSelection.type==D)p(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,o=t.rangeCount;o>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));a(t,t._ranges[t.rangeCount-1],ae(t.nativeSelection)),t.isCollapsed=T(t)}else c(t)};else{if(!U||typeof V.isCollapsed!=E||typeof q.collapsed!=E||!P.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;re=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=ee(n,0),e._ranges=[t],e.rangeCount=1,l(e),e.isCollapsed=T(e)):c(e)}}oe.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,o=this.anchorOffset;if(re(this),e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=o)return!0;for(;i--;)if(!H(t[i],this._ranges[i]))return!0;return!1}};var se=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var o=0,i=n.length;i>o;++o)H(t,n[o])||e.addRange(n[o]);e.rangeCount||c(e)};J&&$?oe.removeRange=function(e){if(this.docSelection.type==D){for(var t,n=this.docSelection.createRange(),o=u(e),i=W(n.item(0)),r=B(i).createControlRange(),s=!1,a=0,l=n.length;l>a;++a)t=n.item(a),t!==o||s?r.add(n.item(a)):s=!0;r.select(),p(this)}else se(this,e)}:oe.removeRange=function(e){se(this,e)};var ae;!F&&U&&P.implementsDomRange?(ae=s,oe.isBackward=function(){return ae(this)}):ae=oe.isBackward=function(){return!1},oe.isBackwards=oe.isBackward,oe.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},oe.collapse=function(t,n){C(this,t);var o=e.createRange(t);o.collapseToPoint(t,n),this.setSingleRange(o),this.isCollapsed=!0},oe.collapseToStart=function(){if(!this.rangeCount)throw new O("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},oe.collapseToEnd=function(){if(!this.rangeCount)throw new O("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},oe.selectAllChildren=function(t){C(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},oe.deleteFromDocument=function(){if(J&&$&&this.docSelection.type==D){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),R.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var o=0,i=n.length;i>o;++o)n[o].deleteContents();this.addRange(n[i-1])}}},oe.eachRange=function(e,t){for(var n=0,o=this._ranges.length;o>n;++n)if(e(this.getRangeAt(n)))return t},oe.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},oe.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},oe.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(o){n.push(o[e].apply(o,t||[]))}),n},oe.setStart=x(!0),oe.setEnd=x(!1),e.rangePrototype.select=function(e){ne(this.getDocument()).setSingleRange(this,e)},oe.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},oe.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},oe.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},oe.moveToBookmark=function(t){for(var n,o,i=[],r=0;n=t.rangeBookmarks[r++];)o=e.createRange(this.win),o.moveToBookmark(n),i.push(o);t.backward?this.setSingleRange(i[0],"backward"):this.setRanges(i)},oe.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},oe.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},oe.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(L.toHtml(t))}),e.join("")},P.implementsTextRange&&(oe.getNativeTextRange=function(){var n;if(n=this.docSelection){var o=n.createRange();if(f(o))return o;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),oe.getName=function(){return"WrappedSelection"},oe.inspect=function(){return N(this)},oe.detach=function(){v(this.win,"delete"),w(this)},y.detachAll=function(){v(null,"deleteAll")},y.inspect=N,y.isDirectionBackward=n,e.Selection=y,e.selectionPrototype=oe,e.addShimListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return ne(e)}),e=null})});var B=!1,H=function(e){B||(B=!0,!O.initialized&&O.config.autoInitialize&&h())};return L&&("complete"==document.readyState?H():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",H,!1),P(window,"load",H))),O},this),/**
 * Selection save and restore module for Rangy.
 * Saves and restores user selections using marker invisible elements in the DOM.
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */
function(e,t){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("SaveRestore",["WrappedRange"],function(e,t){function n(e,t){return(t||document).getElementById(e)}function o(e,t){var n,o="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),i=m.getDocument(e.startContainer),r=e.cloneRange();return r.collapse(t),n=i.createElement("span"),n.id=o,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(i.createTextNode(y)),r.insertNode(n),n}function i(e,o,i,r){var s=n(i,e);s?(o[r?"setStartBefore":"setEndBefore"](s),p(s)):t.warn("Marker element has been removed. Cannot restore selection.")}function r(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function s(t,n){var i,r,s=e.DomRange.getRangeDocument(t),a=t.toString(),l=g(n);return t.collapsed?(r=o(t,!1),{document:s,markerId:r.id,collapsed:!0}):(r=o(t,!1),i=o(t,!0),{document:s,startMarkerId:i.id,endMarkerId:r.id,collapsed:!1,backward:l,toString:function(){return"original text: '"+a+"', new text: '"+t.toString()+"'"}})}function a(o,r){var s=o.document;"undefined"==typeof r&&(r=!0);var a=e.createRange(s);if(o.collapsed){var l=n(o.markerId,s);if(l){l.style.display="inline";var c=l.previousSibling;c&&3==c.nodeType?(p(l),a.collapseToPoint(c,c.length)):(a.collapseBefore(l),p(l))}else t.warn("Marker element has been removed. Cannot restore selection.")}else i(s,a,o.startMarkerId,!0),i(s,a,o.endMarkerId,!1);return r&&a.normalizeBoundaries(),a}function l(t,o){var i,a,l=[],c=g(o);t=t.slice(0),t.sort(r);for(var d=0,h=t.length;h>d;++d)l[d]=s(t[d],c);for(d=h-1;d>=0;--d)i=t[d],a=e.DomRange.getRangeDocument(i),i.collapsed?i.collapseAfter(n(l[d].markerId,a)):(i.setEndBefore(n(l[d].endMarkerId,a)),i.setStartAfter(n(l[d].startMarkerId,a)));return l}function c(n){if(!e.isSelectionValid(n))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var o=e.getSelection(n),i=o.getAllRanges(),r=1==i.length&&o.isBackward(),s=l(i,r);return r?o.setSingleRange(i[0],r):o.setRanges(i),{win:n,rangeInfos:s,restored:!1}}function d(e){for(var t=[],n=e.length,o=n-1;o>=0;o--)t[o]=a(e[o],!0);return t}function h(t,n){if(!t.restored){var o=t.rangeInfos,i=e.getSelection(t.win),r=d(o),s=o.length;1==s&&n&&e.features.selectionHasExtend&&o[0].backward?(i.removeAllRanges(),i.addRange(r[0],!0)):i.setRanges(r),t.restored=!0}}function u(e,t){var o=n(t,e);o&&p(o)}function f(e){for(var t,n=e.rangeInfos,o=0,i=n.length;i>o;++o)t=n[o],t.collapsed?u(e.doc,t.markerId):(u(e.doc,t.startMarkerId),u(e.doc,t.endMarkerId))}var m=e.dom,p=m.removeNode,g=e.Selection.isDirectionBackward,y="\ufeff";e.util.extend(e,{saveRange:s,restoreRange:a,saveRanges:l,restoreRanges:d,saveSelection:c,restoreSelection:h,removeMarkerElement:u,removeMarkers:f})}),e},this);/*
	Base.js, version 1.1a
	Copyright 2006-2010, Dean Edwards
	License: http://www.opensource.org/licenses/mit-license.php
*/
var Base=function(){};Base.extend=function(e,t){var n=Base.prototype.extend;Base._prototyping=!0;var o=new this;n.call(o,e),o.base=function(){},delete Base._prototyping;var i=o.constructor,r=o.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==r)this._constructing=!0,i.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||n).call(arguments[0],o)};return r.ancestor=this,r.extend=this.extend,r.forEach=this.forEach,r.implement=this.implement,r.prototype=o,r.toString=this.toString,r.valueOf=function(e){return"object"==e?r:i.valueOf()},n.call(r,t),"function"==typeof r.init&&r.init(),r},Base.prototype={extend:function(e,t){if(arguments.length>1){var n=this[e];if(n&&"function"==typeof t&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var o=t.valueOf();t=function(){var e=this.base||Base.prototype.base;this.base=n;var t=o.apply(this,arguments);return this.base=e,t},t.valueOf=function(e){return"object"==e?t:o},t.toString=Base.toString}this[e]=t}else if(e){var i=Base.prototype.extend;Base._prototyping||"function"==typeof this||(i=this.extend||i);for(var r={toSource:null},s=["constructor","toString","valueOf"],a=Base._prototyping?0:1;l=s[a++];)e[l]!=r[l]&&i.call(this,l,e[l]);for(var l in e)r[l]||i.call(this,l,e[l])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var o in e)void 0===this.prototype[o]&&t.call(n,e[o],o,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function e(e){return+(/ipad|iphone|ipod/.test(e)&&e.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}function t(e){return+(e.match(/android (\d+)/)||[void 0,0])[1]}function n(e,t){var n,o=-1;return"Microsoft Internet Explorer"==navigator.appName?n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(n=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")),n&&null!=n.exec(navigator.userAgent)&&(o=parseFloat(RegExp.$1)),-1===o?!1:e?t?"<"===t?o>e:">"===t?e>o:"<="===t?o>=e:">="===t?e>=o:void 0:e===o:!0}var o=navigator.userAgent,i=document.createElement("div"),r=-1!==o.indexOf("Gecko")&&-1===o.indexOf("KHTML"),s=-1!==o.indexOf("AppleWebKit/"),a=-1!==o.indexOf("Chrome/"),l=-1!==o.indexOf("Opera/");return{USER_AGENT:o,supported:function(){var n=this.USER_AGENT.toLowerCase(),o="contentEditable"in i,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,s=document.querySelector&&document.querySelectorAll,a=this.isIos()&&e(n)<5||this.isAndroid()&&t(n)<4||-1!==n.indexOf("opera mobi")||-1!==n.indexOf("hpwos/");return o&&r&&s&&!a},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return n()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return n()},hasCurrentStyleProperty:function(){return"currentStyle"in i},insertsLineBreaksOnReturn:function(){return r},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in i||function(){return i.setAttribute("on"+e,"return;"),"function"==typeof i["on"+e]}()},supportsEventsInIframeCorrectly:function(){return!l},supportsHTML5Tags:function(e){var t=e.createElement("div"),n="<article>foo</article>";return t.innerHTML=n,t.innerHTML.toLowerCase()===n},supportsCommand:function(){var e={formatBlock:n(10,"<="),insertUnorderedList:n(9,">="),insertOrderedList:n(9,">=")},t={insertHTML:r};return function(n,o){var i=e[o];if(!i){try{return n.queryCommandSupported(o)}catch(r){}try{return n.queryCommandEnabled(o)}catch(s){return!!t[o]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return r||l||s},supportsGetAttributeCorrectly:function(){var e=document.createElement("td");return"1"!=e.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return r||n()||l},autoScrollsToCaret:function(){return!s},autoClosesUnclosedTags:function(){var e,t,n=i.cloneNode(!1);return n.innerHTML="<p><div></div>",t=n.innerHTML.toLowerCase(),e="<p></p><div></div>"===t||"<p><div></div></p>"===t,this.autoClosesUnclosedTags=function(){return e},e},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return l},supportsSpeechApiOn:function(e){var t=o.match(/Chrome\/(\d+)/)||[void 0,0];return t[1]>=11&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function(e){return n(9)&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return n()},hasProblemsSettingCaretAfterImg:function(){return n()},hasUndoInContextMenu:function(){return r||a||l},hasInsertNodeIssue:function(){return l},hasIframeFocusIssue:function(){return n()},createsNestedInvalidMarkupAfterPaste:function(){return s},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModernPaste:function(){return!("clipboardData"in window)},fixStyleKey:function(e){return"cssFloat"===e?"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat":e}}}(),wysihtml5.lang.array=function(e){return{contains:function(t){if(Array.isArray(t)){for(var n=t.length;n--;)if(-1!==wysihtml5.lang.array(e).indexOf(t[n]))return!0;return!1}return-1!==wysihtml5.lang.array(e).indexOf(t)},indexOf:function(t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;o>n;n++)if(e[n]===t)return n;return-1},without:function(t){t=wysihtml5.lang.array(t);for(var n=[],o=0,i=e.length;i>o;o++)t.contains(e[o])||n.push(e[o]);return n},get:function(){for(var t=0,n=e.length,o=[];n>t;t++)o.push(e[t]);return o},map:function(t,n){if(Array.prototype.map)return e.map(t,n);for(var o=e.length>>>0,i=new Array(o),r=0;o>r;r++)i[r]=t.call(n,e[r],r,e);return i},unique:function(){for(var t=[],n=e.length,o=0;n>o;)wysihtml5.lang.array(t).contains(e[o])||t.push(e[o]),o++;return t}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},off:function(e,t){this.events=this.events||{};var n,o,i=0;if(e){for(n=this.events[e]||[],o=[];i<n.length;i++)n[i]!==t&&t&&o.push(n[i]);this.events[e]=o}else this.events={};return this},fire:function(e,t){this.events=this.events||{};for(var n=this.events[e]||[],o=0;o<n.length;o++)n[o].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(e){return{merge:function(t,n){for(var o in t)n&&wysihtml5.lang.object(t[o]).isPlainObject()&&("undefined"==typeof e[o]||wysihtml5.lang.object(e[o]).isPlainObject())?"undefined"==typeof e[o]?e[o]=wysihtml5.lang.object(t[o]).clone(!0):wysihtml5.lang.object(e[o]).merge(wysihtml5.lang.object(t[o]).clone(!0)):e[o]=wysihtml5.lang.object(t[o]).isPlainObject()?wysihtml5.lang.object(t[o]).clone(!0):t[o];return this},difference:function(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(t.hasOwnProperty(o)||(n[o]=e[o]));for(var i in t)t.hasOwnProperty(i)&&(e.hasOwnProperty(i)&&e[i]===t[i]||(n[0]=e[0]));return n},get:function(){return e},clone:function(t){var n,o={};if(null===e||!wysihtml5.lang.object(e).isPlainObject())return e;for(n in e)e.hasOwnProperty(n)&&(t?o[n]=wysihtml5.lang.object(e[n]).clone(t):o[n]=e[n]);return o},isArray:function(){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(e)},isPlainObject:function(){return e&&"[object Object]"===Object.prototype.toString.call(e)&&!("Node"in window?e instanceof Node:e instanceof Element||e instanceof Text)},isEmpty:function(){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}}},function(){var e=/^\s+/,t=/\s+$/,n=/[&<>\t"]/g,o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","	":"&nbsp; "};wysihtml5.lang.string=function(i){return i=String(i),{trim:function(){return i.replace(e,"").replace(t,"")},interpolate:function(e){for(var t in e)i=this.replace("#{"+t+"}").by(e[t]);return i},replace:function(e){return{by:function(t){return i.split(e).join(t)}}},escapeHTML:function(e,t){var r=i.replace(n,function(e){return o[e]});return e&&(r=r.replace(/(?:\r\n|\r|\n)/g,"<br />")),t&&(r=r.replace(/  /gi,"&nbsp; ")),r}}}}(),function(e){function t(e,t){return r(e,t)?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),s(e,t))}function n(e){return e.replace(l,function(e,t){var n=(t.match(c)||[])[1]||"",o=h[n];t=t.replace(c,""),t.split(o).length>t.split(n).length&&(t+=n,n="");var i=t,r=t;return t.length>d&&(r=r.substr(0,d)+"..."),"www."===i.substr(0,4)&&(i="http://"+i),'<a href="'+i+'">'+r+"</a>"+n})}function o(e){var t=e._wysihtml5_tempElement;return t||(t=e._wysihtml5_tempElement=e.createElement("div")),t}function i(t){var i=t.parentNode,r=e.lang.string(t.data).escapeHTML(),s=o(i.ownerDocument);for(s.innerHTML="<span></span>"+n(r),s.removeChild(s.firstChild);s.firstChild;)i.insertBefore(s.firstChild,t);i.removeChild(t)}function r(t,n){for(var o;t.parentNode;){if(t=t.parentNode,o=t.nodeName,t.className&&e.lang.array(t.className.split(" ")).contains(n))return!0;if(a.contains(o))return!0;if("body"===o)return!1}return!1}function s(t,n){if(!(a.contains(t.nodeName)||t.className&&e.lang.array(t.className.split(" ")).contains(n))){if(t.nodeType===e.TEXT_NODE&&t.data.match(l))return void i(t);for(var o=e.lang.array(t.childNodes).get(),r=o.length,c=0;r>c;c++)s(o[c],n);return t}}var a=e.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),l=/((https?:\/\/|www\.)[^\s<]{3,})/gi,c=/([^\w\/\-](,?))$/i,d=100,h={")":"(","]":"[","}":"{"};e.dom.autoLink=t,e.dom.autoLink.URL_REG_EXP=l}(wysihtml5),function(e){var t=e.dom;t.addClass=function(e,n){var o=e.classList;return o?o.add(n):void(t.hasClass(e,n)||(e.className+=" "+n))},t.removeClass=function(e,t){var n=e.classList;return n?n.remove(t):void(e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))},t.hasClass=function(e,t){var n=e.classList;if(n)return n.contains(t);var o=e.className;return o.length>0&&(o==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(o))}}(wysihtml5),wysihtml5.dom.contains=function(){var e=document.documentElement;return e.contains?function(e,t){if(t.nodeType!==wysihtml5.ELEMENT_NODE){if(t.parentNode===e)return!0;t=t.parentNode}return e!==t&&e.contains(t)}:e.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:void 0}(),wysihtml5.dom.convertToList=function(){function e(e,t){var n=e.createElement("li");return t.appendChild(n),n}function t(e,t){return e.createElement(t)}function n(n,o,i){if("UL"===n.nodeName||"OL"===n.nodeName||"MENU"===n.nodeName)return n;var r,s,a,l,c,d,h,u,f,m=n.ownerDocument,p=t(m,o),g=n.querySelectorAll("br"),y=g.length;for(f=0;y>f;f++)for(l=g[f];(c=l.parentNode)&&c!==n&&c.lastChild===l;){if("block"===wysihtml5.dom.getStyle("display").from(c)){c.removeChild(l);break}wysihtml5.dom.insert(l).after(l.parentNode)}for(r=wysihtml5.lang.array(n.childNodes).get(),s=r.length,f=0;s>f;f++)u=u||e(m,p),a=r[f],d="block"===wysihtml5.dom.getStyle("display").from(a),h="BR"===a.nodeName,!d||i&&wysihtml5.dom.hasClass(a,i)?h?u=u.firstChild?null:u:u.appendChild(a):(u=u.firstChild?e(m,p):u,u.appendChild(a),u=null);return 0===r.length&&e(m,p),n.parentNode.replaceChild(p,n),p}return n}(),wysihtml5.dom.copyAttributes=function(e){return{from:function(t){return{to:function(n){for(var o,i=0,r=e.length;r>i;i++)o=e[i],"undefined"!=typeof t[o]&&""!==t[o]&&(n[o]=t[o]);return{andTo:arguments.callee}}}}}},function(e){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],n=function(t){return o(t)?parseInt(e.getStyle("width").from(t),10)<t.offsetWidth:!1},o=function(n){for(var o=0,i=t.length;i>o;o++)if("border-box"===e.getStyle(t[o]).from(n))return t[o]};e.copyStyles=function(o){return{from:function(i){n(i)&&(o=wysihtml5.lang.array(o).without(t));for(var r,s="",a=o.length,l=0;a>l;l++)r=o[l],s+=r+":"+e.getStyle(r).from(i)+";";return{to:function(t){return e.setStyles(s).on(t),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(e){e.dom.delegate=function(e,t,n,o){var i=function(n){for(var i=n.target,r=3===i.nodeType?i.parentNode:i,s=e.querySelectorAll(t),a=0,l=s.length;l>a;a++)s[a].contains(r)&&o.call(s[a],n)};return e.addEventListener(n,i,!1),{stop:function(){e.removeEventListener(n,i,!1)}}}}(wysihtml5),function(e){function t(e,t){for(var n=[e],o=e;t&&o&&o!==t||!t&&o;)n.unshift(o),o=o.parentNode;return n}e.dom.domNode=function(n){var o=[e.ELEMENT_NODE,e.TEXT_NODE];return{is:{emptyTextNode:function(t){var o=t?/^\s*$/g:/^[\r\n]*$/g;return n.nodeType===e.TEXT_NODE&&o.test(n.data)},visible:function(){var t=!/^\s*$/g.test(e.dom.getTextContent(n));return t||1===n.nodeType&&n.querySelector("img, br, hr, object, embed, canvas, input, textarea")&&(t=!0),t}},prev:function(t){var i=n.previousSibling,r=t&&t.nodeTypes?t.nodeTypes:o;return i?!e.lang.array(r).contains(i.nodeType)||t&&t.ignoreBlankTexts&&e.dom.domNode(i).is.emptyTextNode(!0)?e.dom.domNode(i).prev(t):i:null},next:function(t){var i=n.nextSibling,r=t&&t.nodeTypes?t.nodeTypes:o;return i?!e.lang.array(r).contains(i.nodeType)||t&&t.ignoreBlankTexts&&e.dom.domNode(i).is.emptyTextNode(!0)?e.dom.domNode(i).next(t):i:null},commonAncestor:function(e,o){var i=t(n,o),r=t(e,o);if(i[0]!=r[0])return null;for(var s=0;s<i.length;s++)if(i[s]!=r[s])return i[s-1];return null},lastLeafNode:function(t){var o;if(1!==n.nodeType)return n;if(o=n.lastChild,!o)return n;if(t&&t.leafClasses)for(var i=t.leafClasses.length;i--;)if(e.dom.hasClass(n,t.leafClasses[i]))return n;return e.dom.domNode(o).lastLeafNode(t)},escapeParent:function(t,o){var i,r,s,a=n;if(!e.dom.contains(t,n))throw new Error("Child is not a descendant of node.");do{for(i=a.parentNode,r=i.cloneNode(!1);i.lastChild&&i.lastChild!==a;)r.insertBefore(i.lastChild,r.firstChild);if(i!==t&&(s=i.cloneNode(!1),s.appendChild(a),a=s),i.parentNode.insertBefore(a,i.nextSibling),""!==r.innerHTML)if(/^\s+$/.test(r.innerHTML))for(;r.lastChild;)i.parentNode.insertBefore(r.lastChild,a.nextSibling);else i.parentNode.insertBefore(r,a.nextSibling);if(""===i.innerHTML)i.parentNode.removeChild(i);else if(/^\s+$/.test(i.innerHTML)){for(;i.firstChild;)i.parentNode.insertBefore(i.firstChild,i);i.parentNode.removeChild(i)}}while(i&&i!==t);o&&a&&(a.parentNode.insertBefore(o,a),o.appendChild(a))},test:function(t){var o;if(!t)return!1;if(1!==n.nodeType)return!1;if(t.query&&!n.matches(t.query))return!1;if(t.nodeName&&n.nodeName!==t.nodeName)return!1;if(t.className&&!n.classList.contains(t.className))return!1;if(t.classRegExp){var i=(n.className||"").match(t.classRegExp)||[];if(0===i.length)return!1}if(t.styleProperty&&t.styleProperty.length>0)for(var r=!1,s=Array.isArray(t.styleProperty)?t.styleProperty:[t.styleProperty],a=0,l=s.length;l>a;a++){if(o=e.browser.fixStyleKey(s[a]),n.style[o]){if(!t.styleValue){r=!0;break}if(t.styleValue instanceof RegExp){if(n.style[o].trim().match(t.styleValue).length>0){r=!0;break}}else if(Array.isArray(t.styleValue)){if(t.styleValue.indexOf(n.style[o].trim())){r=!0;break}}else if(t.styleValue===n.style[o].trim().replace(/, /g,",")){r=!0;break}}if(!r)return!1}if(t.attribute){var c=e.dom.getAttributes(n),d=[],h=!1;Array.isArray(t.attribute)?d=t.attribute:d[t.attribute]=t.attributeValue;for(var u in d)if(d.hasOwnProperty(u))if("undefined"==typeof d[u]){if("undefined"!=typeof c[u]){h=!0;break}}else if(c[u]===d[u]){h=!0;break}if(!h)return!1}return!0}}}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var e=function(e,t){var n=t.createElement("div");n.style.display="none",t.body.appendChild(n);try{n.innerHTML=e}catch(o){}return t.body.removeChild(n),n},t=function(e){if(!e._wysihtml5_supportsHTML5Tags){for(var t=0,o=n.length;o>t;t++)e.createElement(n[t]);e._wysihtml5_supportsHTML5Tags=!0}},n=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(n,o){o=o||document;var i;return"object"==typeof n&&n.nodeType?(i=o.createElement("div"),i.appendChild(n)):wysihtml5.browser.supportsHTML5Tags(o)?(i=o.createElement("div"),i.innerHTML=n):(t(o),i=e(n,o)),i}}(),wysihtml5.dom.getParentElement=function(){return function(e,t,n,o){for(n=n||50;n--&&e&&"BODY"!==e.nodeName&&(!o||e!==o);){if(wysihtml5.dom.domNode(e).test(t))return e;e=e.parentNode}return null}}(),wysihtml5.dom.getStyle=function(){function e(e){return e.replace(n,function(e){return e.charAt(1).toUpperCase()})}var t={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},n=/\-[a-z]/g;return function(n){return{from:function(o){if(o.nodeType===wysihtml5.ELEMENT_NODE){var i=o.ownerDocument,r=t[n]||e(n),s=o.style,a=o.currentStyle,l=s[r];if(l)return l;if(a)try{return a[r]}catch(c){}var d,h,u=i.defaultView||i.parentWindow,f=("height"===n||"width"===n)&&"TEXTAREA"===o.nodeName;return u.getComputedStyle?(f&&(d=s.overflow,s.overflow="hidden"),h=u.getComputedStyle(o,null).getPropertyValue(n),f&&(s.overflow=d||""),h):void 0}}}}}(),wysihtml5.dom.getTextNodes=function(e,t){var n=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?t&&/^\s*$/.test(e.innerText||e.textContent)||n.push(e):n=n.concat(wysihtml5.dom.getTextNodes(e,t));return n},wysihtml5.dom.hasElementWithTagName=function(){function e(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=n++)}var t={},n=1;return function(n,o){var i=e(n)+":"+o,r=t[i];return r||(r=t[i]=n.getElementsByTagName(o)),r.length>0}}(),function(e){function t(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=o++)}var n={},o=1;e.dom.hasElementWithClassName=function(o,i){if(!e.browser.supportsNativeGetElementsByClassName())return!!o.querySelector("."+i);var r=t(o)+":"+i,s=n[r];return s||(s=n[r]=o.getElementsByClassName(i)),s.length>0}}(wysihtml5),wysihtml5.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},wysihtml5.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var n=t.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(t.createTextNode(e));var o=t.querySelector("head link");if(o)return void o.parentNode.insertBefore(n,o);var i=t.querySelector("head");i&&i.appendChild(n)}}},function(e){e.dom.lineBreaks=function(t){function n(e){return"BR"===e.nodeName}function o(t){return n(t)?!0:"block"===e.dom.getStyle("display").from(t)?!0:!1}return{add:function(n){var i=t.ownerDocument,r=e.dom.domNode(t).next({ignoreBlankTexts:!0}),s=e.dom.domNode(t).prev({ignoreBlankTexts:!0});r&&!o(r)&&e.dom.insert(i.createElement("br")).after(t),s&&!o(s)&&e.dom.insert(i.createElement("br")).before(t)},remove:function(o){var i=e.dom.domNode(t).next({ignoreBlankTexts:!0}),r=e.dom.domNode(t).prev({ignoreBlankTexts:!0});i&&n(i)&&i.parentNode.removeChild(i),r&&n(r)&&r.parentNode.removeChild(r)}}}}(wysihtml5),wysihtml5.dom.observe=function(e,t,n){t="string"==typeof t?[t]:t;for(var o,i,r=0,s=t.length;s>r;r++)i=t[r],e.addEventListener?e.addEventListener(i,n,!1):(o=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},n.call(e,t)},e.attachEvent("on"+i,o));return{stop:function(){for(var i,r=0,s=t.length;s>r;r++)i=t[r],e.removeEventListener?e.removeEventListener(i,n,!1):e.detachEvent("on"+i,o)}}},wysihtml5.dom.parse=function(e,t){function n(e,t){wysihtml5.lang.object(v).merge(w).merge(t.rules).get();var n,r,s,a=t.context||e.ownerDocument||document,l=a.createDocumentFragment(),c="string"==typeof e,d=!1;for(t.clearInternals===!0&&(d=!0),n=c?wysihtml5.dom.getAsDom(e,a):e,v.selectors&&i(n,v.selectors);n.firstChild;)s=n.firstChild,r=o(s,t.cleanUp,d,t.uneditableClass),r&&l.appendChild(r),s!==r&&n.removeChild(s);if(t.unjoinNbsps)for(var h=wysihtml5.dom.getTextNodes(l),u=h.length;u--;)h[u].nodeValue=h[u].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return n.innerHTML="",n.appendChild(l),c?wysihtml5.quirks.getCorrectInnerHTML(n):n}function o(e,t,n,i){var r,s,a,l,c=e.nodeType,d=e.childNodes,h=d.length,u=p[c],f=0;if(i&&1===c&&wysihtml5.dom.hasClass(e,i))return e;if(s=u&&u(e,n),!s){if(s===!1){for(r=e.ownerDocument.createDocumentFragment(),f=h;f--;)d[f]&&(a=o(d[f],t,n,i),a&&(d[f]===a&&f--,r.insertBefore(a,r.firstChild)));return l=wysihtml5.dom.getStyle("display").from(e),""===l&&(l=wysihtml5.lang.array(b).contains(e.tagName)?"block":""),wysihtml5.lang.array(["block","flex","table"]).contains(l)&&r.appendChild(e.ownerDocument.createElement("br")),wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(e.nodeName.toLowerCase())&&e.parentNode.lastChild!==e&&(e.nextSibling&&3===e.nextSibling.nodeType&&/^\s/.test(e.nextSibling.nodeValue)||r.appendChild(e.ownerDocument.createTextNode(" "))),r.normalize&&r.normalize(),r}return null}for(f=0;h>f;f++)d[f]&&(a=o(d[f],t,n,i),a&&(d[f]===a&&f--,s.appendChild(a)));if(t&&s.nodeName.toLowerCase()===g&&(!s.childNodes.length||/^\s*$/gi.test(s.innerHTML)&&(n||"_wysihtml5-temp-placeholder"!==e.className&&"rangySelectionBoundary"!==e.className)||!s.attributes.length)){for(r=s.ownerDocument.createDocumentFragment();s.firstChild;)r.appendChild(s.firstChild);return r.normalize&&r.normalize(),r}return s.normalize&&s.normalize(),s}function i(e,t){var n,o,i;for(n in t)if(t.hasOwnProperty(n)){wysihtml5.lang.object(t[n]).isFunction()?o=t[n]:"string"==typeof t[n]&&T[t[n]]&&(o=T[t[n]]),i=e.querySelectorAll(n);for(var r=i.length;r--;)o(i[r])}}function r(e,t){var n,o,i,r=v.tags,a=e.nodeName.toLowerCase(),c=e.scopeName;if(e._wysihtml5)return null;if(e._wysihtml5=1,"wysihtml5-temp"===e.className)return null;if(c&&"HTML"!=c&&(a=c+":"+a),"outerHTML"in e&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==e.nodeName||"</p>"===e.outerHTML.slice(-4).toLowerCase()||(a="div")),a in r){if(n=r[a],!n||n.remove)return null;if(n.unwrap)return!1;n="string"==typeof n?{rename_tag:n}:n}else{if(!e.firstChild)return null;n={rename_tag:g}}if(n.one_of_type&&!s(e,v,n.one_of_type,t)){if(!n.remove_action)return null;if("unwrap"===n.remove_action)return!1;if("rename"!==n.remove_action)return null;i=n.remove_action_rename_to||g}return o=e.ownerDocument.createElement(i||n.rename_tag||a),u(e,o,n,t),l(e,o,n),e=null,o.normalize&&o.normalize(),o}function s(e,t,n,o){var i,r;if("SPAN"===e.nodeName&&!o&&("_wysihtml5-temp-placeholder"===e.className||"rangySelectionBoundary"===e.className))return!0;for(r in n)if(n.hasOwnProperty(r)&&t.type_definitions&&t.type_definitions[r]&&(i=t.type_definitions[r],a(e,i)))return!0;return!1}function a(e,t){var n,o,i,r,s,a=e.getAttribute("class"),l=e.getAttribute("style");if(t.methods)for(var c in t.methods)if(t.methods.hasOwnProperty(c)&&S[c]&&S[c](e))return!0;if(a&&t.classes){a=a.replace(/^\s+/g,"").replace(/\s+$/g,"").split(y),n=a.length;for(var d=0;n>d;d++)if(t.classes[a[d]])return!0}if(l&&t.styles){l=l.split(";");for(o in t.styles)if(t.styles.hasOwnProperty(o))for(var h=l.length;h--;)if(s=l[h].split(":"),s[0].replace(/\s/g,"").toLowerCase()===o&&(t.styles[o]===!0||1===t.styles[o]||wysihtml5.lang.array(t.styles[o]).contains(s[1].replace(/\s/g,"").toLowerCase())))return!0}if(t.attrs)for(i in t.attrs)if(t.attrs.hasOwnProperty(i)&&(r=wysihtml5.dom.getAttribute(e,i),"string"==typeof r&&r.search(t.attrs[i])>-1))return!0;return!1}function l(e,t,n){var o,i;if(n&&n.keep_styles)for(o in n.keep_styles)if(n.keep_styles.hasOwnProperty(o)){if(i="float"===o?e.style.styleFloat||e.style.cssFloat:e.style[o],n.keep_styles[o]instanceof RegExp&&!n.keep_styles[o].test(i))continue;"float"===o?t.style[e.style.styleFloat?"styleFloat":"cssFloat"]=i:e.style[o]&&(t.style[o]=i)}}function c(e,t){var n=[];for(var o in t)t.hasOwnProperty(o)&&0===o.indexOf(e)&&n.push(o);return n}function d(e,t,n,o){var i,r=wysihtml5.lang.object(n).isFunction()?n:C[n];return r&&(i=r(t,o),"string"==typeof i)?i:!1}function h(e,t){var n,o,i,r=wysihtml5.lang.object(v.attributes||{}).clone(),s=wysihtml5.lang.object(r).merge(wysihtml5.lang.object(t||{}).clone()).get(),a={},l=wysihtml5.dom.getAttributes(e);for(n in s)if(/\*$/.test(n)){i=c(n.slice(0,-1),l);for(var h=0,u=i.length;u>h;h++)o=d(i[h],l[i[h]],s[n],e.nodeName),o!==!1&&(a[i[h]]=o)}else o=d(n,l[n],s[n],e.nodeName),o!==!1&&(a[n]=o);return a}function u(e,t,n,o){var i,r,s,a,l,c={},d=n.set_class,u=n.add_class,f=n.add_style,m=n.set_attributes,p=v.classes,g=0,w=[],b=[],C=[],S=[];if(m&&(c=wysihtml5.lang.object(m).clone()),c=wysihtml5.lang.object(c).merge(h(e,n.check_attributes)).get(),d&&w.push(d),u)for(a in u)l=N[u[a]],l&&(s=l(wysihtml5.dom.getAttribute(e,a)),"string"==typeof s&&w.push(s));if(f)for(a in f)l=x[f[a]],l&&(newStyle=l(wysihtml5.dom.getAttribute(e,a)),"string"==typeof newStyle&&b.push(newStyle));if("string"==typeof p&&"any"===p&&e.getAttribute("class"))if(v.classes_blacklist){for(S=e.getAttribute("class"),S&&(w=w.concat(S.split(y))),i=w.length;i>g;g++)r=w[g],v.classes_blacklist[r]||C.push(r);C.length&&(c["class"]=wysihtml5.lang.array(C).unique().join(" "))}else c["class"]=e.getAttribute("class");else{for(o||(p["_wysihtml5-temp-placeholder"]=1,p._rangySelectionBoundary=1,p["wysiwyg-tmp-selected-cell"]=1),S=e.getAttribute("class"),S&&(w=w.concat(S.split(y))),i=w.length;i>g;g++)r=w[g],p[r]&&C.push(r);C.length&&(c["class"]=wysihtml5.lang.array(C).unique().join(" "))}c["class"]&&o&&(c["class"]=c["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(c["class"])&&delete c["class"]),b.length&&(c.style=wysihtml5.lang.array(b).unique().join(" "));for(a in c)try{t.setAttribute(a,c[a])}catch(T){}c.src&&("undefined"!=typeof c.width&&t.setAttribute("width",c.width),"undefined"!=typeof c.height&&t.setAttribute("height",c.height))}function f(e){var t=e.nextSibling;if(!t||t.nodeType!==wysihtml5.TEXT_NODE){var n=e.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"");return e.ownerDocument.createTextNode(n)}t.data=e.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")+t.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")}function m(e){return v.comments?e.ownerDocument.createComment(e.nodeValue):void 0}var p={1:r,3:f,8:m},g="span",y=/\s+/,w={tags:{},classes:{}},v={},b=["ADDRESS","BLOCKQUOTE","CENTER","DIR","DIV","DL","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","ISINDEX","MENU","NOFRAMES","NOSCRIPT","OL","P","PRE","TABLE","UL"],C={url:function(){var e=/^https?:\/\//i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),src:function(){var e=/^(\/|https?:\/\/)/i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),href:function(){var e=/^(#|\/|https?:\/\/|mailto:|tel:)/i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),alt:function(){var e=/[^ a-z0-9_\-]/gi;return function(t,n){return t?t.replace(e,""):"IMG"===n?"":null}}(),numbers:function(){var e=/\D/g;return function(t){return t=(t||"").replace(e,""),t||null}}(),dimension:function(){var e=/\D*(\d+)(\.\d+)?\s?(%)?\D*/;return function(t){return t=(t||"").replace(e,"$1$2$3"),t||null}}(),any:function(){return function(e){return e?e:null}}()},x={align_text:function(){var e={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(t){return e[String(t).toLowerCase()]}}()},N={align_img:function(){var e={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return e[String(t).toLowerCase()]}}(),align_text:function(){var e={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return e[String(t).toLowerCase()]}}(),clear_br:function(){var e={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return e[String(t).toLowerCase()]}}(),size_font:function(){var e={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return e[String(t).charAt(0)]}}()},S={has_visible_contet:function(){var e,t=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(n){if(e=(n.innerText||n.textContent).replace(/\s/g,""),e&&e.length>0)return!0;for(var o=t.length;o--;)if(n.querySelector(t[o]))return!0;return n.offsetWidth&&n.offsetWidth>0&&n.offsetHeight&&n.offsetHeight>0?!0:!1}}()},T={unwrap:function(e){wysihtml5.dom.unwrap(e)},remove:function(e){e.parentNode.removeChild(e)}};return n(e,t)},wysihtml5.dom.removeEmptyTextNodes=function(e){for(var t,n=wysihtml5.lang.array(e.childNodes).get(),o=n.length,i=0;o>i;i++)t=n[i],t.nodeType===wysihtml5.TEXT_NODE&&/^[\n\r]*$/.test(t.data)&&t.parentNode.removeChild(t)},wysihtml5.dom.renameElement=function(e,t){for(var n,o=e.ownerDocument.createElement(t);n=e.firstChild;)o.appendChild(n);return wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(o),e.parentNode&&e.parentNode.replaceChild(o,e),o},wysihtml5.dom.replaceWithChildNodes=function(e){if(e.parentNode){if(!e.firstChild)return void e.parentNode.removeChild(e);for(var t=e.ownerDocument.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e),e=t=null}},function(e){function t(t){return"block"===e.getStyle("display").from(t)}function n(e){return"BR"===e.nodeName}function o(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}function i(e,i){if(e.nodeName.match(/^(MENU|UL|OL)$/)){var r,s,a,l,c,d,h,u=e.ownerDocument,f=u.createDocumentFragment(),m=wysihtml5.dom.domNode(e).prev({ignoreBlankTexts:!0}),p=wysihtml5.dom.domNode(e).next({ignoreBlankTexts:!0}),g=e.lastElementChild||e.lastChild;if(i)for(!m||t(m)||n(m)||o(f);d=e.firstElementChild||e.firstChild;){for(s=d.lastChild,h=d===g;r=d.firstChild;)a=r===s,l=(!h||p&&!t(p))&&a&&!t(r)&&!n(r),f.appendChild(r),l&&o(f);d.parentNode.removeChild(d)}else for(;d=e.firstElementChild||e.firstChild;){if(d.querySelector&&d.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;r=d.firstChild;)f.appendChild(r);else{for(c=u.createElement("p");r=d.firstChild;)c.appendChild(r);f.appendChild(c)}d.parentNode.removeChild(d)}e.parentNode.replaceChild(f,e)}}e.resolveList=i}(wysihtml5.dom),function(e){var t=document,n=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],o=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],i=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(t,n){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),this.config.className||(this.config.className="wysihtml5-sandbox"),this.editableArea=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=t.getElementById(e)),e.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var n=this,o=t.createElement("iframe");return o.className=this.config.className,e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(o),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(o.src="javascript:'<html></html>'"),o.onload=function(){o.onreadystatechange=o.onload=null,n._onLoadIframe(o)},o.onreadystatechange=function(){/loaded|complete/.test(o.readyState)&&(o.onreadystatechange=o.onload=null,
n._onLoadIframe(o))},o},_onLoadIframe:function(r){if(e.dom.contains(t.documentElement,r)){var s=this,a=r.contentWindow,l=r.contentWindow.document,c=t.characterSet||t.charset||"utf-8",d=this._getHtml({charset:c,stylesheets:this.config.stylesheets});if(l.open("text/html","replace"),l.write(d),l.close(),this.getWindow=function(){return r.contentWindow},this.getDocument=function(){return r.contentWindow.document},a.onerror=function(e,t,n){throw new Error("wysihtml5.Sandbox: "+e,t,n)},!e.browser.supportsSandboxedIframes()){var h,u;for(h=0,u=n.length;u>h;h++)this._unset(a,n[h]);for(h=0,u=o.length;u>h;h++)this._unset(a,o[h],e.EMPTY_FUNCTION);for(h=0,u=i.length;u>h;h++)this._unset(l,i[h]);this._unset(l,"cookie","",!0)}e.polyfills&&e.polyfills(a,l),this.loaded=!0,setTimeout(function(){s.callback(s)},0)}},_getHtml:function(t){var n,o=t.stylesheets,i="",r=0;if(o="string"==typeof o?[o]:o)for(n=o.length;n>r;r++)i+='<link rel="stylesheet" href="'+o[r]+'">';return t.stylesheets=i,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function(t,n,o,i){try{t[n]=o}catch(r){}try{t.__defineGetter__(n,function(){return o})}catch(r){}if(i)try{t.__defineSetter__(n,function(){})}catch(r){}if(!e.browser.crashesWhenDefineProperty(n))try{var s={get:function(){return o}};i&&(s.set=function(){}),Object.defineProperty(t,n,s)}catch(r){}}})}(wysihtml5),function(e){var t=document;e.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView||this.element.ownerDocument.parentWindow},getDocument:function(){return this.element.ownerDocument},constructor:function(t,n,o){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),this.config.className||(this.config.className="wysihtml5-sandbox"),o?this.element=this._bindElement(o):this.element=this._createElement()},_createElement:function(){var e=t.createElement("div");return e.className=this.config.className,this._loadElement(e),e},_bindElement:function(e){return e.className=e.className?e.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(e,!0),e},_loadElement:function(e,t){var n=this;if(!t){var o=this._getHtml();e.innerHTML=o}this.loaded=!0,setTimeout(function(){n.callback(n)},0)},_getHtml:function(e){return""}})}(wysihtml5),function(){var e={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(n){for(var o in t)n.setAttribute(e[o]||o,t[o])}}}}(),wysihtml5.dom.setStyles=function(e){return{on:function(t){var n=t.style;if("string"==typeof e)return void(n.cssText+=";"+e);for(var o in e)"float"===o?(n.cssFloat=e[o],n.styleFloat=e[o]):n[o]=e[o]}}},function(e){e.simulatePlaceholder=function(t,n,o,i){var r=i||"wysihtml5-placeholder",s=function(){var t=n.element.offsetWidth>0&&n.element.offsetHeight>0;n.hasPlaceholderSet()&&(n.clear(),n.element.focus(),t&&setTimeout(function(){var e=n.selection.getSelection();e.focusNode&&e.anchorNode||n.selection.selectNode(n.element.firstChild||n.element)},0)),n.placeholderSet=!1,e.removeClass(n.element,r)},a=function(){n.isEmpty()&&!n.placeholderSet&&(n.placeholderSet=!0,n.setValue(o),e.addClass(n.element,r))};t.on("set_placeholder",a).on("unset_placeholder",s).on("focus:composer",s).on("paste:composer",s).on("blur:composer",a),a()}}(wysihtml5.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(wysihtml5.dom),wysihtml5.dom.getAttribute=function(e,t){var n=!wysihtml5.browser.supportsGetAttributeCorrectly();t=t.toLowerCase();var o=e.nodeName;if("IMG"==o&&"src"==t&&wysihtml5.dom.isLoadedImage(e)===!0)return e.src;if(n&&"outerHTML"in e){var i=e.outerHTML.toLowerCase(),r=-1!=i.indexOf(" "+t+"=");return r?e.getAttribute(t):null}return e.getAttribute(t)},wysihtml5.dom.getAttributes=function(e){var t,n=!wysihtml5.browser.supportsGetAttributeCorrectly(),o=e.nodeName,i=[];for(t in e.attributes)(e.attributes.hasOwnProperty&&e.attributes.hasOwnProperty(t)||!e.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(e.attributes,t))&&e.attributes[t].specified&&("IMG"==o&&"src"==e.attributes[t].name.toLowerCase()&&wysihtml5.dom.isLoadedImage(e)===!0?i.src=e.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(e.attributes[t].name.toLowerCase())&&n?1!==e.attributes[t].value&&(i[e.attributes[t].name]=e.attributes[t].value):i[e.attributes[t].name]=e.attributes[t].value);return i},wysihtml5.dom.isLoadedImage=function(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(t){if(e.complete&&"complete"===e.readyState)return!0}},function(e){function t(e,t){for(var n,o=[],i=0,r=e.length;r>i;i++)if(n=e[i].querySelectorAll(t))for(var s=n.length;s--;o.unshift(n[s]));return o}function n(e){e.parentNode.removeChild(e)}function o(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function i(e,t){for(var n=e.nextSibling;1!=n.nodeType;)if(n=n.nextSibling,!t||t==n.tagName.toLowerCase())return n;return null}var r=e.dom,s=function(e){this.el=e,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},a=function(e,t){e?(this.cell=e,this.table=r.getParentElement(e,{query:"table"})):t&&(this.table=t,this.cell=this.table.querySelectorAll("th, td")[0])};a.prototype={addSpannedCellToMap:function(e,t,n,o,i,r){for(var a=[],l=n+(r?parseInt(r,10)-1:0),c=o+(i?parseInt(i,10)-1:0),d=n;l>=d;d++){"undefined"==typeof t[d]&&(t[d]=[]);for(var h=o;c>=h;h++)t[d][h]=new s(e),t[d][h].isColspan=i&&parseInt(i,10)>1,t[d][h].isRowspan=r&&parseInt(r,10)>1,t[d][h].firstCol=h==o,t[d][h].lastCol=h==c,t[d][h].firstRow=d==n,t[d][h].lastRow=d==l,t[d][h].isReal=h==o&&d==n,t[d][h].spanCollection=a,a.push(t[d][h])}},setCellAsModified:function(e){if(e.modified=!0,e.spanCollection.length>0)for(var t=0,n=e.spanCollection.length;n>t;t++)e.spanCollection[t].modified=!0},setTableMap:function(){var e,t,n,o,i,a,l,c,d=[],h=this.getTableRows();for(e=0;e<h.length;e++)for(t=h[e],n=this.getRowCells(t),a=0,"undefined"==typeof d[e]&&(d[e]=[]),o=0;o<n.length;o++){for(i=n[o];"undefined"!=typeof d[e][a];)a++;l=r.getAttribute(i,"colspan"),c=r.getAttribute(i,"rowspan"),l||c?(this.addSpannedCellToMap(i,d,e,a,l,c),a+=l?parseInt(l,10):1):(d[e][a]=new s(i),a++)}return this.map=d,d},getRowCells:function(n){var o=this.table.querySelectorAll("table"),i=o?t(o,"th, td"):[],r=n.querySelectorAll("th, td"),s=i.length>0?e.lang.array(r).without(i):r;return s},getTableRows:function(){var n=this.table.querySelectorAll("table"),o=n?t(n,"tr"):[],i=this.table.querySelectorAll("tr"),r=o.length>0?e.lang.array(i).without(o):i;return r},getMapIndex:function(e){for(var t=this.map.length,n=this.map&&this.map[0]?this.map[0].length:0,o=0;t>o;o++)for(var i=0;n>i;i++)if(this.map[o][i].el===e)return{row:o,col:i};return!1},getElementAtIndex:function(e){return this.setTableMap(),this.map[e.row]&&this.map[e.row][e.col]&&this.map[e.row][e.col].el?this.map[e.row][e.col].el:null},getMapElsTo:function(e){var t=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var n=this.idx_start;this.idx_start=this.idx_end,this.idx_end=n}if(this.idx_start.col>this.idx_end.col){var o=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=o}if(null!=this.idx_start&&null!=this.idx_end)for(var i=this.idx_start.row,r=this.idx_end.row;r>=i;i++)for(var s=this.idx_start.col,a=this.idx_end.col;a>=s;s++)t.push(this.map[i][s].el);return t},orderSelectionEnds:function(e){if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var n=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=n}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(e,t,n){for(var o,i=this.table.ownerDocument,r=i.createDocumentFragment(),s=0;t>s;s++){if(o=i.createElement(e),n)for(var a in n)n.hasOwnProperty(a)&&o.setAttribute(a,n[a]);o.appendChild(document.createTextNode("\xa0")),r.appendChild(o)}return r},correctColIndexForUnreals:function(e,t){for(var n=this.map[t],o=-1,i=0;e>i;i++)n[i].isReal&&o++;return o},getLastNewCellOnRow:function(e,t){for(var n,o,i=this.getRowCells(e),r=0,s=i.length;s>r;r++)if(n=i[r],o=this.getMapIndex(n),o===!1||"undefined"!=typeof t&&o.row!=t)return n;return null},removeEmptyTable:function(){var e=this.table.querySelectorAll("td, th");return e&&0!=e.length?!1:(n(this.table),!0)},splitRowToCells:function(e){if(e.isColspan){var t=parseInt(r.getAttribute(e.el,"colspan")||1,10),n=e.el.tagName.toLowerCase();if(t>1){var i=this.createCells(n,t-1);o(e.el,i)}e.el.removeAttribute("colspan")}},getRealRowEl:function(e,t){var n=null,o=null;t=t||this.idx;for(var i=0,s=this.map[t.row].length;s>i;i++)if(o=this.map[t.row][i],o.isReal&&(n=r.getParentElement(o.el,{query:"tr"})))return n;return null===n&&e&&(n=r.getParentElement(this.map[t.row][t.col].el,{query:"tr"})||null),n},injectRowAt:function(e,t,n,i,s){var a=this.getRealRowEl(!1,{row:e,col:t}),l=this.createCells(i,n);if(a){var c=this.correctColIndexForUnreals(t,e);c>=0?o(this.getRowCells(a)[c],l):a.insertBefore(l,a.firstChild)}else{var d=this.table.ownerDocument.createElement("tr");d.appendChild(l),o(r.getParentElement(s.el,{query:"tr"}),d)}},canMerge:function(e){if(this.to=e,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var n=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=n}for(var o=this.idx_start.row,i=this.idx_end.row;i>=o;o++)for(var r=this.idx_start.col,s=this.idx_end.col;s>=r;r++)if(this.map[o][r].isColspan||this.map[o][r].isRowspan)return!1;return!0},decreaseCellSpan:function(e,t){var n=parseInt(r.getAttribute(e.el,t),10)-1;n>=1?e.el.setAttribute(t,n):(e.el.removeAttribute(t),"colspan"==t&&(e.isColspan=!1),"rowspan"==t&&(e.isRowspan=!1),e.firstCol=!0,e.lastCol=!0,e.firstRow=!0,e.lastRow=!0,e.isReal=!0)},removeSurplusLines:function(){var e,t,o,i,s,a,l;if(this.setTableMap(),this.map){for(o=0,i=this.map.length;i>o;o++){for(e=this.map[o],l=!0,s=0,a=e.length;a>s;s++)if(t=e[s],!(r.getAttribute(t.el,"rowspan")&&parseInt(r.getAttribute(t.el,"rowspan"),10)>1&&t.firstRow!==!0)){l=!1;break}if(l)for(s=0;a>s;s++)this.decreaseCellSpan(e[s],"rowspan")}var c=this.getTableRows();for(o=0,i=c.length;i>o;o++)e=c[o],0==e.childNodes.length&&/^\s*$/.test(e.textContent||e.innerText)&&n(e)}},fillMissingCells:function(){var e=0,t=0,n=null;if(this.setTableMap(),this.map){e=this.map.length;for(var i=0;e>i;i++)this.map[i].length>t&&(t=this.map[i].length);for(var r=0;e>r;r++)for(var a=0;t>a;a++)this.map[r]&&!this.map[r][a]&&a>0&&(this.map[r][a]=new s(this.createCells("td",1)),n=this.map[r][a-1],n&&n.el&&n.el.parent&&o(this.map[r][a-1].el,this.map[r][a].el))}},rectify:function(){return this.removeEmptyTable()?!1:(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var e=this.map[this.idx.row][this.idx.col],t=r.getAttribute(e.el,"colspan")?parseInt(r.getAttribute(e.el,"colspan"),10):1,n=e.el.tagName.toLowerCase();if(e.isRowspan){var o=parseInt(r.getAttribute(e.el,"rowspan"),10);if(o>1)for(var i=1,s=o-1;s>=i;i++)this.injectRowAt(this.idx.row+i,this.idx.col,t,n,e);e.el.removeAttribute("rowspan")}this.splitRowToCells(e)}},merge:function(e){if(this.rectify())if(this.canMerge(e)){for(var t=this.idx_end.row-this.idx_start.row+1,o=this.idx_end.col-this.idx_start.col+1,i=this.idx_start.row,r=this.idx_end.row;r>=i;i++)for(var s=this.idx_start.col,a=this.idx_end.col;a>=s;s++)i==this.idx_start.row&&s==this.idx_start.col?(t>1&&this.map[i][s].el.setAttribute("rowspan",t),o>1&&this.map[i][s].el.setAttribute("colspan",o)):(/^\s*<br\/?>\s*$/.test(this.map[i][s].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[i][s].el.innerHTML),n(this.map[i][s].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(e){var t=this.getMapIndex(e.el),n=t.row+1,i={row:n,col:t.col};if(n<this.map.length){var s=this.getRealRowEl(!1,i);if(null!==s){var a=this.correctColIndexForUnreals(i.col,i.row);if(a>=0)o(this.getRowCells(s)[a],e.el);else{var l=this.getLastNewCellOnRow(s,n);null!==l?o(l,e.el):s.insertBefore(e.el,s.firstChild)}parseInt(r.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(r.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")}}},removeRowCell:function(e){e.isReal?e.isRowspan?this.collapseCellToNextRow(e):n(e.el):parseInt(r.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(r.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var e=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var t=this.map[this.idx.row],n=0,o=t.length;o>n;n++)t[n].isReal&&e.push(t[n].el);return e},getColumnElementsByCell:function(){var e=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var t=0,n=this.map.length;n>t;t++)this.map[t][this.idx.col]&&this.map[t][this.idx.col].isReal&&e.push(this.map[t][this.idx.col].el);return e},removeRow:function(){var e=r.getParentElement(this.cell,{query:"tr"});if(e){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var t=this.map[this.idx.row],o=0,i=t.length;i>o;o++)t[o].modified||(this.setCellAsModified(t[o]),this.removeRowCell(t[o]));n(e)}},removeColCell:function(e){e.isColspan?parseInt(r.getAttribute(e.el,"colspan"),10)>2?e.el.setAttribute("colspan",parseInt(r.getAttribute(e.el,"colspan"),10)-1):e.el.removeAttribute("colspan"):e.isReal&&n(e.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var e=0,t=this.map.length;t>e;e++)this.map[e][this.idx.col].modified||(this.setCellAsModified(this.map[e][this.idx.col]),this.removeColCell(this.map[e][this.idx.col]))},remove:function(e){if(this.rectify()){switch(e){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(e){var t=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==e&&r.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(r.getAttribute(this.cell,"rowspan"),10)-1),this.idx!==!1){for(var n=this.map[this.idx.row],i=t.createElement("tr"),s=0,a=n.length;a>s;s++)n[s].modified||(this.setCellAsModified(n[s]),this.addRowCell(n[s],i,e));switch(e){case"below":o(this.getRealRowEl(!0),i);break;case"above":var l=r.getParentElement(this.map[this.idx.row][this.idx.col].el,{query:"tr"});l&&l.parentNode.insertBefore(i,l)}}},addRowCell:function(e,t,n){var o=e.isColspan?{colspan:r.getAttribute(e.el,"colspan")}:null;e.isReal?"above"!=n&&e.isRowspan?e.el.setAttribute("rowspan",parseInt(r.getAttribute(e.el,"rowspan"),10)+1):t.appendChild(this.createCells("td",1,o)):"above"!=n&&e.isRowspan&&e.lastRow?t.appendChild(this.createCells("td",1,o)):c.isRowspan&&e.el.attr("rowspan",parseInt(r.getAttribute(e.el,"rowspan"),10)+1)},add:function(e){this.rectify()&&(("below"==e||"above"==e)&&this.addRow(e),("before"==e||"after"==e)&&this.addColumn(e))},addColCell:function(e,t,n){var i,s=e.el.tagName.toLowerCase();switch(n){case"before":i=!e.isColspan||e.firstCol;break;case"after":i=!e.isColspan||e.lastCol||e.isColspan&&c.el==this.cell}if(i){switch(n){case"before":e.el.parentNode.insertBefore(this.createCells(s,1),e.el);break;case"after":o(e.el,this.createCells(s,1))}e.isRowspan&&this.handleCellAddWithRowspan(e,t+1,n)}else e.el.setAttribute("colspan",parseInt(r.getAttribute(e.el,"colspan"),10)+1)},addColumn:function(e){var t,n;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==e&&r.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(r.getAttribute(this.cell,"colspan"),10)-1),this.idx!==!1)for(var o=0,i=this.map.length;i>o;o++)t=this.map[o],t[this.idx.col]&&(n=t[this.idx.col],n.modified||(this.setCellAsModified(n),this.addColCell(n,o,e)))},handleCellAddWithRowspan:function(e,t,n){for(var s,a,l,c=parseInt(r.getAttribute(this.cell,"rowspan"),10)-1,d=r.getParentElement(e.el,{query:"tr"}),h=e.el.tagName.toLowerCase(),u=this.table.ownerDocument,f=0;c>f;f++)if(s=this.correctColIndexForUnreals(this.idx.col,t+f),d=i(d,"tr"))if(s>0)switch(n){case"before":a=this.getRowCells(d),s>0&&this.map[t+f][this.idx.col].el!=a[s]&&s==a.length-1?o(a[s],this.createCells(h,1)):a[s].parentNode.insertBefore(this.createCells(h,1),a[s]);break;case"after":o(this.getRowCells(d)[s],this.createCells(h,1))}else d.insertBefore(this.createCells(h,1),d.firstChild);else l=u.createElement("tr"),l.appendChild(this.createCells(h,1)),this.table.appendChild(l)}},r.table={getCellsBetween:function(e,t){var n=new a(e);return n.getMapElsTo(t)},addCells:function(e,t){var n=new a(e);n.add(t)},removeCells:function(e,t){var n=new a(e);n.remove(t)},mergeCellsBetween:function(e,t){var n=new a(e);n.merge(t)},unmergeCell:function(e){var t=new a(e);t.unmerge()},orderSelectionEnds:function(e,t){var n=new a(e);return n.orderSelectionEnds(t)},indexOf:function(e){var t=new a(e);return t.setTableMap(),t.getMapIndex(e)},findCell:function(e,t){var n=new a(null,e);return n.getElementAtIndex(t)},findRowByCell:function(e){var t=new a(e);return t.getRowElementsByCell()},findColumnByCell:function(e){var t=new a(e);return t.getColumnElementsByCell()},canMerge:function(e,t){var n=new a(e);return n.canMerge(t)}}}(wysihtml5),wysihtml5.dom.query=function(e,t){var n,o=[];e.nodeType&&(e=[e]);for(var i=0,r=e.length;r>i;i++)if(n=e[i].querySelectorAll(t))for(var s=n.length;s--;o.unshift(n[s]));return o},wysihtml5.dom.compareDocumentPosition=function(){var e=document.documentElement;return e.compareDocumentPosition?function(e,t){return e.compareDocumentPosition(t)}:function(e,t){var n,o;if(n=9===e.nodeType?e:e.ownerDocument,o=9===t.nodeType?t:t.ownerDocument,e===t)return 0;if(e===t.ownerDocument)return 20;if(e.ownerDocument===t)return 10;if(n!==o)return 1;if(2===e.nodeType&&e.childNodes&&-1!==wysihtml5.lang.array(e.childNodes).indexOf(t))return 20;if(2===t.nodeType&&t.childNodes&&-1!==wysihtml5.lang.array(t.childNodes).indexOf(e))return 10;for(var i=e,r=[],s=null;i;){if(i==t)return 10;r.push(i),i=i.parentNode}for(i=t,s=null;i;){if(i==e)return 20;var a=wysihtml5.lang.array(r).indexOf(i);if(-1!==a){var l=r[a],c=wysihtml5.lang.array(l.childNodes).indexOf(r[a-1]),d=wysihtml5.lang.array(l.childNodes).indexOf(s);return c>d?2:4}s=i,i=i.parentNode}return 1}}(),wysihtml5.dom.unwrap=function(e){var t=[];if(e.parentNode){for(;e.lastChild;)t.unshift(e.lastChild),wysihtml5.dom.insert(e.lastChild).after(e);e.parentNode.removeChild(e)}return t},wysihtml5.dom.getPastedHtml=function(e){var t;return e.clipboardData&&(wysihtml5.lang.array(e.clipboardData.types).contains("text/html")?t=e.clipboardData.getData("text/html"):wysihtml5.lang.array(e.clipboardData.types).contains("text/plain")&&(t=wysihtml5.lang.string(e.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),t},wysihtml5.dom.getPastedHtmlWithDiv=function(e,t){var n=e.selection.getBookmark(),o=e.element.ownerDocument,i=o.createElement("DIV"),r=e.getScrollPos();o.body.appendChild(i),i.style.width="1px",i.style.height="1px",i.style.overflow="hidden",i.style.position="absolute",i.style.top=r.y+"px",i.style.left=r.x+"px",i.setAttribute("contenteditable","true"),i.focus(),setTimeout(function(){var o;e.selection.setBookmark(n),o=i.innerHTML,o&&/^<br\/?>$/i.test(o.trim())&&(o=!1),t(o),i.parentNode.removeChild(i)},0)},wysihtml5.dom.removeInvisibleSpaces=function(e){for(var t=wysihtml5.dom.getTextNodes(e),n=t.length;n--;)t[n].nodeValue=t[n].nodeValue.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")},wysihtml5.quirks.cleanPastedHTML=function(){var e=function(e){var t=wysihtml5.lang.string(e).trim(),n=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^((?!^"+n+"$).)*$","i")},t=function(t,n){var o,i,r=wysihtml5.lang.object(t).clone(!0);for(o in r.tags)if(r.tags.hasOwnProperty(o)&&r.tags[o].keep_styles)for(i in r.tags[o].keep_styles)r.tags[o].keep_styles.hasOwnProperty(i)&&n[i]&&(r.tags[o].keep_styles[i]=e(n[i]));return r},n=function(e,t){var n;if(!e)return null;for(var o=0,i=e.length;i>o;o++)if(e[o].condition||(n=e[o].set),e[o].condition&&e[o].condition.test(t))return e[o].set;return n};return function(e,o){var i,r={color:wysihtml5.dom.getStyle("color").from(o.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(o.referenceNode)},s=t(n(o.rules,e)||{},r);return i=wysihtml5.dom.parse(e,{rules:s,cleanUp:!0,context:o.referenceNode.ownerDocument,uneditableClass:o.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}(),wysihtml5.quirks.ensureProperClearing=function(){var e=function(){var e=this;setTimeout(function(){var t=e.innerHTML.toLowerCase();("<p>&nbsp;</p>"==t||"<p>&nbsp;</p><p>&nbsp;</p>"==t)&&(e.innerHTML="")},0)};return function(t){wysihtml5.dom.observe(t.element,["cut","keydown"],e)}}(),function(e){var t="%7E";e.quirks.getCorrectInnerHTML=function(n){var o=n.innerHTML;if(-1===o.indexOf(t))return o;var i,r,s,a,l=n.querySelectorAll("[href*='~'], [src*='~']");for(a=0,s=l.length;s>a;a++)i=l[a].href||l[a].src,r=e.lang.string(i).replace("~").by(t),o=e.lang.string(o).replace(r).by(i);return o}}(wysihtml5),function(e){var t="wysihtml5-quirks-redraw";e.quirks.redraw=function(n){e.dom.addClass(n,t),e.dom.removeClass(n,t);try{var o=n.ownerDocument;o.execCommand("italic",!1,null),o.execCommand("italic",!1,null)}catch(i){}}}(wysihtml5),wysihtml5.quirks.tableCellsSelection=function(e,t){function n(){return e.addEventListener("mousedown",f),h}function o(n){h.start=n,h.end=n,h.cells=[n],h.table=d.getParentElement(h.start,{query:"table"},!1,e),h.table&&(i(),d.addClass(n,u),e.addEventListener("mousemove",s),e.addEventListener("mouseup",a),t.fire("tableselectstart").fire("tableselectstart:composer"))}function i(){if(e){var t=e.querySelectorAll("."+u);if(t.length>0)for(var n=0;n<t.length;n++)d.removeClass(t[n],u)}}function r(e){for(var t=0;t<e.length;t++)d.addClass(e[t],u)}function s(n){var o,s=null,a=d.getParentElement(n.target,{query:"td, th"},!1,e);a&&h.table&&h.start&&(s=d.getParentElement(a,{query:"table"},!1,e),s&&s===h.table&&(i(),o=h.end,h.end=a,h.cells=d.table.getCellsBetween(h.start,a),h.cells.length>1&&t.composer.selection.deselect(),r(h.cells),h.end!==o&&t.fire("tableselectchange").fire("tableselectchange:composer")))}function a(n){e.removeEventListener("mousemove",s),e.removeEventListener("mouseup",a),t.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){l()},0)}function l(){e.ownerDocument.addEventListener("click",m)}function c(n,o){h.start=n,h.end=o,h.table=d.getParentElement(h.start,{query:"table"},!1,e),selectedCells=d.table.getCellsBetween(h.start,h.end),r(selectedCells),l(),t.fire("tableselect").fire("tableselect:composer")}var d=wysihtml5.dom,h={table:null,start:null,end:null,cells:null,select:c},u="wysiwyg-tmp-selected-cell",f=function(t){var n=wysihtml5.dom.getParentElement(t.target,{query:"td, th"},!1,e);n&&o(n)},m=function(n){e.ownerDocument.removeEventListener("click",m),d.getParentElement(n.target,{query:"table"},!1,e)!=h.table&&(i(),h.table=null,h.start=null,h.end=null,t.fire("tableunselect").fire("tableunselect:composer"))};return n()},function(e){function t(e){var t,n;for(t in o)if(o.hasOwnProperty(t)&&(n=o[t],n.regex.test(e)))return n}function n(e){var n=t(e);return n?n.name:void 0}var o={rgba:{regex:/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,name:"rgba"},rgb:{regex:/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,name:"rgb"},hex6:{regex:/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,name:"hex",radix:16},hex3:{regex:/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,name:"hex",radix:16}},i=function(e){return new RegExp("(^|\\s|;)"+e+"\\s*:\\s*[^;$]+","gi")};e.quirks.styleParser={getColorParseMethod:t,getColorFormat:n,parseColor:function(n,r){var s,a,l,c,d,h=n;if(r){if(s=i(r),!(a=n.match(s)))return!1;a=a.pop().split(":")[1],h=e.lang.string(a).trim()}return(l=t(h))&&(c=h.match(l.regex))?(d=l.radix||10,l===o.hex3?(c.shift(),c.push(1),e.lang.array(c).map(function(e,t){return 3>t?parseInt(e,d)*d+parseInt(e,d):parseFloat(e)})):(c.shift(),c[3]||c.push(1),e.lang.array(c).map(function(e,t){return 3>t?parseInt(e,d):parseFloat(e)}))):!1},unparseColor:function(e,t){var n=16;return"hex"===t?(e[0].toString(n)+e[1].toString(n)+e[2].toString(n)).toUpperCase():"hash"===t?"#"+(e[0].toString(n)+e[1].toString(n)+e[2].toString(n)).toUpperCase():"rgb"===t?"rgb("+e[0]+","+e[1]+","+e[2]+")":"rgba"===t?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"csv"===t?e[0]+","+e[1]+","+e[2]+","+e[3]:e[3]&&1!==e[3]?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"rgb("+e[0]+","+e[1]+","+e[2]+")"},parseFontSize:function(t){var n=t.match(i("font-size"));return n?e.lang.string(n[n.length-1].split(":")[1]).trim():!1}}}(wysihtml5),function(e){function t(e){var t=0;if(e.parentNode)do t+=e.offsetTop||0,e=e.offsetParent;while(e);return t}function n(e,t){for(var n=0;t!==e;)if(n++,t=t.parentNode,!t)throw new Error("not a descendant of ancestor!");return n}function o(t){var n=document.createElement("span"),o=function(e){t.removeEventListener("mouseup",o),t.removeEventListener("keydown",o),t.removeEventListener("touchstart",o),t.removeEventListener("focus",o),t.removeEventListener("blur",o),t.removeEventListener("paste",i),t.removeEventListener("drop",i),t.removeEventListener("beforepaste",i),n&&n.parentNode&&n.parentNode.removeChild(n)},i=function(e){n&&n.parentNode&&setTimeout(o,0)};return n.appendChild(document.createTextNode(e.INVISIBLE_SPACE)),n.className="_wysihtml5-temp-caret-fix",n.style.display="block",n.style.minWidth="1px",n.style.height="0px",t.addEventListener("mouseup",o),t.addEventListener("keydown",o),t.addEventListener("touchstart",o),t.addEventListener("focus",o),t.addEventListener("blur",o),t.addEventListener("paste",i),t.addEventListener("drop",i),t.addEventListener("beforepaste",i),n}function i(e){if(!e.canSurroundContents())for(var t=e.commonAncestorContainer,o=n(t,e.startContainer),i=n(t,e.endContainer);!e.canSurroundContents();)o>i?(e.setStartBefore(e.startContainer),o=n(t,e.startContainer)):(e.setEndAfter(e.endContainer),i=n(t,e.endContainer))}var r=e.dom;e.Selection=Base.extend({constructor:function(e,t,n){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc,this.win=this.composer.win,this.contain=t,this.unselectableClass=n||!1},getBookmark:function(){var e=this.getRange();return e&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},createTemporaryCaretSpaceAfter:function(t){var n=this.doc.createElement("span"),o=this.doc.createTextNode(e.INVISIBLE_SPACE),i=function(t){var o;this.contain.removeEventListener("mouseup",i),this.contain.removeEventListener("keydown",s),this.contain.removeEventListener("touchstart",i),this.contain.removeEventListener("focus",i),this.contain.removeEventListener("blur",i),this.contain.removeEventListener("paste",r),this.contain.removeEventListener("drop",r),this.contain.removeEventListener("beforepaste",r),n&&n.parentNode&&(n.innerHTML=n.innerHTML.replace(e.INVISIBLE_SPACE_REG_EXP,""),/[^\s]+/.test(n.innerHTML)?(o=n.lastChild,e.dom.unwrap(n),this.setAfter(o)):n.parentNode.removeChild(n))}.bind(this),r=function(e){n&&n.parentNode&&setTimeout(i,0)},s=function(e){8===e.which||91===e.which||17===e.which||86===e.which&&(e.ctrlKey||e.metaKey)||i()};return n.className="_wysihtml5-temp-caret-fix",n.style.position="absolute",n.style.display="block",n.style.minWidth="1px",n.style.zIndex="99999",n.appendChild(o),t.parentNode.insertBefore(n,t.nextSibling),this.setBefore(o),this.contain.addEventListener("mouseup",i),this.contain.addEventListener("keydown",s),this.contain.addEventListener("touchstart",i),this.contain.addEventListener("focus",i),this.contain.addEventListener("blur",i),this.contain.addEventListener("paste",r),this.contain.addEventListener("drop",r),this.contain.addEventListener("beforepaste",r),n},setAfter:function(t,n,o){var i,r=this.win,s=rangy.createRange(this.doc),a=function(){var o=t.parentNode,s=o?o.childNodes[o.childNodes.length-1]:null;if(!i||s===t&&1===t.nodeType&&"block"===r.getComputedStyle(t).display)if(n){var a=this.doc.createTextNode(e.INVISIBLE_SPACE);t.parentNode.insertBefore(a,t.nextSibling),this.selectNode(a),setTimeout(function(){a&&a.parentNode&&a.parentNode.removeChild(a)},0)}else this.createTemporaryCaretSpaceAfter(t)}.bind(this);if(s.setStartAfter(t),s.setEndAfter(t),document.activeElement&&document.activeElement===this.composer.element)i=this.setSelection(s),a(),o&&o(i);else{var l=this.composer.getScrollPos();this.composer.element.focus(),this.composer.setScrollPos(l),setTimeout(function(){i=this.setSelection(s),a(),o&&o(i)}.bind(this),0)}},selectNode:function(t,n){var o=rangy.createRange(this.doc),i=t.nodeType===e.ELEMENT_NODE,s="canHaveHTML"in t?t.canHaveHTML:"IMG"!==t.nodeName,a=i?t.innerHTML:t.data,l=""===a||a===e.INVISIBLE_SPACE,c=r.getStyle("display").from(t),d="block"===c||"list-item"===c;if(l&&i&&s&&!n)try{t.innerHTML=e.INVISIBLE_SPACE}catch(h){}s?o.selectNodeContents(t):o.selectNode(t),s&&l&&i?o.collapse(d):s&&l&&(o.setStartAfter(t),o.setEndAfter(t)),this.setSelection(o)},getSelectedNode:function(e){var t,n;return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(n=this.doc.selection.createRange(),n&&n.length)?n.item(0):(t=this.getSelection(this.doc),t.focusNode===t.anchorNode?t.focusNode:(n=this.getRange(this.doc),n?n.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var e=this.getRange();i(e),this.setSelection(e)},getSelectedOwnNodes:function(e){for(var t=this.getOwnRanges(),n=[],o=0,i=t.length;i>o;o++)n.push(t[o].commonAncestorContainer||this.doc.body);return n},findNodesInSelection:function(t){for(var n,o=this.getOwnRanges(),i=[],r=0,s=o.length;s>r;r++)n=o[r].getNodes([1],function(n){return e.lang.array(t).contains(n.nodeName)}),i=i.concat(n);return i},filterElements:function(e){for(var t,n=this.getOwnRanges(),o=[],i=0,r=n.length;r>i;i++)t=n[i].getNodes([1],function(t){return e(t,n[i])}),o=o.concat(t);return o},containsUneditable:function(){for(var e=this.getOwnUneditables(),t=this.getSelection(),n=0,o=e.length;o>n;n++)if(t.containsNode(e[n]))return!0;return!1},deleteContents:function(){var t,n,o,i,r=this.getRange();if(this.unselectableClass){(t=e.dom.getParentElement(r.startContainer,{query:"."+this.unselectableClass},!1,this.contain))&&r.setStartBefore(t),(n=e.dom.getParentElement(r.endContainer,{query:"."+this.unselectableClass},!1,this.contain))&&r.setEndAfter(n),o=r.getNodes([1],function(t){return e.dom.hasClass(t,this.unselectableClass)}.bind(this));for(var s=o.length;s--;)try{i=new CustomEvent("wysihtml5:uneditable:delete"),o[s].dispatchEvent(i)}catch(a){}}r.deleteContents(),this.setSelection(r)},getPreviousNode:function(t,n){var o;if(!t){var i=this.getSelection();t=i.anchorNode}if(t===this.contain)return!1;var r,s=t.previousSibling;return s===this.contain?!1:(s&&3!==s.nodeType&&1!==s.nodeType?s=this.getPreviousNode(s,n):s&&3===s.nodeType&&/^\s*$/.test(s.textContent)?s=this.getPreviousNode(s,n):n&&s&&1===s.nodeType?(o=e.dom.getStyle("display").from(s),e.lang.array(["BR","HR","IMG"]).contains(s.nodeName)||e.lang.array(["block","inline-block","flex","list-item","table"]).contains(o)||!/^[\s]*$/.test(s.innerHTML)||(s=this.getPreviousNode(s,n))):s||t===this.contain||(r=t.parentNode,r!==this.contain&&(s=this.getPreviousNode(r,n))),s!==this.contain?s:!1)},getSelectionParentsByTag:function(t){for(var n,o=this.getSelectedOwnNodes(),i=[],r=0,s=o.length;s>r;r++)n=o[r].nodeName&&"LI"===o[r].nodeName?o[r]:e.dom.getParentElement(o[r],{
query:"li"},!1,this.contain),n&&i.push(n);return i.length?i:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var e=this.getRange(),t=e.startContainer,n=e.startOffset,o=rangy.createRange(this.doc);return o.selectNodeContents(t),o.setStart(t,n),o}},caretIsLastInSelection:function(){var e=(rangy.createRange(this.doc),this.getSelection(),this.getRangeToNodeEnd().cloneContents()),t=e.textContent;return/^\s*$/.test(t)},caretIsFirstInSelection:function(){var t=rangy.createRange(this.doc),n=this.getSelection(),o=this.getRange(),i=o.startContainer;return i?i.nodeType===e.TEXT_NODE?this.isCollapsed()&&i.nodeType===e.TEXT_NODE&&/^\s*$/.test(i.data.substr(0,o.startOffset)):(t.selectNodeContents(this.getRange().commonAncestorContainer),t.collapse(!0),this.isCollapsed()&&(t.startContainer===n.anchorNode||t.endContainer===n.anchorNode)&&t.startOffset===n.anchorOffset):void 0},caretIsInTheBeginnig:function(t){var n=this.getSelection(),o=n.anchorNode,i=n.anchorOffset;return t&&o?0===i&&(o.nodeName&&o.nodeName===t.toUpperCase()||e.dom.getParentElement(o.parentNode,{query:t},1)):o?0===i&&!this.getPreviousNode(o,!0):void 0},getBeforeSelection:function(t){var n,o,i=this.getSelection(),r=i.isBackwards()?i.focusNode:i.anchorNode,s=i.isBackwards()?i.focusOffset:i.anchorOffset,a=this.createRange();if(o=e.dom.getParentElement(r,{query:"._wysihtml5-temp-caret-fix"},1),o&&(r=o.parentNode,s=Array.prototype.indexOf.call(r.childNodes,o)),r){if(s>0)return 3===r.nodeType?(a.setStart(r,0),a.setEnd(r,s),{type:"text",range:a,offset:s,node:r}):(a.setStartBefore(r.childNodes[0]),n=r.childNodes[s-1],a.setEndAfter(n),{type:"element",range:a,offset:s,node:n});if(a.setStartAndEnd(r,0),t){var l=this.getPreviousNode(r,!0),c=null;if(l&&(c=1===l.nodeType&&e.dom.hasClass(l,this.unselectableClass)?l:e.dom.domNode(l).lastLeafNode()),c)return{type:"leafnode",range:a,offset:s,node:c}}return{type:"none",range:a,offset:s,node:r}}return null},executeAndRestoreRangy:function(e,t){var n=rangy.saveSelection(this.win);if(n)try{e()}catch(o){setTimeout(function(){throw o},0)}else e();rangy.restoreSelection(n)},executeAndRestore:function(t,n){var o,i,s,a,l,c,d,h,u=this.doc.body,f=n&&u.scrollTop,m=n&&u.scrollLeft,p="_wysihtml5-temp-placeholder",g='<span class="'+p+'">'+e.INVISIBLE_SPACE+"</span>",y=this.getRange(!0);if(!y)return void t(u,u);y.collapsed||(d=y.cloneRange(),c=d.createContextualFragment(g),d.collapse(!1),d.insertNode(c),d.detach()),l=y.createContextualFragment(g),y.insertNode(l),c&&(o=this.contain.querySelectorAll("."+p),y.setStartBefore(o[0]),y.setEndAfter(o[o.length-1])),this.setSelection(y);try{t(y.startContainer,y.endContainer)}catch(w){setTimeout(function(){throw w},0)}if(o=this.contain.querySelectorAll("."+p),o&&o.length){h=rangy.createRange(this.doc),s=o[0].nextSibling,o.length>1&&(a=o[o.length-1].previousSibling),a&&s?(h.setStartBefore(s),h.setEndAfter(a)):(i=this.doc.createTextNode(e.INVISIBLE_SPACE),r.insert(i).after(o[0]),h.setStartBefore(i),h.setEndAfter(i)),this.setSelection(h);for(var v=o.length;v--;)o[v].parentNode.removeChild(o[v])}else this.contain.focus();n&&(u.scrollTop=f,u.scrollLeft=m);try{o.parentNode.removeChild(o)}catch(b){}},set:function(e,t){var n=rangy.createRange(this.doc);n.setStart(e,t||0),this.setSelection(n)},insertHTML:function(e){var t,n=(rangy.createRange(this.doc),this.doc.createElement("DIV")),o=this.doc.createDocumentFragment();for(n.innerHTML=e,t=n.lastChild;n.firstChild;)o.appendChild(n.firstChild);this.insertNode(o),t&&this.setAfter(t)},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},canAppendChild:function(e){var t,n,o=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],i=this.getRange();return t=e||i.startContainer,t&&(n=(t.tagName||t.nodeName).toLowerCase()),-1===o.indexOf(n)},splitElementAtCaret:function(t,n){var o,i,r,s,a,l=this.getSelection();if(l.rangeCount>0){o=l.getRangeAt(0).cloneRange(),o.setEndAfter(t),i=o.extractContents(),a=i.childNodes;for(var c=a.length;c--;)e.dom.domNode(a[c]).is.visible()||i.removeChild(a[c]);t.parentNode.insertBefore(i,t.nextSibling),n?(r=n.firstChild||n,s=n.lastChild||n,t.parentNode.insertBefore(n,t.nextSibling),r&&s&&(o.setStartBefore(r),o.setEndAfter(s),this.setSelection(o))):(o.setStartAfter(t),o.setEndAfter(t)),e.dom.domNode(t).is.visible()||(""===e.dom.getTextContent(t)?t.parentNode.removeChild(t):t.parentNode.replaceChild(this.doc.createTextNode(" "),t))}},surround:function(e){var t,n=this.getOwnRanges(),o=[];if(0==n.length)return o;for(var i=n.length;i--;){t=this.doc.createElement(e.nodeName),o.push(t),e.className&&(t.className=e.className),e.cssStyle&&t.setAttribute("style",e.cssStyle);try{n[i].surroundContents(t),this.selectNode(t)}catch(r){t.appendChild(n[i].extractContents()),n[i].insertNode(t)}}return o},deblockAndSurround:function(t){var n,o,i,r=this.doc.createElement("div"),s=rangy.createRange(this.doc);if(r.className=t.className,this.composer.commands.exec("formatBlock",t),n=this.contain.querySelectorAll("."+t.className),n[0])for(n[0].parentNode.insertBefore(r,n[0]),s.setStartBefore(n[0]),s.setEndAfter(n[n.length-1]),o=s.extractContents();o.firstChild;)if(i=o.firstChild,1==i.nodeType&&e.dom.hasClass(i,t.className)){for(;i.firstChild;)r.appendChild(i.firstChild);"BR"!==i.nodeName&&r.appendChild(this.doc.createElement("br")),o.removeChild(i)}else r.appendChild(i);else r=null;return r},scrollIntoView:function(){var n,o=this.doc,i=5,r=o.documentElement.scrollHeight>o.documentElement.offsetHeight,s=o._wysihtml5ScrollIntoViewElement=o._wysihtml5ScrollIntoViewElement||function(){var t=o.createElement("span");return t.innerHTML=e.INVISIBLE_SPACE,t}();r&&(this.insertNode(s),n=t(s),s.parentNode.removeChild(s),n>=o.body.scrollTop+o.documentElement.offsetHeight-i&&(o.body.scrollTop=n))},selectLine:function(){e.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var e=this.win.getSelection();e.modify("move","left","lineboundary"),e.modify("extend","right","lineboundary")},toLineBoundary:function(t,n){if(n="undefined"==typeof n?!1:n,e.browser.supportsSelectionModify()){var o=this.win.getSelection();o.modify("extend",t,"lineboundary"),n&&("left"===t?o.collapseToStart():"right"===t&&o.collapseToEnd())}},_selectLine_MSIE:function(){var e,t,n,o,i,r=this.doc.selection.createRange(),s=r.boundingTop,a=this.doc.body.scrollWidth;if(r.moveToPoint){for(0===s&&(n=this.doc.createElement("span"),this.insertNode(n),s=n.offsetTop,n.parentNode.removeChild(n)),s+=1,o=-10;a>o;o+=2)try{r.moveToPoint(o,s);break}catch(l){}for(e=s,t=this.doc.selection.createRange(),i=a;i>=0;i--)try{t.moveToPoint(i,e);break}catch(c){}r.setEndPoint("EndToEnd",t),r.select()}},getText:function(){var e=this.getSelection();return e?e.toString():""},getNodes:function(e,t){var n=this.getRange();return n?n.getNodes(Array.isArray(e)?e:[e],t):[]},getOwnNodes:function(e,t,n){for(var o=this.getOwnRanges(),i=[],r=0,s=o.length;s>r;r++)o[r]&&(n&&o[r].splitBoundaries(),i=i.concat(o[r].getNodes(Array.isArray(e)?e:[e],t)));return i},fixRangeOverflow:function(e){if(this.contain&&this.contain.firstChild&&e){var t=e.compareNode(this.contain);if(2!==t)1===t&&e.setStartBefore(this.contain.firstChild),0===t&&e.setEndAfter(this.contain.lastChild),3===t&&(e.setStartBefore(this.contain.firstChild),e.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(e)){var n=e.endContainer.previousElementSibling;n&&e.setEnd(n,this._endOffsetForNode(n))}}},_endOffsetForNode:function(e){var t=document.createRange();return t.selectNodeContents(e),t.endOffset},_detectInlineRangeProblems:function(e){var t=r.compareDocumentPosition(e.startContainer,e.endContainer);return 0==e.endOffset&&4&t},getRange:function(e){var t=this.getSelection(),n=t&&t.rangeCount&&t.getRangeAt(0);return e!==!0&&this.fixRangeOverflow(n),n},getOwnUneditables:function(){var t=r.query(this.contain,"."+this.unselectableClass),n=r.query(t,"."+this.unselectableClass);return e.lang.array(t).without(n)},getOwnRanges:function(){var e,t=[],n=this.getRange();if(n&&t.push(n),this.unselectableClass&&this.contain&&n){var o,i=this.getOwnUneditables();if(i.length>0)for(var r=0,s=i.length;s>r;r++){e=[];for(var a=0,l=t.length;l>a;a++){if(t[a])switch(t[a].compareNode(i[r])){case 2:break;case 3:o=t[a].cloneRange(),o.setEndBefore(i[r]),e.push(o),o=t[a].cloneRange(),o.setStartAfter(i[r]),e.push(o);break;default:e.push(t[a])}t=e}}}return t},getSelection:function(){return rangy.getSelection(this.win)},setSelection:function(e){var t=rangy.getSelection(this.win);return t.setSingleRange(e),t&&t.anchorNode&&t.focusNode?t:null},selectAll:function(){var t,n=this.createRange(),i=this.composer,r=this,s=o(this.composer.element),a=o(this.composer.element),l=function(){n.setStart(i.element,0),n.setEnd(i.element,i.element.childNodes.length),t=r.setSelection(n)},c=function(){return!t||t.nativeSelection&&t.nativeSelection.type&&("Caret"===t.nativeSelection.type||"None"===t.nativeSelection.type)};e.dom.removeInvisibleSpaces(this.composer.element),l(),this.composer.element.firstChild&&c()&&(this.composer.element.appendChild(s),l(),c()&&(s.parentNode.removeChild(s),this.composer.element.insertBefore(a,this.composer.element.firstChild),l(),c()&&(this.composer.element.appendChild(s),l())))},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},getPlainText:function(){return this.getSelection().toString()},isEndToEndInNode:function(t){var n=this.getRange(),o=n.commonAncestorContainer,i=n.startContainer,r=n.endContainer;if(o.nodeType===e.TEXT_NODE&&(o=o.parentNode),i.nodeType===e.TEXT_NODE&&!/^\s*$/.test(i.data.substr(n.startOffset)))return!1;if(r.nodeType===e.TEXT_NODE&&!/^\s*$/.test(r.data.substr(n.endOffset)))return!1;for(;i&&i!==o;){if(i.nodeType!==e.TEXT_NODE&&!e.dom.contains(o,i))return!1;if(e.dom.domNode(i).prev({ignoreBlankTexts:!0}))return!1;i=i.parentNode}for(;r&&r!==o;){if(r.nodeType!==e.TEXT_NODE&&!e.dom.contains(o,r))return!1;if(e.dom.domNode(r).next({ignoreBlankTexts:!0}))return!1;r=r.parentNode}return e.lang.array(t).contains(o.nodeName)?o:!1},isInThisEditable:function(){var t=this.getSelection(),n=t.focusNode,o=t.anchorNode;return n&&1!==n.nodeType&&(n=n.parentNode),o&&1!==o.nodeType&&(o=o.parentNode),o&&n&&(e.dom.contains(this.composer.element,n)||this.composer.element===n)&&(e.dom.contains(this.composer.element,o)||this.composer.element===o)},deselect:function(){var e=this.getSelection();e&&e.removeAllRanges()}})}(wysihtml5),function(e,t){function n(e,t,n){if(!e.className)return!1;var o=e.className.match(n)||[];return o[o.length-1]===t}function o(e,t){if(!e.getAttribute||!e.getAttribute("style"))return!1;e.getAttribute("style").match(t);return e.getAttribute("style").match(t)?!0:!1}function i(e,t,n){e.getAttribute("style")?(a(e,n),e.getAttribute("style")&&!/^\s*$/.test(e.getAttribute("style"))?e.setAttribute("style",t+";"+e.getAttribute("style")):e.setAttribute("style",t)):e.setAttribute("style",t)}function r(e,t,n){e.className?(s(e,n),e.className+=" "+t):e.className=t}function s(e,t){e.className&&(e.className=e.className.replace(t,""))}function a(e,t){var n,o=[];if(e.getAttribute("style")){n=e.getAttribute("style").split(";");for(var i=n.length;i--;)n[i].match(t)||/^\s*$/.test(n[i])||o.push(n[i]);o.length?e.setAttribute("style",o.join(";")):e.removeAttribute("style")}}function l(e,t){var n=[],o=t.split(";"),i=e.getAttribute("style");if(i){i=i.replace(/\s/gi,"").toLowerCase(),n.push(new RegExp("(^|\\s|;)"+t.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var r=o.length;r-->0;)/^\s*$/.test(o[r])||n.push(new RegExp("(^|\\s|;)"+o[r].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var s=0,a=n.length;a>s;s++)if(i.match(n[s]))return n[s]}return!1}function c(n,o,i,r){return i?l(n,i):r?e.dom.hasClass(n,r):t.dom.arrayContains(o,n.tagName.toLowerCase())}function d(e,t,n,o){for(var i=e.length;i--;)if(!c(e[i],t,n,o))return!1;return e.length?!0:!1}function h(e,t,n){var o=l(e,t);return o?(a(e,o),"remove"):(i(e,t,n),"change")}function u(e,t){return e.className.replace(b," ")==t.className.replace(b," ")}function f(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}function m(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,o,i,r=0,s=e.attributes.length;s>r;++r)if(n=e.attributes[r],i=n.name,"class"!=i){if(o=t.attributes.getNamedItem(i),n.specified!=o.specified)return!1;if(n.specified&&n.nodeValue!==o.nodeValue)return!1}return!0}function p(e,n){return t.dom.isCharacterDataNode(e)?0==n?!!e.previousSibling:n==e.length?!!e.nextSibling:!0:n>0&&n<e.childNodes.length}function g(e,n,o,i){var r;if(t.dom.isCharacterDataNode(n)&&(0==o?(o=t.dom.getNodeIndex(n),n=n.parentNode):o==n.length?(o=t.dom.getNodeIndex(n)+1,n=n.parentNode):r=t.dom.splitDataNode(n,o)),!(r||i&&n===i)){r=n.cloneNode(!1),r.id&&r.removeAttribute("id");for(var s;s=n.childNodes[o];)r.appendChild(s);t.dom.insertAfter(r,n)}return n==e?r:g(e,r.parentNode,t.dom.getNodeIndex(r),i)}function y(t){this.isElementMerge=t.nodeType==e.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function w(e,t,n,o,i,r,s){this.tagNames=e||[v],this.cssClass=t||(t===!1?!1:""),this.similarClassRegExp=n,this.cssStyle=i||"",this.similarStyleRegExp=r,this.normalize=o,this.applyToAnyTagName=!1,this.container=s}var v="span",b=/\s+/g;y.prototype={doMerge:function(){for(var e,t,n,o=[],i=0,r=this.textNodes.length;r>i;++i)e=this.textNodes[i],t=e.parentNode,o[i]=e.data,i&&(t.removeChild(e),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=n=o.join(""),n},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;n>t;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},w.prototype={getAncestorWithClass:function(o){for(var i;o;){if(i=this.cssClass?n(o,this.cssClass,this.similarClassRegExp):""!==this.cssStyle?!1:!0,o.nodeType==e.ELEMENT_NODE&&"false"!=o.getAttribute("contenteditable")&&t.dom.arrayContains(this.tagNames,o.tagName.toLowerCase())&&i)return o;o=o.parentNode}return!1},getAncestorWithStyle:function(n){for(var i;n;){if(i=this.cssStyle?o(n,this.similarStyleRegExp):!1,n.nodeType==e.ELEMENT_NODE&&"false"!=n.getAttribute("contenteditable")&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&i)return n;n=n.parentNode}return!1},getMatchingAncestor:function(e){var t=this.getAncestorWithClass(e),n=!1;return t?this.cssStyle&&(n="class"):(t=this.getAncestorWithStyle(e),t&&(n="style")),{element:t,type:n}},postApply:function(e,t){for(var n,o,i,r=e[0],s=e[e.length-1],a=[],l=r,c=s,d=0,h=s.length,u=0,f=e.length;f>u;++u)o=e[u],i=null,o&&o.parentNode&&(i=this.getAdjacentMergeableTextNode(o.parentNode,!1)),i?(n||(n=new y(i),a.push(n)),n.textNodes.push(o),o===r&&(l=n.firstTextNode,d=l.length),o===s&&(c=n.firstTextNode,h=n.getLength())):n=null;if(s&&s.parentNode){var m=this.getAdjacentMergeableTextNode(s.parentNode,!0);m&&(n||(n=new y(s),a.push(n)),n.textNodes.push(m))}if(a.length){for(u=0,f=a.length;f>u;++u)a[u].doMerge();t.setStart(l,d),t.setEnd(c,h)}},getAdjacentMergeableTextNode:function(t,n){var o,i=t.nodeType==e.TEXT_NODE,r=i?t.parentNode:t,s=n?"nextSibling":"previousSibling";if(i){if(o=t[s],o&&o.nodeType==e.TEXT_NODE)return o}else if(o=r[s],o&&this.areElementsMergeable(t,o))return o[n?"firstChild":"lastChild"];return null},areElementsMergeable:function(e,n){return t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase())&&u(e,n)&&m(e,n)},createContainer:function(e){var t=e.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),this.cssStyle&&t.setAttribute("style",this.cssStyle),t},applyToTextNode:function(e){var n=e.parentNode;if(1==n.childNodes.length&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase()))this.cssClass&&r(n,this.cssClass,this.similarClassRegExp),this.cssStyle&&i(n,this.cssStyle,this.similarStyleRegExp);else{var o=this.createContainer(t.dom.getDocument(e));e.parentNode.insertBefore(o,e),o.appendChild(e)}},isRemovable:function(n){return t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&""===e.lang.string(n.className).trim()&&(!n.getAttribute("style")||""===e.lang.string(n.getAttribute("style")).trim())},undoToTextNode:function(e,t,n,o){var i=n?!1:!0,r=n||o,a=!1;if(!t.containsNode(r)){var l=t.cloneRange();l.selectNode(r),l.isPointInRange(t.endContainer,t.endOffset)&&p(t.endContainer,t.endOffset)&&(g(r,t.endContainer,t.endOffset,this.container),t.setEndAfter(r)),l.isPointInRange(t.startContainer,t.startOffset)&&p(t.startContainer,t.startOffset)&&(r=g(r,t.startContainer,t.startOffset,this.container))}!i&&this.similarClassRegExp&&s(r,this.similarClassRegExp),i&&this.similarStyleRegExp&&(a="change"===h(r,this.cssStyle,this.similarStyleRegExp)),this.isRemovable(r)&&!a&&f(r)},applyToRange:function(t){for(var n,o=t.length;o--;){if(n=t[o].getNodes([e.TEXT_NODE]),!n.length)try{var i=this.createContainer(t[o].endContainer.ownerDocument);return t[o].surroundContents(i),void this.selectNode(t[o],i)}catch(r){}if(t[o].splitBoundaries(),n=t[o].getNodes([e.TEXT_NODE]),n.length){for(var s,a=0,l=n.length;l>a;++a)s=n[a],this.getMatchingAncestor(s).element||this.applyToTextNode(s);t[o].setStart(n[0],0),s=n[n.length-1],t[o].setEnd(s,s.length),this.normalize&&this.postApply(n,t[o])}}},undoToRange:function(t){for(var n,o,i,r=t.length;r--;){if(n=t[r].getNodes([e.TEXT_NODE]),n.length)t[r].splitBoundaries(),n=t[r].getNodes([e.TEXT_NODE]);else{var s=t[r].endContainer.ownerDocument,a=s.createTextNode(e.INVISIBLE_SPACE);t[r].insertNode(a),t[r].selectNode(a),n=[a]}for(var l=0,c=n.length;c>l;++l)t[r].isValid()&&(o=n[l],i=this.getMatchingAncestor(o),"style"===i.type?this.undoToTextNode(o,t[r],!1,i.element):i.element&&this.undoToTextNode(o,t[r],i.element));1==c?this.selectNode(t[r],n[0]):(t[r].setStart(n[0],0),o=n[n.length-1],t[r].setEnd(o,o.length),this.normalize&&this.postApply(n,t[r]))}},selectNode:function(t,n){var o=n.nodeType===e.ELEMENT_NODE,i="canHaveHTML"in n?n.canHaveHTML:!0,r=o?n.innerHTML:n.data,s=""===r||r===e.INVISIBLE_SPACE;if(s&&o&&i)try{n.innerHTML=e.INVISIBLE_SPACE}catch(a){}t.selectNodeContents(n),s&&o?t.collapse(!1):s&&(t.setStartAfter(n),t.setEndAfter(n))},getTextSelectedByRange:function(e,t){var n=t.cloneRange();n.selectNodeContents(e);var o=n.intersection(t),i=o?o.toString():"";return n.detach(),i},isAppliedToRange:function(t){for(var n,o,i=[],r="full",s=t.length;s--;){if(o=t[s].getNodes([e.TEXT_NODE]),!o.length)return n=this.getMatchingAncestor(t[s].startContainer).element,n?{elements:[n],coverage:r}:!1;for(var a,l=0,c=o.length;c>l;++l)a=this.getTextSelectedByRange(o[l],t[s]),n=this.getMatchingAncestor(o[l]).element,n&&""!=a?(i.push(n),1===e.dom.getTextNodes(n,!0).length?r="full":"full"===r&&(r="inline")):n||(r="partial")}return i.length?{elements:i,coverage:r}:!1},toggleRange:function(e){var t,n=this.isAppliedToRange(e);n?"full"===n.coverage?this.undoToRange(e):"inline"===n.coverage?(t=d(n.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(e),t||this.applyToRange(e)):(d(n.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(e),this.applyToRange(e)):this.applyToRange(e)}},e.selection.HTMLApplier=w}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return wysihtml5.browser.supportsCommand(this.doc,e)},exec:function(e,t){var n=wysihtml5.commands[e],o=wysihtml5.lang.array(arguments).get(),i=n&&n.exec,r=null;if(this.composer.hasPlaceholderSet()&&!wysihtml5.lang.array(["styleWithCSS","enableObjectResizing","enableInlineTableEditing"]).contains(e)&&(this.composer.element.innerHTML="",this.composer.selection.selectNode(this.composer.element)),this.editor.fire("beforecommand:composer"),i)o.unshift(this.composer),r=i.apply(n,o);else try{r=this.doc.execCommand(e,!1,t)}catch(s){}return this.editor.fire("aftercommand:composer"),r},remove:function(e,t){var n=wysihtml5.commands[e],o=wysihtml5.lang.array(arguments).get(),i=n&&n.remove;return i?(o.unshift(this.composer),i.apply(n,o)):void 0},state:function(e,t){var n=wysihtml5.commands[e],o=wysihtml5.lang.array(arguments).get(),i=n&&n.state;if(i)return o.unshift(this.composer),i.apply(n,o);try{return this.doc.queryCommandState(e)}catch(r){return!1}},stateValue:function(e){var t=wysihtml5.commands[e],n=wysihtml5.lang.array(arguments).get(),o=t&&t.stateValue;return o?(n.unshift(this.composer),o.apply(t,n)):!1}}),function(e){var t={nodeName:"B",toggle:!0};e.commands.bold={exec:function(n,o){e.commands.formatInline.exec(n,o,t)},state:function(n,o){return e.commands.formatInline.state(n,o,t)}}}(wysihtml5),function(e){function t(t){return e.lang.object({}).merge(n).merge({attribute:t}).get()}var n={nodeName:"A",toggle:!1};e.commands.createLink={exec:function(n,o,i){var r=t(i);if(n.selection.isCollapsed()&&!this.state(n,o)){var s=n.doc.createTextNode(r.attribute.href);n.selection.insertNode(s),n.selection.selectNode(s)}e.commands.formatInline.exec(n,o,r)},state:function(t,o){return e.commands.formatInline.state(t,o,n)}}}(wysihtml5),function(e){var t={nodeName:"A"};e.commands.removeLink={exec:function(n,o){e.commands.formatInline.remove(n,o,t)},state:function(n,o){return e.commands.formatInline.state(n,o,t)}}}(wysihtml5),function(e){var t=/wysiwyg-font-size-[0-9a-z\-]+/g;e.commands.fontSize={exec:function(n,o,i){e.commands.formatInline.exec(n,o,{className:"wysiwyg-font-size-"+i,classRegExp:t,toggle:!0})},state:function(t,n,o){return e.commands.formatInline.state(t,n,{className:"wysiwyg-font-size-"+o})}}}(wysihtml5),function(e){e.commands.fontSizeStyle={exec:function(t,n,o){o=o.size||o,/^\s*$/.test(o)||e.commands.formatInline.exec(t,n,{styleProperty:"fontSize",styleValue:o,toggle:!1})},state:function(t,n,o){return e.commands.formatInline.state(t,n,{styleProperty:"fontSize",styleValue:o||void 0})},remove:function(t,n){return e.commands.formatInline.remove(t,n,{styleProperty:"fontSize"})},stateValue:function(t,n){var o,i=this.state(t,n);return i&&e.lang.object(i).isArray()&&(i=i[0]),i&&(o=i.getAttribute("style"))?e.quirks.styleParser.parseFontSize(o):!1}}}(wysihtml5),function(e){var t=/wysiwyg-color-[0-9a-z]+/g;e.commands.foreColor={exec:function(n,o,i){e.commands.formatInline.exec(n,o,{className:"wysiwyg-color-"+i,classRegExp:t,toggle:!0})},state:function(t,n,o){return e.commands.formatInline.state(t,n,{className:"wysiwyg-color-"+o})}}}(wysihtml5),function(e){e.commands.foreColorStyle={exec:function(t,n,o){var i,r;o&&(i=e.quirks.styleParser.parseColor("color:"+(o.color||o),"color"),i&&(r=(1===i[3]?"rgb("+[i[0],i[1],i[2]].join(", "):"rgba("+i.join(", "))+")",e.commands.formatInline.exec(t,n,{styleProperty:"color",styleValue:r})))},state:function(t,n,o){var i,r=o?e.quirks.styleParser.parseColor("color:"+(o.color||o),"color"):null;return r&&(i=(1===r[3]?"rgb("+[r[0],r[1],r[2]].join(", "):"rgba("+r.join(", "))+")"),e.commands.formatInline.state(t,n,{styleProperty:"color",styleValue:i})},remove:function(t,n){return e.commands.formatInline.remove(t,n,{styleProperty:"color"})},stateValue:function(t,n,o){var i,r=this.state(t,n),s=!1;return r&&e.lang.object(r).isArray()&&(r=r[0]),r&&(i=r.getAttribute("style"))?(s=e.quirks.styleParser.parseColor(i,"color"),e.quirks.styleParser.unparseColor(s,o)):!1}}}(wysihtml5),function(e){e.commands.bgColorStyle={exec:function(t,n,o){var i,r=e.quirks.styleParser.parseColor("background-color:"+(o.color||o),"background-color");r&&(i=(1===r[3]?"rgb("+[r[0],r[1],r[2]].join(", "):"rgba("+r.join(", "))+")",e.commands.formatInline.exec(t,n,{styleProperty:"backgroundColor",styleValue:i}))},state:function(t,n,o){var i,r=o?e.quirks.styleParser.parseColor("background-color:"+(o.color||o),"background-color"):null;return r&&(i=(1===r[3]?"rgb("+[r[0],r[1],r[2]].join(", "):"rgba("+r.join(", "))+")"),e.commands.formatInline.state(t,n,{styleProperty:"backgroundColor",styleValue:i})},remove:function(t,n){return e.commands.formatInline.remove(t,n,{styleProperty:"backgroundColor"})},stateValue:function(t,n,o){var i,r=this.state(t,n),s=!1;return r&&e.lang.object(r).isArray()&&(r=r[0]),r&&(i=r.getAttribute("style"))?(s=e.quirks.styleParser.parseColor(i,"background-color"),e.quirks.styleParser.unparseColor(s,o)):!1}}}(wysihtml5),function(e){function t(e){return{nodeName:e.nodeName||null,className:e.classRegExp?null:e.className||null,classRegExp:e.classRegExp||null,styleProperty:e.styleProperty||null}}function n(t){for(var n=t.element,o=n.querySelectorAll(m),i=n.querySelectorAll(t.config.classNames.uneditableContainer),r=e.lang.array(o).without(i),s=r.length;s--;)""===r[s].innerHTML.replace(/[\uFEFF]/g,"")&&r[s].parentNode.removeChild(r[s])}function o(e){return e.config.useLineBreaks?"DIV":"P"}function i(e,t,n){for(var o=e,i=null;o&&t&&o!==t;)1===o.nodeType&&o.matches(n?m:f)&&(i=o),o=o.parentNode;return i}function r(e,t){for(var n,o,i,r=e,s=null;r&&t&&r!==t;)1===r.nodeType&&r.matches(p)&&(o=r,null===s?(s=r.cloneNode(!1),n=s):(i=r.cloneNode(!1),i.appendChild(s),s=i)),r=r.parentNode;return{parent:o,outerNode:s,innerNode:n}}function s(t,n,i){return t||(t=i.doc.createElement(n.nodeName||o(i)),t.appendChild(i.doc.createTextNode(e.INVISIBLE_SPACE))),n.nodeName&&t.nodeName!==n.nodeName&&(t=u.renameElement(t,n.nodeName)),n.classRegExp&&(t.className=t.className.replace(n.classRegExp,"")),n.className&&t.classList.add(n.className),n.styleProperty&&"undefined"!=typeof n.styleValue&&(t.style[e.browser.fixStyleKey(n.styleProperty)]=n.styleValue),t}function a(t,n,i){var r;n.styleProperty&&(t.style[e.browser.fixStyleKey(n.styleProperty)]=""),n.className&&t.classList.remove(n.className),n.classRegExp&&(t.className=t.className.replace(n.classRegExp,"")),null!==t.getAttribute("class")&&""===t.getAttribute("class").trim()&&t.removeAttribute("class"),n.nodeName&&t.nodeName===n.nodeName&&(r=t.getAttribute("style"),r&&""!==r.trim()?t=u.renameElement(t,o(i)):u.unwrap(t)),null!==t.getAttribute("style")&&""===t.getAttribute("style").trim()&&t.removeAttribute("style")}function l(t){for(var n=t.querySelectorAll(m)||[],o=n.length;o--;)n[o].nextSibling&&1===n[o].nextSibling.nodeType&&"BR"===n[o].nextSibling.nodeName||""!==(n[o].innerHTML||n[o].nodeValue||"").trim()&&n[o].parentNode.insertBefore(n[o].ownerDocument.createElement("BR"),n[o].nextSibling),e.dom.unwrap(n[o])}function c(e,t){var n;return e.startContainer&&1===e.startContainer.nodeType&&e.startContainer===e.endContainer?void(e.startContainer.firstChild===e.startContainer.lastChild&&1===e.endOffset&&e.startContainer!==t.element&&(e.setStartBefore(e.startContainer),e.setEndAfter(e.endContainer))):e.startContainer&&1===e.startContainer.nodeType&&3===e.endContainer.nodeType?void(e.startContainer.firstChild===e.endContainer&&1===e.endOffset&&e.startContainer!==t.element&&e.setEndAfter(e.startContainer)):e.endContainer&&1===e.endContainer.nodeType&&3===e.startContainer.nodeType?void(e.endContainer.firstChild===e.startContainer&&1===e.endOffset&&e.endContainer!==t.element&&e.setStartBefore(e.endContainer)):e.startContainer&&3===e.startContainer.nodeType&&e.startContainer===e.endContainer&&e.startContainer.parentNode?void(e.startContainer.parentNode.firstChild===e.startContainer&&e.endOffset==e.endContainer.length&&0===e.startOffset&&(n=e.startContainer.parentNode,n!==t.element&&(e.setStartBefore(n),e.setEndAfter(n)))):void 0}function d(n,a,d,h){var u=a?e.lang.object(a).clone(!0):null;u&&(u.nodeName=u.nodeName||d||o(h)),c(n,h);var p,g,y,w=n.cloneRange(),v=w.startContainer,b=w.extractContents(),C=h.doc.createDocumentFragment(),x=u?t(u):null,N=x?e.dom.getParentElement(v,x,null,h.element):null,S=!u||"BLOCKQUOTE"===d&&u.nodeName&&"BLOCKQUOTE"===u.nodeName,T=N||i(v,h.element,S);if(a&&a.nodeName&&"BLOCKQUOTE"===a.nodeName){var E=s(null,a,h);E.appendChild(b),C.appendChild(E),g=[E]}else{if(b.firstChild)for(;b.firstChild;)if(1==b.firstChild.nodeType&&b.firstChild.matches(m))if(a)s(b.firstChild,a,h),b.firstChild.matches(f)&&l(b.firstChild),C.appendChild(b.firstChild);else{l(b.firstChild),y=e.dom.unwrap(b.firstChild);for(var z=0,R=y.length;R>z;z++)C.appendChild(y[z]);C.childNodes.length>0&&C.appendChild(h.doc.createElement("BR"))}else if(a){for(p=s(null,u,h);b.firstChild&&(1!==b.firstChild.nodeType||!b.firstChild.matches(m));)1==b.firstChild.nodeType&&p.matches(f)&&l(b.firstChild),p.appendChild(b.firstChild);C.appendChild(p)}else 1==b.firstChild.nodeType&&l(b.firstChild),C.appendChild(b.firstChild);else C.appendChild(s(null,a,h));g=e.lang.array(C.childNodes).get()}if(T)h.selection.splitElementAtCaret(T,C);else{var _=r(v,h.element);if(_.outerNode&&_.innerNode&&_.parent){if(1===C.childNodes.length){for(;C.firstChild.firstChild;)_.innerNode.appendChild(C.firstChild.firstChild);C.firstChild.appendChild(_.outerNode)}h.selection.splitElementAtCaret(_.parent,C)}else w.insertNode(C)}return g}function h(t,n){var o=e.dom.getParentElement(t,{query:m},null,n.element);return o?o.nodeName:null}var u=e.dom,f="h1, h2, h3, h4, h5, h6, p, pre",m="h1, h2, h3, h4, h5, h6, p, pre, div, blockquote",p="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u";e.commands.formatBlock={exec:function(t,o,i){var r,s,l,c,u,m=[];if("string"==typeof i&&(i={nodeName:i.toUpperCase()}),i&&i.toggle&&(u=this.state(t,o,i))){c=rangy.saveSelection(t.win);for(var p=0,g=u.length;g>p;p++)a(u[p],i,t)}if(!u){t.selection.isCollapsed()&&(l=e.dom.getParentElement(t.selection.getOwnRanges()[0].startContainer,{query:f+", "+(i&&i.nodeName?i.nodeName.toLowerCase():"div")},null,t.element),l?(c=rangy.saveSelection(t.win),s=t.selection.createRange(),s.selectNode(l),t.selection.setSelection(s)):t.isEmpty()||(c=rangy.saveSelection(t.win),t.selection.selectLine())),r=t.selection.getOwnRanges();for(var y=r.length;y--;)m=m.concat(d(r[y],i,h(r[y].startContainer,t),t))}n(t);for(var w=m.length;w--;)m[w].parentNode||m.splice(w,1);c?rangy.restoreSelection(c):(s=t.selection.createRange(),s.setStartBefore(m[0]),s.setEndAfter(m[m.length-1]),t.selection.setSelection(s)),e.dom.removeInvisibleSpaces(t.element)},state:function(t,n,o){"string"==typeof o&&(o={query:o});for(var i,r=t.selection.filterElements(function(t){return e.dom.domNode(t).test(o||{query:m})}.bind(this)),s=t.selection.getSelectedOwnNodes(),a=0,l=s.length;l>a;a++)i=u.getParentElement(s[a],o||{query:m},null,t.element),i&&-1===r.indexOf(i)&&r.push(i);return 0===r.length?!1:r}}}(wysihtml5),function(e){e.commands.formatCode={exec:function(t,n,o){var i,r,s,a=this.state(t)[0];a?t.selection.executeAndRestore(function(){i=a.querySelector("code"),e.dom.replaceWithChildNodes(a),i&&e.dom.replaceWithChildNodes(i)}):(r=t.selection.getRange(),s=r.extractContents(),a=t.doc.createElement("pre"),i=t.doc.createElement("code"),o&&(i.className=o),a.appendChild(i),i.appendChild(s),r.insertNode(a),t.selection.selectNode(a))},state:function(t){var n,o=t.selection.getSelectedNode();return o&&o.nodeName&&"PRE"==o.nodeName&&o.firstChild&&o.firstChild.nodeName&&"CODE"==o.firstChild.nodeName?[o]:(n=e.dom.getParentElement(o,{query:"pre code"}),n?[n.parentNode]:!1)}}}(wysihtml5),function(e){function t(e){return/^\s*$/.test(e.className)}function n(e){return!e.getAttribute("style")||/^\s*$/.test(e.getAttribute("style"))}function o(t){var n=e.dom.getAttributes(t);return e.lang.object(n).isEmpty()}function i(t,n){var o,i,r,s;return 1!==t.nodeType||1!==n.nodeType?!1:t.nodeName!==n.nodeName?!1:(o=t.className.trim().replace(/\s+/g," ").split(" "),i=n.className.trim().replace(/\s+/g," ").split(" "),e.lang.array(o).without(i).length>0?!1:(r=e.dom.getAttributes(t),s=e.dom.getAttributes(n),r.length===s.length&&e.lang.object(e.lang.object(r).difference(s)).isEmpty()?!0:!1))}function r(t,n){var o=n&&n.nodeName||L,i=t.ownerDocument.createElement(o);if(n.classRegExp&&(i.className=i.className.replace(n.classRegExp,"")),n.className&&i.classList.add(n.className),n.styleProperty&&"undefined"!=typeof n.styleValue&&(i.style[e.browser.fixStyleKey(n.styleProperty)]=n.styleValue),n.attribute)if("object"==typeof n.attribute)for(var r in n.attribute)n.attribute.hasOwnProperty(r)&&i.setAttribute(r,n.attribute[r]);else"undefined"!=typeof n.attributeValue&&i.setAttribute(n.attribute,n.attributeValue);return i;
}function s(e,t){for(var n in e)if(e.hasOwnProperty(n)&&(void 0===typeof t[n]||t[n]!==e[n]))return!1;return!0}function a(t,n,o){var i,r=e.dom.getAttributes(t),a=s(n,r);e.lang.object(r).difference(n);if(a&&o!==!1)for(i in n)n.hasOwnProperty(i)&&t.removeAttribute(i);else for(i in n)n.hasOwnProperty(i)&&t.setAttribute(i,n[i])}function l(i,r){var s,l,c;r.className&&(r.toggle!==!1&&i.classList.contains(r.className)?i.classList.remove(r.className):i.classList.add(r.className),t(i)&&i.removeAttribute("class")),r.styleProperty&&(r.toggle!==!1&&i.style[e.browser.fixStyleKey(r.styleProperty)].trim().replace(/, /g,",")===r.styleValue?i.style[e.browser.fixStyleKey(r.styleProperty)]="":i.style[e.browser.fixStyleKey(r.styleProperty)]=r.styleValue),n(i)&&i.removeAttribute("style"),r.attribute&&("object"==typeof r.attribute?s=r.attribute:(s={},s[r.attribute]=r.attributeValue||""),a(i,s,r.toggle)),l=r.nodeName?O[r.nodeName.toLowerCase()]||r.nodeName.toLowerCase():null,c=l?e.dom.domNode(i).test({query:l}):!1,(!r.nodeName||r.nodeName===L||c)&&(r.toggle!==!1&&c||!r.nodeName&&i.nodeName===L)&&t(i)&&n(i)&&o(i)&&e.dom.unwrap(i)}function c(t,n){var o=[];return t.isCollapsed()||(o=o.concat(t.getOwnNodes([3],function(t){return!e.dom.domNode(t).is.emptyTextNode()},n))),o}function d(e,t,n,o){var i=e,r=o?t:h(t);do{if(1===i.nodeType&&u(i,r))return i;i=i.parentNode}while(i&&i!==n);return null}function h(e){return{nodeName:e.nodeName||null,className:e.classRegExp?null:e.className||null,classRegExp:e.classRegExp||null,styleProperty:e.styleProperty||null}}function u(t,n){var o;if(n.nodeName){var i=O[n.nodeName.toLowerCase()]||n.nodeName.toLowerCase();return e.dom.domNode(t).test({query:i})}return o=e.lang.object(n).clone(),o.query=k,e.dom.domNode(t).test(o)}function f(t,n){var o=document.documentElement||document.body,i=o.scrollTop,r=o.scrollLeft;rangy.getSelection(t.win);rangy.getSelection(t.win).removeAllRanges();try{rangy.getSelection(t.win).addRange(n)}catch(s){}t.doc.activeElement&&e.dom.contains(t.element,t.doc.activeElement)||(t.element.focus(),o.scrollTop=i,o.scrollLeft=r,rangy.getSelection(t.win).addRange(n))}function m(e,t){var n=rangy.createRange(t.doc),o=e[e.length-1];e[0]&&o&&(n.setStart(e[0],0),n.setEnd(o,o.length),f(t,n))}function p(e,t,n,o){var i=rangy.createRange(e.doc);t&&(i.setStart(t,n),i.setEnd(t,"undefined"!=typeof o?o:n),f(e,i))}function g(e,t,n){var o,i,r,s=c(e.selection),a=[],l=!1;if(e.selection.isInThisEditable()){if(0===s.length&&e.selection.isCollapsed()){if(r=e.selection.getSelection().anchorNode,!r)return{nodes:[],partial:!1};3===r.nodeType&&(s=[r])}s.length||(i=e.selection.getOwnRanges()[0],i&&(s=[i.endContainer]));for(var h=0,u=s.length;u>h;h++)o=d(s[h],t,e.element,n),o?a.push(o):l=!0}return{nodes:a,partial:l}}function y(e){var t,n,o,i;return e&&(t=e.anchorNode,n=e.anchorOffset,t&&3===t.nodeType&&n>0&&n<t.data.length)?(o=t.data[n-1],i=t.data[n],/\w/.test(o)&&/\w/.test(i)):!1}function w(t){var n,o,i,r,s,a,l=[];if(t&&(n=t.anchorNode,o=s=a=t.anchorOffset,i=n.ownerDocument,r=rangy.createRange(i),n&&3===n.nodeType)){for(;s>0&&/\w/.test(n.data[s-1]);)s--;for(;a<n.data.length&&/\w/.test(n.data[a]);)a++;return r.setStartAndEnd(n,s,a),r.splitBoundaries(),l=r.getNodes([3],function(t){return!e.dom.domNode(t).is.emptyTextNode()}),{wordOffset:o-s,range:r,textNode:l[0]}}return!1}function v(e,t){for(;t.firstChild;)e.appendChild(t.firstChild);t.parentNode.removeChild(t)}function b(e){for(var t=e.length;t--;)e[t]&&e[t].parentNode&&(e[t].nextSibling&&i(e[t],e[t].nextSibling)&&v(e[t],e[t].nextSibling),e[t].previousSibling&&i(e[t],e[t].previousSibling)&&v(e[t].previousSibling,e[t]))}function C(e,t,n){t.length>0&&m(t,e),b(g(e,n).nodes),t.length>0&&m(t,e)}function x(e,t,n,o){p(e,t,n),b(g(e,o).nodes),p(e,t,n)}function N(e,t){var n=r(e,t);e.parentNode.insertBefore(n,e),n.appendChild(e)}function S(t,n,o){var i,r=n.element,s=d(t,o,r);s&&(i=s.cloneNode(!1),e.dom.domNode(t).escapeParent(s,i),l(i,o))}function T(t,n,o){var i=n.element,r=d(t,o,i);r&&e.dom.domNode(t).escapeParent(r)}function E(e,t,n){var o=r(e.endContainer,n);e.surroundContents(o),t.selection.selectNode(o)}function z(t,n,o,i){var r,s,a,c,h=g(t,i,!0),u=t.selection.getSelection();if(n.length){if(h.partial||i.toggle===!1)for(c=n.length;c--;)d(n[c],i,t.element)&&S(n[c],t,i),d(n[c],i,t.element)||N(n[c],i);else for(c=n.length;c--;)S(n[c],t,i);C(t,n,i)}else if(i.toggle!==!1)if(y(u))r=w(u),s=r.textNode,S(r.textNode,t,i),x(t,r.textNode,r.wordOffset,i);else{s=t.doc.createTextNode(e.INVISIBLE_SPACE),a=o.nodes[0].cloneNode(!1),a.appendChild(s),t.selection.splitElementAtCaret(o.nodes[0],a),l(a,i),C(t,[s],i);var f=t.selection.getSelection();if(f.anchorNode&&f.focusNode)try{f.collapseToEnd()}catch(m){}}else for(c=o.nodes.length;c--;)l(o.nodes[c],i)}function R(t,n,o,i){var r,s,a,l=t.selection.getSelection();if(n.length){for(a=n.length;a--;)T(n[a],t,i);C(t,n,i)}else{for(r=l.anchorNode,s=l.anchorOffset,a=o.nodes.length;a--;)e.dom.unwrap(o.nodes[a]);x(t,r,s,i)}}function _(e,t,n){var o,i,r=e.selection.getSelection();if(t.length){for(i=t.length;i--;)N(t[i],n);C(e,t,n)}else if(y(r))o=w(r),N(o.textNode,n),x(e,o.textNode,o.wordOffset,n);else{var s=e.selection.getOwnRanges()[0];s&&E(s,e,n)}}function A(e){return e="string"==typeof e?{nodeName:e}:e,e.nodeName&&(e.nodeName=e.nodeName.toUpperCase()),e}var L="SPAN",k="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u",O={b:"b, strong",strong:"b, strong",em:"em, i",i:"em, i"};e.commands.formatInline={exec:function(e,t,n){n=A(n),e.element.normalize();var o=c(e.selection,!0),i=g(e,n);i.nodes.length>0?z(e,o,i,n):_(e,o,n),e.element.normalize()},remove:function(e,t,n){n=A(n),e.element.normalize();var o=c(e.selection,!0),i=g(e,n);i.nodes.length>0&&R(e,o,i,n),e.element.normalize()},state:function(e,t,n){n=A(n);var o=g(e,n,!0).nodes;return 0===o.length?!1:o}}}(wysihtml5),function(e){var t={nodeName:"BLOCKQUOTE",toggle:!0};e.commands.insertBlockQuote={exec:function(n,o){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,o){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(wysihtml5),function(e){e.commands.insertHTML={exec:function(e,t,n){e.commands.support(t)?e.doc.execCommand(t,!1,n):e.selection.insertHTML(n)},state:function(){return!1}}}(wysihtml5),function(e){var t="IMG";e.commands.insertImage={exec:function(n,o,i){i="object"==typeof i?i:{src:i};var r,s,a=n.doc,l=this.state(n);if(l&&!i.src)return n.selection.setBefore(l),s=l.parentNode,s.removeChild(l),e.dom.removeEmptyTextNodes(s),"A"!==s.nodeName||s.firstChild||(n.selection.setAfter(s),s.parentNode.removeChild(s)),void e.quirks.redraw(n.element);if(l)for(var c in i)i.hasOwnProperty(c)&&l.setAttribute("className"===c?"class":c,i[c]);else{l=a.createElement(t);for(var d in i)l.setAttribute("className"===d?"class":d,i[d]);n.selection.insertNode(l),e.browser.hasProblemsSettingCaretAfterImg()?(r=a.createTextNode(e.INVISIBLE_SPACE),n.selection.insertNode(r),n.selection.setAfter(r)):n.selection.setAfter(l)}},state:function(n){var o,i,r,s=n.doc;return e.dom.hasElementWithTagName(s,t)&&(o=n.selection.getSelectedNode())?o.nodeName===t?o:o.nodeType!==e.ELEMENT_NODE?!1:(i=n.selection.getText(),(i=e.lang.string(i).trim())?!1:(r=n.selection.getNodes(e.ELEMENT_NODE,function(e){return"IMG"===e.nodeName}),1!==r.length?!1:r[0])):!1}}}(wysihtml5),function(e){var t="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function(n,o){n.commands.support(o)?(n.doc.execCommand(o,!1,null),e.browser.autoScrollsToCaret()||n.selection.scrollIntoView()):n.commands.exec("insertHTML",t)},state:function(){return!1}}}(wysihtml5),function(e){e.commands.insertOrderedList={exec:function(t,n){e.commands.insertList.exec(t,n,"OL")},state:function(t,n){return e.commands.insertList.state(t,n,"OL")}}}(wysihtml5),function(e){e.commands.insertUnorderedList={exec:function(t,n){e.commands.insertList.exec(t,n,"UL")},state:function(t,n){return e.commands.insertList.state(t,n,"UL")}}}(wysihtml5),wysihtml5.commands.insertList=function(e){var t=function(e,t){if(e&&e.nodeName){"string"==typeof t&&(t=[t]);for(var n=t.length;n--;)if(e.nodeName===t[n])return!0}return!1},n=function(n,o,i){var r={el:null,other:!1};if(n){var s=e.dom.getParentElement(n,{query:"li"},!1,i.element),a="UL"===o?"OL":"UL";t(n,o)?r.el=n:t(n,a)?r={el:n,other:!0}:s&&(t(s.parentNode,o)?r.el=s.parentNode:t(s.parentNode,a)&&(r={el:s.parentNode,other:!0}))}return r.el&&!i.element.contains(r.el)&&(r.el=null),r},o=function(t,n,o){var i,s,a="UL"===n?"OL":"UL";o.selection.executeAndRestoreRangy(function(){if(i=r(a,o),i.length)for(var l=i.length;l--;)e.dom.renameElement(i[l],n.toLowerCase());else{s=r(["OL","UL"],o);for(var c=s.length;c--;)e.dom.resolveList(s[c],o.config.useLineBreaks);e.dom.resolveList(t,o.config.useLineBreaks)}})},i=function(t,n,o){var i="UL"===n?"OL":"UL";o.selection.executeAndRestoreRangy(function(){for(var s=[t].concat(r(i,o)),a=s.length;a--;)e.dom.renameElement(s[a],n.toLowerCase())})},r=function(e,n){for(var o=n.selection.getOwnRanges(),i=[],r=o.length;r--;)i=i.concat(o[r].getNodes([1],function(n){return t(n,e)}));return i},s=function(t,n){n.selection.executeAndRestoreRangy(function(){var o,i,r="_wysihtml5-temp-"+(new Date).getTime(),s=n.selection.deblockAndSurround({nodeName:"div",className:r});s.innerHTML=s.innerHTML.replace(e.INVISIBLE_SPACE_REG_EXP,""),s&&(o=e.lang.array(["","<br>",e.INVISIBLE_SPACE]).contains(s.innerHTML),i=e.dom.convertToList(s,t.toLowerCase(),n.parent.config.classNames.uneditableContainer),o&&n.selection.selectNode(i.querySelector("li"),!0))})};return{exec:function(e,t,r){var a=e.doc,l="OL"===r?"insertOrderedList":"insertUnorderedList",c=e.selection.getSelectedNode(),d=n(c,r,e);d.el?d.other?i(d.el,r,e):o(d.el,r,e):e.commands.support(l)?a.execCommand(l,!1,null):s(r,e)},state:function(e,t,o){var i=e.selection.getSelectedNode(),r=n(i,o,e);return r.el&&!r.other?r.el:!1}}}(wysihtml5),function(e){var t={nodeName:"I",toggle:!0};e.commands.italic={exec:function(n,o){e.commands.formatInline.exec(n,o,t)},state:function(n,o){return e.commands.formatInline.state(n,o,t)}}}(wysihtml5),function(e){var t={className:"wysiwyg-text-align-center",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};e.commands.justifyCenter={exec:function(n,o){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,o){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(wysihtml5),function(e){var t={className:"wysiwyg-text-align-left",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};e.commands.justifyLeft={exec:function(n,o){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,o){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(wysihtml5),function(e){var t={className:"wysiwyg-text-align-right",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};e.commands.justifyRight={exec:function(n,o){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,o){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(wysihtml5),function(e){var t={className:"wysiwyg-text-align-justify",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};e.commands.justifyFull={exec:function(n,o){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,o){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(wysihtml5),function(e){var t={styleProperty:"textAlign",styleValue:"right",toggle:!0};e.commands.alignRightStyle={exec:function(n,o){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,o){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(wysihtml5),function(e){var t={styleProperty:"textAlign",styleValue:"left",toggle:!0};e.commands.alignLeftStyle={exec:function(n,o){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,o){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(wysihtml5),function(e){var t={styleProperty:"textAlign",styleValue:"center",toggle:!0};e.commands.alignCenterStyle={exec:function(n,o){return e.commands.formatBlock.exec(n,"formatBlock",t)},state:function(n,o){return e.commands.formatBlock.state(n,"formatBlock",t)}}}(wysihtml5),function(e){e.commands.redo={exec:function(e){return e.undoManager.redo()},state:function(e){return!1}}}(wysihtml5),function(e){var t={nodeName:"U",toggle:!0};e.commands.underline={exec:function(n,o){e.commands.formatInline.exec(n,o,t)},state:function(n,o){return e.commands.formatInline.state(n,o,t)}}}(wysihtml5),function(e){e.commands.undo={exec:function(e){return e.undoManager.undo()},state:function(e){return!1}}}(wysihtml5),function(e){e.commands.createTable={exec:function(e,t,n){var o,i,r;if(n&&n.cols&&n.rows&&parseInt(n.cols,10)>0&&parseInt(n.rows,10)>0){for(r=n.tableStyle?'<table style="'+n.tableStyle+'">':"<table>",r+="<tbody>",i=0;i<n.rows;i++){for(r+="<tr>",o=0;o<n.cols;o++)r+="<td><br></td>";r+="</tr>"}r+="</tbody></table>",e.commands.exec("insertHTML",r)}},state:function(e,t){return!1}}}(wysihtml5),function(e){e.commands.mergeTableCells={exec:function(t,n){t.tableSelection&&t.tableSelection.start&&t.tableSelection.end&&(this.state(t,n)?e.dom.table.unmergeCell(t.tableSelection.start):e.dom.table.mergeCellsBetween(t.tableSelection.start,t.tableSelection.end))},state:function(t,n){if(t.tableSelection){var o=t.tableSelection.start,i=t.tableSelection.end;if(o&&i&&o==i&&(e.dom.getAttribute(o,"colspan")&&parseInt(e.dom.getAttribute(o,"colspan"),10)>1||e.dom.getAttribute(o,"rowspan")&&parseInt(e.dom.getAttribute(o,"rowspan"),10)>1))return[o]}return!1}}}(wysihtml5),function(e){e.commands.addTableCells={exec:function(t,n,o){if(t.tableSelection&&t.tableSelection.start&&t.tableSelection.end){var i=e.dom.table.orderSelectionEnds(t.tableSelection.start,t.tableSelection.end);"before"==o||"above"==o?e.dom.table.addCells(i.start,o):("after"==o||"below"==o)&&e.dom.table.addCells(i.end,o),setTimeout(function(){t.tableSelection.select(i.start,i.end)},0)}},state:function(e,t){return!1}}}(wysihtml5),function(e){e.commands.deleteTableCells={exec:function(t,n,o){if(t.tableSelection&&t.tableSelection.start&&t.tableSelection.end){var i,r=e.dom.table.orderSelectionEnds(t.tableSelection.start,t.tableSelection.end),s=e.dom.table.indexOf(r.start),a=t.tableSelection.table;e.dom.table.removeCells(r.start,o),setTimeout(function(){i=e.dom.table.findCell(a,s),i||("row"==o&&(i=e.dom.table.findCell(a,{row:s.row-1,col:s.col})),"column"==o&&(i=e.dom.table.findCell(a,{row:s.row,col:s.col-1}))),i&&t.tableSelection.select(i,i)},0)}},state:function(e,t){return!1}}}(wysihtml5),function(e){e.commands.indentList={exec:function(e,t,n){var o=e.selection.getSelectionParentsByTag("LI");return o?this.tryToPushLiLevel(o,e.selection):!1},state:function(e,t){return!1},tryToPushLiLevel:function(t,n){var o,i,r,s,a,l=!1;return n.executeAndRestoreRangy(function(){for(var n=t.length;n--;)s=t[n],o="OL"===s.parentNode.nodeName?"OL":"UL",i=s.ownerDocument.createElement(o),r=e.dom.domNode(s).prev({nodeTypes:[e.ELEMENT_NODE]}),a=r?r.querySelector("ul, ol"):null,r&&(a?a.appendChild(s):(i.appendChild(s),r.appendChild(i)),l=!0)}),l}}}(wysihtml5),function(e){e.commands.outdentList={exec:function(e,t,n){var o=e.selection.getSelectionParentsByTag("LI");return o?this.tryToPullLiLevel(o,e):!1},state:function(e,t){return!1},tryToPullLiLevel:function(t,n){var o,i,r,s,a,l=!1,c=this;return n.selection.executeAndRestoreRangy(function(){for(var d=t.length;d--;)if(s=t[d],s.parentNode&&(o=s.parentNode,"OL"===o.tagName||"UL"===o.tagName)){if(l=!0,i=e.dom.getParentElement(o.parentNode,{query:"ol, ul"},!1,n.element),r=e.dom.getParentElement(o.parentNode,{query:"li"},!1,n.element),i&&r)s.nextSibling&&(a=c.getAfterList(o,s),s.appendChild(a)),i.insertBefore(s,r.nextSibling);else{s.nextSibling&&(a=c.getAfterList(o,s),s.appendChild(a));for(var h=s.childNodes.length;h--;)o.parentNode.insertBefore(s.childNodes[h],o.nextSibling);o.parentNode.insertBefore(document.createElement("br"),o.nextSibling),s.parentNode.removeChild(s)}0===o.childNodes.length&&o.parentNode.removeChild(o)}}),l},getAfterList:function(e,t){for(var n=e.nodeName,o=document.createElement(n);t.nextSibling;)o.appendChild(t.nextSibling);return o}}}(wysihtml5),function(e){var t={nodeName:"SUB",toggle:!0};e.commands.subscript={exec:function(n,o){e.commands.formatInline.exec(n,o,t)},state:function(n,o){return e.commands.formatInline.state(n,o,t)}}}(wysihtml5),function(e){var t={nodeName:"SUP",toggle:!0};e.commands.superscript={exec:function(n,o){e.commands.formatInline.exec(n,o,t)},state:function(n,o){return e.commands.formatInline.state(n,o,t)}}}(wysihtml5),function(e){var t=90,n=89,o=8,i=46,r=25,s="data-wysihtml5-selection-node",a="data-wysihtml5-selection-offset",l=('<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",'<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",e.dom);e.UndoManager=e.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var e,r=this;this.composer.sandbox.getDocument();l.observe(this.element,"keydown",function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey)){var o=e.keyCode,i=o===t&&!e.shiftKey,s=o===t&&e.shiftKey||o===n;i?(r.undo(),e.preventDefault()):s&&(r.redo(),e.preventDefault())}}),l.observe(this.element,"keydown",function(t){var n=t.keyCode;n!==e&&(e=n,(n===o||n===i)&&r.transact())}),this.editor.on("newword:composer",function(){r.transact()}).on("beforecommand:composer",function(){r.transact()})},transact:function(){var t,n,o,i,l,c=this.historyStr[this.position-1],d=this.composer.getValue(!1,!1),h=this.element.offsetWidth>0&&this.element.offsetHeight>0;if(d!==c){var u=this.historyStr.length=this.historyDom.length=this.position;u>r&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,h&&(t=this.composer.selection.getRange(),n=t&&t.startContainer?t.startContainer:this.element,o=t&&t.startOffset?t.startOffset:0,n.nodeType===e.ELEMENT_NODE?i=n:(i=n.parentNode,l=this.getChildNodeIndex(i,n)),i.setAttribute(a,o),"undefined"!=typeof l&&i.setAttribute(s,l));var f=this.element.cloneNode(!!d);this.historyDom.push(f),this.historyStr.push(d),i&&(i.removeAttribute(a),i.removeAttribute(s))}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(e){this.element.innerHTML="";for(var t=0,n=e.childNodes,o=e.childNodes.length;o>t;t++)this.element.appendChild(n[t].cloneNode(!0));var i,r,l;e.hasAttribute(a)?(i=e.getAttribute(a),l=e.getAttribute(s),r=this.element):(r=this.element.querySelector("["+a+"]")||this.element,i=r.getAttribute(a),l=r.getAttribute(s),r.removeAttribute(a),r.removeAttribute(s)),null!==l&&(r=this.getChildNodeByIndex(r,+l)),this.composer.selection.set(r,i)},getChildNodeIndex:function(e,t){for(var n=0,o=e.childNodes,i=o.length;i>n;n++)if(o[n]===t)return n},getChildNodeByIndex:function(e,t){return e.childNodes[t]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(e,t,n){this.parent=e,this.element=t,this.config=n,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.on("beforeload",function(){e.parent.on("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(!this.element||!this.element.ownerDocument||this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element&&this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,n=e.browser;e.views.Composer=e.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,t,n){this.base(e,t,n),this.config.noTextarea?this.editableArea=t:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=n.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t,n){var o=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return t!==!1&&(o=this.parent.parse(o,n===!1?!1:!0)),o},setValue:function(e,t){t&&(e=this.parent.parse(e));try{this.element.innerHTML=e}catch(n){this.element.innerText=e}},cleanUp:function(){var e;this.selection&&(e=rangy.saveSelection(this.win)),this.parent.parse(this.element),e&&rangy.restoreSelection(e)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=t.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(t){e.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var n=this.element.lastChild;t&&n&&this.selection&&("BR"===n.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getScrollPos:function(){if(this.doc&&this.win){var e={};return"undefined"!=typeof this.win.pageYOffset?e.y=this.win.pageYOffset:e.y=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollTop,"undefined"!=typeof this.win.pageXOffset?e.x=this.win.pageXOffset:e.x=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollLeft,e}},setScrollPos:function(e){e&&"undefined"!=typeof e.x&&"undefined"!=typeof e.y&&this.win.scrollTo(e.x,e.y)},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var e=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(e)||""===e||"<br>"===e||"<p></p>"===e||"<p><br></p>"===e||this.hasPlaceholderSet()},_initContentEditableArea:function(){var e=this;this.config.noTextarea?this.sandbox=new t.ContentEditableArea(function(){e._create()},{className:this.config.classNames.sandbox},this.editableArea):(this.sandbox=new t.ContentEditableArea(function(){e._create()},{className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getContentEditable(),t.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var e=this;this.sandbox=new t.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets,className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getIframe();var n=this.textarea.element;t.insert(this.editableArea).after(n),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var e=document.createElement("input");e.type="hidden",e.name="_wysihtml5_mode",e.value=1,t.insert(e).after(this.textarea.element)}},_create:function(){var o=this;this.doc=this.sandbox.getDocument(),this.win=this.sandbox.getWindow(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new e.Selection(this.parent,this.element,this.config.classNames.uneditableContainer),this.commands=new e.Commands(this.parent),this.config.noTextarea||t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),t.addClass(this.element,this.config.classNames.composer),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var i=this.config.name;i&&(t.addClass(this.element,i),this.config.contentEditableMode||t.addClass(this.editableArea,i)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var r="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");r&&t.simulatePlaceholder(this.parent,this,r,this.config.classNames.placeholder),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||n.isIos()||setTimeout(function(){o.focus(!0)},100),n.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var o=this,i=n.canDisableAutoLinking(),r=n.doesAutoLinkingInContentEditable();if(i&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!r||r&&i)&&(this.parent.on("newword:composer",function(){if(t.getTextContent(o.element).match(t.autoLink.URL_REG_EXP)){for(var n=o.selection.getSelectedNode(),i=o.element.querySelectorAll("."+o.config.classNames.uneditableContainer),r=!1,s=i.length;s--;)e.dom.contains(i[s],n)&&(r=!0);r||t.autoLink(n,[o.config.classNames.uneditableContainer])}}),t.observe(this.element,"blur",function(){t.autoLink(o.element,[o.config.classNames.uneditableContainer])}));var s=this.sandbox.getDocument().getElementsByTagName("a"),a=t.autoLink.URL_REG_EXP,l=function(n){var o=e.lang.string(t.getTextContent(n)).trim();return"www."===o.substr(0,4)&&(o="http://"+o),o};t.observe(this.element,"keydown",function(e){if(s.length){var n,i=o.selection.getSelectedNode(e.target.ownerDocument),r=t.getParentElement(i,{query:"a"},4);r&&(n=l(r),setTimeout(function(){var e=l(r);e!==n&&e.match(a)&&r.setAttribute("href",e)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),n.supportsEvent("resizeend")){var o=["width","height"],i=o.length,r=this.element;t.observe(r,"resizeend",function(t){var n,s=t.target||t.srcElement,a=s.style,l=0;if("IMG"===s.nodeName){for(;i>l;l++)n=o[l],a[n]&&(s.setAttribute(n,parseInt(a[n],10)),a[n]="");e.quirks.redraw(r)}})}},_initUndoManager:function(){this.undoManager=new e.UndoManager(this.parent)},_initLineBreaking:function(){function o(e){var n=t.getParentElement(e,{query:"p, div"},2);n&&t.contains(i.element,n)&&i.selection.executeAndRestore(function(){i.config.useLineBreaks?t.replaceWithChildNodes(n):"P"!==n.nodeName&&t.renameElement(n,"p")})}var i=this,r="li, p, h1, h2, h3, h4, h5, h6",s="ul, ol, menu";this.config.useLineBreaks||t.observe(this.element,["focus","keydown"],function(){if(i.isEmpty()){var e=i.doc.createElement("P");i.element.innerHTML="",i.element.appendChild(e),n.displaysCaretInEmptyContentEditableCorrectly()?i.selection.selectNode(e,!0):(e.innerHTML="<br>",i.selection.setBefore(e.firstChild))}}),t.observe(this.element,"keydown",function(n){var a=n.keyCode;if(!n.shiftKey&&(a===e.ENTER_KEY||a===e.BACKSPACE_KEY)){var l=t.getParentElement(i.selection.getSelectedNode(),{query:r},4);return l?void setTimeout(function(){var n,r=i.selection.getSelectedNode();if("LI"===l.nodeName){if(!r)return;n=t.getParentElement(r,{query:s},2),n||o(r)}a===e.ENTER_KEY&&l.nodeName.match(/^H[1-6]$/)&&o(r)},0):void(i.config.useLineBreaks&&a===e.ENTER_KEY&&!e.browser.insertsLineBreaksOnReturn()&&(n.preventDefault(),i.commands.exec("insertLineBreak")))}})}})}(wysihtml5),function(e){var t=e.dom,n=document,o=window,i=n.createElement("div"),r=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],s=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],a=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],l=function(e){if(e.setActive)try{e.setActive()}catch(i){}else{var r=e.style,s=n.documentElement.scrollTop||n.body.scrollTop,a=n.documentElement.scrollLeft||n.body.scrollLeft,l={position:r.position,top:r.top,left:r.left,WebkitUserSelect:r.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),t.setStyles(l).on(e),o.scrollTo&&o.scrollTo(a,s)}};e.views.Composer.prototype.style=function(){var o,c=this,d=n.querySelector(":focus"),h=this.textarea.element,u=h.hasAttribute("placeholder"),f=u&&h.getAttribute("placeholder"),m=h.style.display,p=h.disabled;this.focusStylesHost=i.cloneNode(!1),this.blurStylesHost=i.cloneNode(!1),this.disabledStylesHost=i.cloneNode(!1),u&&h.removeAttribute("placeholder"),h===d&&h.blur(),h.disabled=!1,h.style.display=o="none",(h.getAttribute("rows")&&"auto"===t.getStyle("height").from(h)||h.getAttribute("cols")&&"auto"===t.getStyle("width").from(h))&&(h.style.display=o=m),t.copyStyles(s).from(h).to(this.editableArea).andTo(this.blurStylesHost),t.copyStyles(r).from(h).to(this.element).andTo(this.blurStylesHost),t.insertCSS(a).into(this.element.ownerDocument),h.disabled=!0,t.copyStyles(s).from(h).to(this.disabledStylesHost),t.copyStyles(r).from(h).to(this.disabledStylesHost),h.disabled=p,h.style.display=m,l(h),h.style.display=o,t.copyStyles(s).from(h).to(this.focusStylesHost),t.copyStyles(r).from(h).to(this.focusStylesHost),h.style.display=m,t.copyStyles(["display"]).from(h).to(this.editableArea);var g=e.lang.array(s).without(["display"]);return d?d.focus():h.blur(),u&&h.setAttribute("placeholder",f),this.parent.on("focus:composer",function(){t.copyStyles(g).from(c.focusStylesHost).to(c.editableArea),t.copyStyles(r).from(c.focusStylesHost).to(c.element)}),this.parent.on("blur:composer",function(){t.copyStyles(g).from(c.blurStylesHost).to(c.editableArea),t.copyStyles(r).from(c.blurStylesHost).to(c.element)}),this.parent.observe("disable:composer",function(){t.copyStyles(g).from(c.disabledStylesHost).to(c.editableArea),t.copyStyles(r).from(c.disabledStylesHost).to(c.element)}),this.parent.observe("enable:composer",function(){t.copyStyles(g).from(c.blurStylesHost).to(c.editableArea),t.copyStyles(r).from(c.blurStylesHost).to(c.element)}),this}}(wysihtml5),function(e){var t=e.dom,n=e.browser,o={66:"bold",73:"italic",85:"underline"},i=function(e,t,n){for(var o=0,i=t.length;i>o;o++)e.addEventListener(t[o],n,!1)},r=function(e,t,n){for(var o=0,i=t.length;i>o;o++)e.removeEventListener(t[o],n,!1)},s=function(t,n){if(t.selection.caretIsLastInSelection()){var o=t.selection.getSelection(),i=o.anchorNode;if(i&&1===i.nodeType&&(e.dom.getParentElement(i,{query:"td, th"},!1,t.element)||n)){var r=i.childNodes[o.anchorOffset];if(r&&1===r.nodeType&"BR"===r.nodeName)return r.parentNode.removeChild(r),!0}}return!1},a=function(e){var t=e.selection.getBeforeSelection(!0);
if(t&&("element"===t.type||"leafnode"===t.type)&&1===t.node.nodeType&&t.node.classList.contains(e.config.classNames.uneditableContainer)){if(s(e,!0))return!0;try{var n=new CustomEvent("wysihtml5:uneditable:delete");t.node.dispatchEvent(n)}catch(o){}return t.node.parentNode.removeChild(t.node),!0}return!1},l=function(t){var n=t.selection,o=n.getPreviousNode();if(n.caretIsFirstInSelection()&&o&&1===o.nodeType&&/block/.test(t.win.getComputedStyle(o).display)){if(/^\s*$/.test(o.textContent||o.innerText))return o.parentNode.removeChild(o),!0;if(o.lastChild){var i=o.lastChild,r=n.getSelectedNode(),s=e.dom.domNode(o).commonAncestor(r,t.element);if(curNode=s?e.dom.getParentElement(r,{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"},!1,s):null,curNode){for(;curNode.firstChild;)o.appendChild(curNode.firstChild);return n.setAfter(i),!0}if(3===r.nodeType)return o.appendChild(r),n.setAfter(i),!0}}return!1},c=function(e,t){var n=t.selection;t.element;if(n.isCollapsed()){if(l(t))return void e.preventDefault();if(s(t))return void e.preventDefault();if(a(t))return void e.preventDefault()}else n.containsUneditable()&&(e.preventDefault(),n.deleteContents())},d=function(e,t,n){if(e.selection.isCollapsed()){if(e.selection.caretIsInTheBeginnig("li"))if(n){if(e.commands.exec("outdentList"))return}else if(e.commands.exec("indentList"))return}else e.selection.deleteContents();e.commands.exec("insertHTML","&emsp;")},h=function(e){this.domNodeRemovedInterval&&clearInterval(domNodeRemovedInterval),this.parent.fire("destroy:composer")},u=function(e){this.parent.fire("beforeinteraction",e).fire("beforeinteraction:composer",e),setTimeout(function(){this.parent.fire("interaction",e).fire("interaction:composer",e)}.bind(this),0)},f=function(e){this.parent.fire("focus",e).fire("focus:composer",e),setTimeout(function(){this.focusState=this.getValue(!1,!1)}.bind(this),0)},m=function(e){if(this.focusState!==this.getValue(!1,!1)){var t=e;"function"==typeof Object.create&&(t=Object.create(e,{type:{value:"change"}})),this.parent.fire("change",t).fire("change:composer",t)}this.parent.fire("blur",e).fire("blur:composer",e)},p=function(e){this.parent.fire(e.type,e).fire(e.type+":composer",e),"paste"===e.type&&setTimeout(function(){this.parent.fire("newword:composer")}.bind(this),0)},g=function(e){this.config.copyedFromMarking&&(e.clipboardData&&(e.clipboardData.setData("text/html",this.config.copyedFromMarking+this.selection.getHtml()),e.clipboardData.setData("text/plain",this.selection.getPlainText()),e.preventDefault()),this.parent.fire(e.type,e).fire(e.type+":composer",e))},y=function(t){var n=t.keyCode;(n===e.SPACE_KEY||n===e.ENTER_KEY)&&this.parent.fire("newword:composer")},w=function(t){if(!n.canSelectImagesInContentEditable()){var o=t.target,i=this.element.querySelectorAll("img"),r=this.element.querySelectorAll("."+this.config.classNames.uneditableContainer+" img"),s=e.lang.array(i).without(r);"IMG"===o.nodeName&&e.lang.array(s).contains(o)&&this.selection.selectNode(o)}},v=function(e){var t,n={IMG:"Image: ",A:"Link: "},o=e.target,i=o.nodeName;("A"===i||"IMG"===i)&&(o.hasAttribute("title")||(t=n[i]+(o.getAttribute("href")||o.getAttribute("src")),o.setAttribute("title",t)))},b=function(t){if(this.config.classNames.uneditableContainer){var n=e.dom.getParentElement(t.target,{query:"."+this.config.classNames.uneditableContainer},!1,this.element);n&&this.selection.setAfter(n)}},C=function(e){n.canSelectImagesInContentEditable()||setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)},x=function(t){var n,i,r=t.keyCode,s=o[r];return(t.ctrlKey||t.metaKey)&&65===r?(this.selection.selectAll(),void t.preventDefault()):((t.ctrlKey||t.metaKey)&&!t.altKey&&s&&(this.commands.exec(s),t.preventDefault()),r===e.BACKSPACE_KEY&&c(t,this),(r===e.BACKSPACE_KEY||r===e.DELETE_KEY)&&(n=this.selection.getSelectedNode(!0),n&&"IMG"===n.nodeName&&(t.preventDefault(),i=n.parentNode,i.removeChild(n),"A"!==i.nodeName||i.firstChild||i.parentNode.removeChild(i),setTimeout(function(){e.quirks.redraw(this.element)}.bind(this),0))),void(this.config.handleTabKey&&r===e.TAB_KEY&&(t.preventDefault(),d(this,this.element,t.shiftKey))))},N=function(){var t=function(){this.doc.execCommand("enableObjectResizing",!1,"false"),this.doc.execCommand("enableInlineTableEditing",!1,"false")},n=function(){t.call(this),r(this.sandbox.getIframe(),["focus","mouseup","mouseover"],n)}.bind(this);this.doc.execCommand&&e.browser.supportsCommand(this.doc,"enableObjectResizing")&&e.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?i(this.sandbox.getIframe(),["focus","mouseup","mouseover"],n):setTimeout(function(){t.call(this)}.bind(this),0)),this.tableSelection=e.quirks.tableCellsSelection(this.element,this.parent)};e.views.Composer.prototype.observe=function(){var e=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),o=(this.element,n.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?this.element:this.sandbox.getWindow());this.focusState=this.getValue(!1,!1),e.addEventListener(["DOMNodeRemoved"],h.bind(this),!1),n.supportsMutationEvents()||(this.domNodeRemovedInterval=setInterval(function(){t.contains(document.documentElement,e)||h.call(this)},250)),this.config.handleTables&&N.call(this),i(o,["drop","paste","mouseup","focus","keyup"],u.bind(this)),o.addEventListener("focus",f.bind(this),!1),o.addEventListener("blur",m.bind(this),!1),i(this.element,["drop","paste","beforepaste"],p.bind(this),!1),this.element.addEventListener("copy",g.bind(this),!1),this.element.addEventListener("mousedown",w.bind(this),!1),this.element.addEventListener("mouseover",v.bind(this),!1),this.element.addEventListener("click",b.bind(this),!1),this.element.addEventListener("drop",C.bind(this),!1),this.element.addEventListener("keyup",y.bind(this),!1),this.element.addEventListener("keydown",x.bind(this),!1),this.element.addEventListener("dragenter",function(){this.parent.fire("unset_placeholder")}.bind(this),!1)}}(wysihtml5),function(e){var t=400;e.views.Synchronizer=Base.extend({constructor:function(e,t,n){this.editor=e,this.textarea=t,this.composer=n,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(e.lang.string(this.composer.getValue(!1,!1)).trim(),t)},fromTextareaToComposer:function(e){var t=this.textarea.getValue(!1,!1);t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var n,o=this,i=this.textarea.element.form,r=function(){n=setInterval(function(){o.fromComposerToTextarea()},t)},s=function(){clearInterval(n),n=null};r(),i&&(e.dom.observe(i,"submit",function(){o.sync(!0)}),e.dom.observe(i,"reset",function(){setTimeout(function(){o.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(e){"composer"!==e||n?"textarea"===e&&(o.fromComposerToTextarea(!0),s()):(o.fromTextareaToComposer(!0),r())}),this.editor.on("destroy:composer",s)}})}(wysihtml5),function(e){e.views.SourceView=Base.extend({constructor:function(e,t){this.editor=e,this.composer=t,this._observe()},switchToTextarea:function(e){var t=this.composer.win.getComputedStyle(this.composer.element),n=parseFloat(t.width),o=Math.max(parseFloat(t.height),100);this.textarea||(this.textarea=this.composer.doc.createElement("textarea"),this.textarea.className="wysihtml5-source-view"),this.textarea.style.width=n+"px",this.textarea.style.height=o+"px",this.textarea.value=this.editor.getValue(e,!0),this.composer.element.parentNode.insertBefore(this.textarea,this.composer.element),this.editor.currentView="source",this.composer.element.style.display="none"},switchToComposer:function(e){var t=this.textarea.value;t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder")),this.textarea.parentNode.removeChild(this.textarea),this.editor.currentView=this.composer,this.composer.element.style.display=""},_observe:function(){this.editor.on("change_view",function(e){"composer"===e?this.switchToComposer(!0):"textarea"===e&&this.switchToTextarea(!0)}.bind(this))}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(e,t,n){this.base(e,t,n),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return e!==!1&&(t=this.parent.parse(t)),t},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.value=e},cleanUp:function(){var e=this.parent.parse(this.element.value);this.element.value=e},hasPlaceholderSet:function(){var e=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,n=this.element.value,o=!n;return e&&o||n===t},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,t=this.parent,n={focusin:"focus",focusout:"blur"},o=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];t.on("beforeload",function(){wysihtml5.dom.observe(e,o,function(e){var o=n[e.type]||e.type;t.fire(o).fire(o+":textarea")}),wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){t.fire("paste").fire("paste:textarea")},0)})})}}),function(e){var t,n={name:t,style:!0,toolbar:t,showToolbarAfterInit:!0,showToolbarDialogsOnSelection:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},pasteParserRulesets:null,parser:e.dom.parse,useLineBreaks:!0,stylesheets:[],placeholderText:t,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,classNames:{composer:"wysihtml5-editor",body:"wysihtml5-supported",sandbox:"wysihtml5-sandbox",placeholder:"wysihtml5-placeholder",uneditableContainer:"wysihtml5-uneditable-container"},copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};e.Editor=e.lang.Dispatcher.extend({constructor:function(t,o){if(this.editableElement="string"==typeof t?document.getElementById(t):t,this.config=e.lang.object({}).merge(n).merge(o).get(),this._isCompatible=e.browser.supported(),o&&o.classNames&&e.lang.object(this.config.classNames).merge(o.classNames),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new e.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&e.browser.isTouchDevice()){var i=this;return void setTimeout(function(){i.fire("beforeload").fire("load")},0)}e.dom.addClass(document.body,this.config.classNames.body),this.composer=new e.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea?this.sourceView=new e.views.SourceView(this,this.composer):this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e,t){return this.currentView.getValue(e,t)},setValue:function(e,t){return this.fire("unset_placeholder"),e?(this.currentView.setValue(e,t),this):this.clear()},cleanUp:function(){this.currentView.cleanUp()},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t,n){var o=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,i=this.config.parser(t,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:o,uneditableClass:this.config.classNames.uneditableContainer,clearInternals:n});return"object"==typeof t&&e.quirks.redraw(t),i},_initParser:function(){var t;e.browser.supportsModernPaste()?this.on("paste:composer",function(n){n.preventDefault(),t=e.dom.getPastedHtml(n),t&&this._cleanAndPaste(t)}.bind(this)):this.on("beforepaste:composer",function(t){t.preventDefault();var n=this.composer.getScrollPos();e.dom.getPastedHtmlWithDiv(this.composer,function(e){e&&this._cleanAndPaste(e),this.composer.setScrollPos(n)}.bind(this))}.bind(this))},_cleanAndPaste:function(t){var n=e.quirks.cleanPastedHTML(t,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.classNames.uneditableContainer});this.composer.selection.deleteContents(),this.composer.selection.insertHTML(n)}})}(wysihtml5),function(e){var t=e.dom,n="wysihtml5-command-dialog-opened",o="input, select, textarea",i="[data-wysihtml5-dialog-field]",r="data-wysihtml5-dialog-field";e.toolbar.Dialog=e.lang.Dispatcher.extend({constructor:function(e,t){this.link=e,this.container=t},_observe:function(){if(!this._observed){var o=this,i=function(e){var t=o._serialize();o.fire("save",t),o.hide(),e.preventDefault(),e.stopPropagation()};t.observe(o.link,"click",function(){t.hasClass(o.link,n)&&setTimeout(function(){o.hide()},0)}),t.observe(this.container,"keydown",function(t){var n=t.keyCode;n===e.ENTER_KEY&&i(t),n===e.ESCAPE_KEY&&o.cancel()}),t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",i),t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){o.cancel(),e.preventDefault(),e.stopPropagation()}),this._observed=!0}},_serialize:function(){for(var e={},t=this.container.querySelectorAll(i),n=t.length,o=0;n>o;o++)e[t[o].getAttribute(r)]=t[o].value;return e},_interpolate:function(e){for(var t,n,o,s=document.querySelector(":focus"),a=this.container.querySelectorAll(i),l=a.length,c=0;l>c;c++)t=a[c],t!==s&&(e&&"hidden"===t.type||(n=t.getAttribute(r),o=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(n)||"":t.defaultValue,t.value=o))},update:function(e){this.elementToChange=e?e:this.elementToChange,this._interpolate()},show:function(e){var i=this.container.querySelector(o);if(this._observe(),this.update(e),t.addClass(this.link,n),this.container.style.display="",this.isOpen=!0,this.fire("show"),i&&!e)try{i.focus()}catch(r){}},_hide:function(e){this.elementToChange=null,t.removeClass(this.link,n),this.container.style.display="none",this.isOpen=!1},hide:function(){this._hide(),this.fire("hide")},cancel:function(){this._hide(),this.fire("cancel")}})}(wysihtml5),function(e){var t=e.dom,n={position:"relative"},o={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},i={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},r={"x-webkit-speech":"",speech:""};e.toolbar.Speech=function(s,a){var l=document.createElement("input");if(!e.browser.supportsSpeechApiOn(l))return void(a.style.display="none");var c=s.editor.textarea.element.getAttribute("lang");c&&(r.lang=c);var d=document.createElement("div");e.lang.object(o).merge({width:a.offsetWidth+"px",height:a.offsetHeight+"px"}),t.insert(l).into(d),t.insert(d).into(a),t.setStyles(i).on(l),t.setAttributes(r).on(l),t.setStyles(o).on(d),t.setStyles(n).on(a);var h="onwebkitspeechchange"in l?"webkitspeechchange":"speechchange";t.observe(l,h,function(){s.execCommand("insertText",l.value),l.value=""}),t.observe(l,"click",function(e){t.hasClass(a,"wysihtml5-command-disabled")&&e.preventDefault(),e.stopPropagation()})}}(wysihtml5),function(e){function t(t,n){var o=t.commands.state(n.name,n.value);return!n.dialog.multiselect&&e.lang.object(o).isArray()&&(o=1===o.length?o[0]:!0),o}var n="wysihtml5-command-disabled",o="wysihtml5-commands-disabled",i="wysihtml5-command-active",r="wysihtml5-action-active",s=e.dom;e.toolbar.Toolbar=Base.extend({constructor:function(t,s,a){this.editor=t,this.container="string"==typeof s?document.getElementById(s):s,this.composer=t.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),a&&this.show(),null!=t.config.classNameCommandDisabled&&(n=t.config.classNameCommandDisabled),null!=t.config.classNameCommandsDisabled&&(o=t.config.classNameCommandsDisabled),null!=t.config.classNameCommandActive&&(i=t.config.classNameCommandActive),null!=t.config.classNameActionActive&&(r=t.config.classNameActionActive);for(var l=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),c=l.length,d=0;c>d;d++)new e.toolbar.Speech(this,l[d])},_getLinks:function(t){for(var n,o,i,r,s,a,l=this[t+"Links"]=e.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+t+"]")).get(),c=l.length,d=0,h=this[t+"Mapping"]={};c>d;d++)n=l[d],i=n.getAttribute("data-wysihtml5-"+t),r=n.getAttribute("data-wysihtml5-"+t+"-value"),a=n.getAttribute("data-wysihtml5-"+t+"-blank-value"),o=this.container.querySelector("[data-wysihtml5-"+t+"-group='"+i+"']"),s=this._getDialog(n,i),h[i+":"+r]={link:n,group:o,name:i,value:r,tracksBlankValue:a,dialog:s,state:!1}},_getDialog:function(t,n){var o,i,r=this,s=this.container.querySelector("[data-wysihtml5-dialog='"+n+"']");return s&&(o=e.toolbar["Dialog_"+n]?new e.toolbar["Dialog_"+n](t,s):new e.toolbar.Dialog(t,s),o.on("show",function(){i=r.composer.selection.getBookmark(),r.editor.fire("show:dialog",{command:n,dialogContainer:s,commandLink:t})}),o.on("save",function(e){i&&r.composer.selection.setBookmark(i),r._execCommand(n,e),r.editor.fire("save:dialog",{command:n,dialogContainer:s,commandLink:t}),r._hideAllDialogs(),r._preventInstantFocus(),i=void 0}),o.on("cancel",function(){i&&r.composer.selection.setBookmark(i),r.editor.fire("cancel:dialog",{command:n,dialogContainer:s,commandLink:t}),i=void 0,r._preventInstantFocus()}),o.on("hide",function(){r.editor.fire("hide:dialog",{command:n,dialogContainer:s,commandLink:t}),i=void 0})),o},execCommand:function(e,t){this.commandsDisabled||this._execCommand(e,t)},_execCommand:function(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function(e){var t=this.editor;"change_view"===e&&(t.currentView===t.textarea||"source"===t.currentView?t.fire("change_view","composer"):t.fire("change_view","textarea")),"showSource"==e&&t.fire("showSource")},_observe:function(){for(var n=this,i=this.editor,r=this.container,a=this.commandLinks.concat(this.actionLinks),l=a.length,c=0;l>c;c++)"A"===a[c].nodeName?s.setAttributes({href:"javascript:;",unselectable:"on"}).on(a[c]):s.setAttributes({unselectable:"on"}).on(a[c]);s.delegate(r,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(e){e.preventDefault()}),s.delegate(r,"[data-wysihtml5-command]","click",function(e){var o,i=this,r=i.getAttribute("data-wysihtml5-command"),s=i.getAttribute("data-wysihtml5-command-value"),a=n.commandMapping[r+":"+s];s||!a.dialog?n.execCommand(r,s):(o=t(n.composer,a),a.dialog.show(o)),e.preventDefault()}),s.delegate(r,"[data-wysihtml5-action]","click",function(e){var t=this.getAttribute("data-wysihtml5-action");n.execAction(t),e.preventDefault()}),i.on("interaction:composer",function(e){n.preventFocus||n._updateLinkStates()}),this.container.ownerDocument.addEventListener("click",function(t){e.dom.contains(n.container,t.target)||e.dom.contains(n.composer.element,t.target)||(n._updateLinkStates(),n._preventInstantFocus())},!1),this.editor.config.handleTables&&(i.on("tableselect:composer",function(){n.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""}),i.on("tableunselect:composer",function(){n.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display="none"})),i.on("change_view",function(e){setTimeout(function(){n.commandsDisabled="composer"!==e,n._updateLinkStates(),n.commandsDisabled?s.addClass(r,o):s.removeClass(r,o)},0)})},_hideAllDialogs:function(){var e=this.commandMapping;for(var t in e)e[t].dialog&&e[t].dialog.hide()},_preventInstantFocus:function(){this.preventFocus=!0,setTimeout(function(){this.preventFocus=!1}.bind(this),0)},_updateLinkStates:function(){var e,o,a,l,c,d=this.commandMapping,h=this.composer,u=this.actionMapping;for(e in d)l=d[e],this.commandsDisabled?(o=!1,s.removeClass(l.link,i),l.group&&s.removeClass(l.group,i),l.dialog&&l.dialog.hide()):(o=this.composer.commands.state(l.name,l.value),s.removeClass(l.link,n),l.group&&s.removeClass(l.group,n)),(l.state!==o||l.tracksBlankValue)&&(l.state=o,o?l.tracksBlankValue?s.removeClass(l.link,i):(s.addClass(l.link,i),l.group&&s.addClass(l.group,i),!l.dialog||"undefined"!=typeof l.value&&null!==l.value||(o&&"object"==typeof o?(o=t(h,l),l.state=o,c=l.dialog.container.dataset?l.dialog.container.dataset.showdialogonselection:!1,h.config.showToolbarDialogsOnSelection||c?l.dialog.show(o):l.dialog.update(o)):l.dialog.hide())):l.tracksBlankValue?s.addClass(l.link,i):(s.removeClass(l.link,i),l.group&&s.removeClass(l.group,i),l.dialog&&!l.value&&l.dialog.hide()));for(e in u)a=u[e],"change_view"===a.name&&(a.state=this.editor.currentView===this.editor.textarea||"source"===this.editor.currentView,a.state?s.addClass(a.link,r):s.removeClass(a.link,r))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(e){e.toolbar.Dialog_createTable=e.toolbar.Dialog.extend({show:function(e){this.base(e)}})}(wysihtml5),function(e){var t="[data-wysihtml5-dialog-field]",n="data-wysihtml5-dialog-field";e.toolbar.Dialog_foreColorStyle=e.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var e={},o=this.container.querySelectorAll(t),i=o.length,r=0;i>r;r++)e[o[r].getAttribute(n)]=o[r].value;return e},_interpolate:function(o){for(var i,r,s=e.quirks.styleParser,a=document.querySelector(":focus"),l=this.container.querySelectorAll(t),c=l.length,d=0,h=this.elementToChange?e.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,u=h?h.getAttribute("style"):null,f=u?s.parseColor(u,"color"):null;c>d;d++)i=l[d],i!==a&&(o&&"hidden"===i.type||"color"===i.getAttribute(n)&&(r=(i.dataset.colormode||"rgb").toLowerCase(),r="hex"===r?"hash":r,f?i.value=s.unparseColor(f,r):i.value=s.unparseColor([0,0,0],r)))}})}(wysihtml5),function(e){e.dom;e.toolbar.Dialog_fontSizeStyle=e.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(t){var n=document.querySelector(":focus"),o=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),i=this.elementToChange?e.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,r=i?i.getAttribute("style"):null,s=r?e.quirks.styleParser.parseFontSize(r):null;o&&o!==n&&s&&!/^\s*$/.test(s)&&(o.value=s)}})}(wysihtml5);